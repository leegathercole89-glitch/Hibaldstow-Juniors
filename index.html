<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Hibaldstow Juniors FC</title>
  <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@700&display=swap" rel="stylesheet">

  <!-- PWA / Installable App Setup -->
  <link rel="manifest" href="data:application/manifest+json,{
    \"name\":\"Hibaldstow Juniors FC\",
    \"short_name\":\"Hibaldstow\",
    \"icons\":[{\"src\":\"assets/images/splash.jpg","sizes\":\"192x192\",\"type\":\"image/jpeg\"},{\"src\":\"assets/images/splash.jpg","sizes\":\"512x512\",\"type\":\"image/jpeg\"}],
    \"start_url\":\".\",
    \"background_color\":\"#2d1b69\",
    \"theme_color\":\"#ff6b35\",
    \"display\":\"standalone\"
  }">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#2d1b69">
  <link rel="apple-touch-icon" href="assets/images/splash.jpg">

  <style>
    :root{--accent:#ff6b35;--bright:#4ecdc4;--fun:#ffe66d;--dark:#2d1b69}
   body{font-family:'Comic Neue',system-ui,sans-serif;margin:0;background:url("assets/images/homepage_image.jpg") center/cover no-repeat fixed; background-color:#0b1020;color:#2d1b69;min-height:100vh;overflow-x:hidden}
/* Answer â€œpillsâ€ that hug the text */
.quiz-options{
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:12px;
  margin-top:14px;
}

.quiz-answer{
  display:inline-flex;
  align-items:center;
  gap:10px;
  width:auto;
  max-width:92%;
  padding:12px 18px;
  border-radius:999px;
  background:#fff;
  color:#2d1b69;
  font-weight:900;
  box-shadow:0 8px 18px rgba(0,0,0,0.25);
  cursor:pointer;
  user-select:none;
}

/* Keep radio visible but neat */
.quiz-answer input{
  transform:scale(1.2);
}

/* Hover + selected effect */
.quiz-answer:hover{
  transform:scale(1.02);
}

.quiz-answer:has(input:checked){
  outline:4px solid rgba(78,205,196,0.65);
}


.container{max-width:1200px;margin:20px auto;padding:0 16px 220px}
    .grid{display:grid;gap:28px;grid-template-columns:1fr}
    @media(min-width:900px){.grid{grid-template-columns:1fr 1fr 1fr}}

    .big-card{height:100%;background:white;border-radius:32px;padding:28px;box-shadow:0 15px 40px rgba(0,0,0,0.2);text-align:center;transition:0.3s;display:flex;flex-direction:column;justify-content:center;align-items:center}
    .big-card:hover{transform:translateY(-10px)}

    button{background:var(--accent);color:white;border:none;padding:18px 36px;border-radius:50px;font-size:1.8rem;font-weight:900;cursor:pointer;box-shadow:0 8px 25px rgba(255,107,53,0.5);transition:0.3s;margin:10px}
    button:hover{transform:scale(1.08)}

    .go-btn{background:#ff4757;padding:28px 70px;font-size:3rem;animation:bounce 1.8s infinite}
    @keyframes bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-25px)}}

    .home-img{max-width:100%;border-radius:24px;margin:20px 0;box-shadow:0 12px 35px rgba(0,0,0,0.25);transition:0.3s;cursor:pointer}
    .home-img:hover{transform:scale(1.04)}

    .card-with-signs{display:flex;gap:28px;align-items:stretch;height:100%;margin-left:-220px;}

    .signs{
      display:flex;
      flex-direction:column;
      gap:20px;
    }

    .side-sign{width:320px;border-radius:28px;box-shadow:0 16px 45px rgba(0,0,0,0.35);object-fit:cover;}

    @media(max-width:900px){
      .card-with-signs{display:flex;gap:28px;align-items:stretch;height:100%;margin-left:-220px;flex-direction:column;}
      .signs{flex-direction:row;justify-content:center;}
      .side-sign{width:320px;border-radius:28px;box-shadow:0 16px 45px rgba(0,0,0,0.35);object-fit:cover;}
    }

    #splash{position:fixed;inset:0;background:var(--dark);display:flex;align-items:center;justify-content:center;z-index:99999;transition:opacity 1.5s}
    #splash img{max-width:95%;max-height:95vh;border-radius:24px;box-shadow:0 15px 50px rgba(0,0,0,0.6);object-fit:contain}

    /* Club Song is now a tile in the homepage grid (keep ID styling neutral) */
    #clubSongBtn{background:transparent;padding:0;font-size:inherit;animation:none}

    #photoGallery{position:fixed;inset:0;background:var(--dark);z-index:9999;display:none;flex-direction:column;padding:20px 10px;overflow-hidden;color:white;text-align:center}
    #photoGallery.active{display:flex}
    #photoGallery h2{font-size:2.8rem;margin:10px 0 20px}
    .gallery-scroll{flex:1;overflow-x:auto;scroll-snap-type:x mandatory;display:flex;gap:20px;padding:10px 0;scroll-behavior:smooth;-webkit-overflow-scrolling:touch}
    .gallery-scroll::-webkit-scrollbar{display:none}
    .gallery-scroll{margin-bottom:14px}
    .gallery-scroll img{height:39vh;max-width:90vw;object-fit:contain;border-radius:20px;flex-shrink:0;scroll-snap-align:center;box-shadow:0 15px 40px rgba(0,0,0,0.6);transition:transform 0.3s}
    .gallery-scroll img:hover{transform:scale(1.02)}
    .back-btn{background:#ff4757;padding:16px 40px;font-size:22px;border-radius:50px;margin-top:15px}

    #quizScreen{position:fixed;inset:0;background:var(--dark);z-index:9999;display:none;color:white;flex-direction:column;padding:40px 20px;overflow-y:auto;box-sizing:border-box;text-align:center}
    #quizScreen.active{display:flex}
    #quizTimer{font-size:3.5rem;font-weight:900;color:#ffe66d;margin:20px 0;animation:pulse 1s infinite}
    @keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.1)}100%{transform:scale(1)}}

    .overlay{position:fixed;inset:0;background:rgba(45,27,105,0.97);display:none;align-items:center;justify-content:center;z-index:9999}
    .overlay.active{display:flex}
    .overlay-card{background:white;color:var(--dark);padding:40px;border-radius:32px;max-width:90%;text-align:center}
    .menu-btn{background:var(--bright);color:var(--dark);margin:12px;padding:20px;font-size:1.8rem;width:80%}
    .videoMenu{position:fixed;inset:0;background:var(--dark);z-index:9999;display:none;color:white;flex-direction:column;padding:60px 20px 100px;overflow-y:auto;box-sizing:border-box;text-align:center}
    .videoMenu.active{display:flex}
    .videoMenu h2{margin:0 0 40px;font-size:38px;font-weight:900}
    .video-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:24px;max-width:1000px;margin:0 auto}
    .video-thumb{background:#000;border-radius:20px;overflow:hidden;box-shadow:0 10px 30px rgba(0,0,0,0.4);cursor:pointer;position:relative;transition:0.3s}
    .video-thumb:hover{transform:scale(1.05)}
    .video-thumb img{width:100%;display:block}
    .play-icon{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:80px;height:80px;background:rgba(0,0,0,0.7);border-radius:50%;display:flex;align-items:center;justify-content:center}
    .play-icon::after{content:'';width:0;height:0;border-left:28px solid white;border-top:20px solid transparent;border-bottom:20px solid transparent;margin-left:8px}
    .video-title{margin-top:14px;font-size:18px;font-weight:700}
  
    #quizTimer.warn{animation:timerPulse 0.9s infinite}
    #quizTimer.danger{animation:timerPulse 0.6s infinite, timerShake 0.15s infinite}
    @keyframes timerPulse{0%,100%{transform:scale(1)}50%{transform:scale(1.12)}}
    @keyframes timerShake{0%{transform:translateX(0)}25%{transform:translateX(-2px)}50%{transform:translateX(2px)}75%{transform:translateX(-2px)}100%{transform:translateX(0)}}

    /* Slideshow under gallery */
    .slideshow{margin:18px auto 0;max-width:1100px}
    .slideshow-frame{position:relative;border-radius:22px;overflow:hidden;box-shadow:0 15px 40px rgba(0,0,0,0.6);background:#000}
    .slideshow-frame img{width:100%;height:30vh;max-height:360px;object-fit:contain;display:block;background:#000}
    .slide-nav{
      position:absolute;top:50%;transform:translateY(-50%);
      border:none;border-radius:999px;
      width:56px;height:56px;
      font-size:34px;font-weight:900;cursor:pointer;
      background:rgba(0,0,0,0.55);color:#fff;
      box-shadow:0 10px 25px rgba(0,0,0,0.4);
    }
    #prevSlide{left:12px}
    #nextSlide{right:12px}
    .slideshow-controls{display:flex;gap:12px;justify-content:center;align-items:center;margin-top:12px;flex-wrap:wrap}
    .slide-btn{background:#16a34a;color:#fff;border:none;padding:14px 26px;border-radius:999px;font-size:18px;font-weight:900;cursor:pointer}
    .slide-counter{font-size:18px;font-weight:800;opacity:0.95}

    @media(max-width:900px){
      .slideshow-frame img{height:24vh}
      .slide-nav{width:48px;height:48px;font-size:30px}
    }

    /* Click-to-zoom (half-screen, bright, no dark overlay on image) */
    #imgZoomBackdrop{
  position:fixed;
  inset:0;
  background:transparent;   /* â† only change */
  display:none;
  z-index:99998;
}

    }
    #imgZoomBackdrop.active{display:block;}

    #photoGallery img.zoom-half{
      position:fixed;
      top:50%;
      left:50%;
      transform:translate(-50%,-50%);
      width:60vw;
      height:60vh;
      object-fit:contain;
      background:transparent;
      padding:0;
      border-radius:16px;
      box-shadow:0 22px 60px rgba(0,0,0,0.45);
      z-index:99999;
      cursor:zoom-out;
      filter:none;
    }

    @media(max-width:900px){
      #photoGallery img.zoom-half{
        width:96vw;
        height:78vh;
      }
    }
  .quiz-question{
  background:#ffffff;
  color:#2d1b69;
  padding:22px 26px;
  border-radius:22px;
  font-size:1.35rem;
  font-weight:900;
  box-shadow:0 12px 28px rgba(0,0,0,0.35);
  margin-bottom:18px;
}

/* --- Homepage redesign (no cards) --- */
.home-shell{
  width:100%;
  max-width:1200px;
  margin:0 auto;
  padding:18px 16px 10px;
  background:rgba(255,255,255,0.10);
  border:1px solid rgba(255,255,255,0.16);
  border-radius:26px;
  box-shadow:0 18px 60px rgba(0,0,0,0.35);
  backdrop-filter: blur(6px);
}
.sign-strip{
  display:flex;
  gap:18px;
  justify-content:flex-end;
  align-items:flex-start;
  margin-bottom:16px;
  flex-wrap:wrap;
}
.sign-strip .side-sign{
  width:220px;          /* smaller than full posters, still visible */
  border-radius:22px;
  box-shadow:0 14px 40px rgba(0,0,0,0.35);
}

.home-actions{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap:22px;
  align-items:start;
}

.home-tile{
  position:relative;
  border-radius:22px;
  overflow:hidden;
  box-shadow:0 14px 40px rgba(0,0,0,0.35);
  background:rgba(255,255,255,0.12);
  border:1px solid rgba(255,255,255,0.18);
}

.home-tile img.home-img{
  width:100%;
  height:auto;
  display:block;
  margin:0;
  border-radius:0;
  box-shadow:none;
}

.tile-caption{
  position:absolute;
  left:14px;
  bottom:12px;
  background:rgba(0,0,0,0.55);
  color:#fff;
  padding:10px 14px;
  border-radius:999px;
  font-weight:900;
  font-size:18px;
}

.videos-wrap{
  display:flex;
  align-items:center;
  justify-content:center;
  min-height:220px;
  padding:18px;
  border-radius:22px;
  background:rgba(255,255,255,0.12);
  border:1px solid rgba(255,255,255,0.18);
  box-shadow:0 14px 40px rgba(0,0,0,0.35);
}

@media(max-width:900px){
  .home-actions{grid-template-columns:1fr}
  .sign-strip{justify-content:center}
  .sign-strip .side-sign{width:170px}
}

  
/* --- New homepage: bottom strip layout (no visible card) --- */
.home-stage{
  height: calc(100vh - 140px);
  min-height: 360px;
}

/* --- Concept 1: tidy grid homepage --- */
.home-grid-wrap{
  position:fixed;
  left:0; right:0; bottom:0;
  padding:14px 12px 18px;
  z-index:50;
  pointer-events:auto;
}

/* --- Homepage top signs (smaller + tap to zoom) --- */
.home-top-signs{
  position:fixed;
  left:0; right:0; top:10px;
  z-index:60;
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
  gap:12px;
  padding:0 10px;
  pointer-events:none; /* only the images should be clickable */
}
.home-sign{
  width:110px;
  max-width:42vw;
  border-radius:18px;
  box-shadow:0 12px 34px rgba(0,0,0,0.35);
  cursor:pointer;
  transition:transform 180ms ease;
  user-select:none;
  pointer-events:auto;
}
.home-sign:hover{transform:translateY(-2px) scale(1.02)}

#homeSignBackdrop{
  position:fixed;
  inset:0;
  background:transparent;
  display:none;
  z-index:99998;
}
#homeSignBackdrop.active{display:block;}

.home-sign.zoom{
  position:fixed;
  left:50%;
  top:50%;
  transform:translate(-50%,-50%);
  width:min(92vw,560px);
  max-width:92vw;
  z-index:99999;
  border-radius:22px;
  box-shadow:0 22px 60px rgba(0,0,0,0.55);
  filter:none;
  opacity:1;
}

@media(max-width:900px){
  .home-top-signs{
  position:fixed;
  left:0; right:0; top:10px;
  z-index:60;
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
  gap:12px;
  padding:0 10px;
  pointer-events:none; /* only the images should be clickable */
}
  .home-sign{width:115px}
}

.home-grid{
  pointer-events:auto;
  margin:0 auto;
  max-width:1000px;
  display:grid;
  grid-template-columns:repeat(3, minmax(140px, 1fr)); /* lock to 3 per row */
  grid-template-rows:auto auto;                      /* lock to 2 rows */
  gap:14px;
  align-items:stretch;
}

/* Smaller Club Song tile */
#clubSongBtn{
  transform:scale(0.85);
  transform-origin:center;
  align-self:center;
}
#clubSongBtn .tile-img{height:110px;}
#clubSongBtn .tile-label{font-size:1.2rem;padding:12px 12px;}


.tile-btn{
  appearance:none;
  border:none;
  padding:0;
  margin:0;
  width:100%;
  border-radius:22px;
  overflow:hidden;
  cursor:pointer;
  box-shadow:0 14px 40px rgba(0,0,0,0.35);
  background:rgba(255,255,255,0.12);
  border:1px solid rgba(255,255,255,0.18);
  transition:transform 0.25s ease;
}
.tile-btn:hover{transform:translateY(-4px) scale(1.01)}
.tile-img{
  width:100%;
  height:150px;
  display:block;
  object-fit:cover;
  background:#000;
}
.tile-label{
  display:flex;
  align-items:center;
  justify-content:center;
  gap:10px;
  padding:14px 14px;
  font-size:1.6rem;
  font-weight:900;
  color:#fff;
  background:rgba(0,0,0,0.55);
}

@media(max-width:900px){
  .home-stage{ height: calc(100vh - 260px); }
  .tile-img{height:130px}
  .tile-label{font-size:1.35rem}
}

.bottom-strip{
  position:fixed;
  left:0; right:0; bottom:0;
  padding:14px 12px 18px;
  z-index:50;
  pointer-events:none; /* allow only inner controls to capture */
}
.bottom-inner{
  pointer-events:auto;
  margin:0 auto;
  max-width:1200px;
  display:flex;
  align-items:flex-end;
  justify-content:center;
  gap:14px;
  flex-wrap:wrap;
  /* invisible "card": no background, no border */
  background:transparent;
}

.bottom-sign{
  width:170px;
  border-radius:18px;
  box-shadow:0 12px 34px rgba(0,0,0,0.35);
}

.bottom-btn{
  margin:0;
  padding:16px 26px;
  font-size:1.4rem;
}

.bottom-song{
  background:#9c27b0;
  margin:0;
  padding:16px 26px;
  font-size:1.4rem;
  animation:bounce 2s infinite;
}

.bottom-thumb{
  position:relative;
  width:180px;
  border-radius:18px;
  overflow:hidden;
  box-shadow:0 12px 34px rgba(0,0,0,0.35);
  cursor:pointer;
}
.bottom-thumb img{
  width:100%;
  height:110px;
  object-fit:cover;
  display:block;
}
.bottom-label{
  position:absolute;
  left:10px;
  bottom:8px;
  background:rgba(0,0,0,0.55);
  color:#fff;
  padding:6px 10px;
  border-radius:999px;
  font-weight:900;
  font-size:14px;
}

.bottom-go{
  position:absolute;
  right:10px;
  top:10px;
  padding:10px 18px;
  font-size:1.6rem;
  border-radius:999px;
  margin:0;
}

@media(max-width:900px){
  .home-stage{ height: calc(100vh - 220px); }
  .bottom-sign{ width:140px; }
  .bottom-thumb{ width:160px; }
  .bottom-thumb img{ height:100px; }
}

  
/* --- Adjust bottom thumbnails to match sign visual weight --- */
.bottom-thumb{
  width:220px;              /* match sign size */
}
.bottom-thumb img{
  height:140px;             /* taller image */
}

@media(max-width:900px){
  .bottom-thumb{
    width:180px;
  }
  .bottom-thumb img{
    height:120px;
  }
}

  
/* --- Make PLAYERS + QUIZ images same height as signs --- */
.bottom-thumb{
  width:220px;
  height:220px;           /* match sign height */
}
.bottom-thumb img{
  width:100%;
  height:100%;
  object-fit:cover;
}

@media(max-width:900px){
  .bottom-thumb{
    width:180px;
    height:180px;
  }
}

  
/* =========================
   PENALTY SHOOTOUT STYLES (enhanced)
========================= */
.penalty-wrap{max-width:1100px;text-align:center}
.penalty-topbar{display:flex;align-items:center;justify-content:space-between;gap:14px;margin-bottom:10px}
.penalty-banner{
  flex:1;padding:14px 16px;border-radius:16px;
  background:rgba(30,20,10,0.85);border:2px solid rgba(255,255,255,0.20);
  color:#ffcc66;font-weight:1000;letter-spacing:1px;text-transform:uppercase;font-size:1.25rem;
  box-shadow:0 12px 40px rgba(0,0,0,0.45)
}
.penalty-scoreboard{
  width:200px;border-radius:16px;background:rgba(25,25,25,0.85);
  border:2px solid rgba(255,255,255,0.20);color:#fff;padding:10px 12px;
  box-shadow:0 12px 40px rgba(0,0,0,0.45);text-align:left
}
.penalty-scoreboard .sb-row{display:flex;align-items:baseline;justify-content:space-between;gap:10px;font-weight:900;padding:4px 0}
.penalty-scoreboard span{opacity:0.8;font-weight:800}
.penalty-scoreboard strong{font-size:1.2rem}

.penalty-message{font-size:1.15rem;font-weight:900;margin:10px 0 14px;min-height:32px;color:#fff;text-shadow:0 2px 14px rgba(0,0,0,0.55)}
.penalty-message.good{color:#d6ffb7}
.penalty-message.bad{color:#ffb7b7}

.penalty-goal{
  position:relative;width:min(960px,94vw);height:min(520px,58vh);margin:0 auto 14px;
  border-radius:22px;overflow:hidden;border:2px solid rgba(255,255,255,0.18);
  box-shadow:0 18px 55px rgba(0,0,0,0.55);background:#0b1020
}

.stadium-sky{position:absolute;inset:0 0 55% 0;
  background:radial-gradient(circle at 50% 30%, rgba(255,255,255,0.12), transparent 55%),
           linear-gradient(180deg, rgba(20,30,60,0.9), rgba(10,14,30,0.95))}
.stadium-stands{position:absolute;left:0;right:0;top:35%;bottom:26%;
  background:repeating-linear-gradient(90deg, rgba(255,255,255,0.08) 0 10px, rgba(255,255,255,0.03) 10px 20px),
           linear-gradient(180deg, rgba(220,220,220,0.08), rgba(0,0,0,0.35));
  filter:blur(0.3px)}
.pitch{position:absolute;left:0;right:0;bottom:0;height:30%;
  background:repeating-linear-gradient(90deg, rgba(34,197,94,0.35) 0 80px, rgba(34,197,94,0.22) 80px 160px),
           linear-gradient(180deg, rgba(16,185,129,0.20), rgba(0,0,0,0.45))}

.goal-frame{position:absolute;left:10%;right:10%;top:20%;bottom:25%;border-radius:10px}
.goal-frame .post,.goal-frame .crossbar{position:absolute;background:rgba(255,255,255,0.95);box-shadow:0 10px 30px rgba(0,0,0,0.35)}
.goal-frame .post.left{left:0;top:0;bottom:0;width:10px}
.goal-frame .post.right{right:0;top:0;bottom:0;width:10px}
.goal-frame .crossbar{left:0;right:0;top:0;height:10px}
.goal-frame .net{position:absolute;inset:10px;border-radius:10px;opacity:0.9;
  background:repeating-linear-gradient(0deg, rgba(255,255,255,0.18) 0 2px, transparent 2px 18px),
           repeating-linear-gradient(90deg, rgba(255,255,255,0.14) 0 2px, transparent 2px 18px)}

.target{position:absolute;width:86px;height:86px;border-radius:999px;left:50%;top:34%;
  transform:translate(-50%,-50%);
  background:radial-gradient(circle, rgba(255,255,255,0.0) 0 18px, rgba(255,200,60,0.9) 18px 26px, rgba(255,255,255,0) 26px 34px, rgba(255,200,60,0.85) 34px 40px, rgba(255,255,255,0) 40px 100%);
  box-shadow:0 12px 30px rgba(0,0,0,0.35);opacity:0.95}
.t-left{left:25%;top:44%}
.t-centre{left:50%;top:28%}
.t-right{left:75%;top:44%}

.goal-zone{position:absolute;top:0;bottom:0;cursor:pointer;z-index:6}
.goal-zone[data-zone="left"]{left:0;width:33.333%}
.goal-zone[data-zone="centre"]{left:33.333%;width:33.333%}
.goal-zone[data-zone="right"]{right:0;width:33.333%}

.keeper{position:absolute;left:50%;top:54%;transform:translate(-50%,-50%);width:110px;height:110px;z-index:5;
  transition:transform 450ms ease;filter:drop-shadow(0 10px 18px rgba(0,0,0,0.5));user-select:none}
.keeper-svg{width:100%;height:100%}
.ball{position:absolute;left:50%;bottom:10%;transform:translate(-50%,0);width:74px;height:74px;z-index:5;
  transition:transform 650ms cubic-bezier(.2,.9,.2,1);filter:drop-shadow(0 10px 18px rgba(0,0,0,0.5));user-select:none}
.ball-svg{width:100%;height:100%}

.keeper.dive-left{transform:translate(-170%,-50%) rotate(-10deg)}
.keeper.dive-centre{transform:translate(-50%,-70%) scale(1.05)}
.keeper.dive-right{transform:translate(70%,-50%) rotate(10deg)}

.ball.shoot-left{transform:translate(-250%,-260%)}
.ball.shoot-centre{transform:translate(-50%,-300%)}
.ball.shoot-right{transform:translate(150%,-260%)}

@media(max-width:900px){
  .penalty-topbar{flex-direction:column;align-items:stretch}
  .penalty-scoreboard{width:100%}
  .penalty-goal{height:min(520px,62vh)}
  .target{width:70px;height:70px}
  .keeper{width:96px;height:96px}
  .ball{width:64px;height:64px}
}


/* =========================
   GAMES MENU STYLES
========================= */
.gamesmenu-wrap{max-width:900px;text-align:center}
.gamesmenu-topbar{display:flex;gap:14px;justify-content:center;margin-bottom:14px}
.gamesmenu-banner{
  width:100%;
  padding:14px 16px;
  border-radius:16px;
  background:rgba(30,20,10,0.85);
  border:2px solid rgba(255,255,255,0.20);
  color:#ffcc66;
  font-weight:1000;
  letter-spacing:1px;
  text-transform:uppercase;
  font-size:1.25rem;
  box-shadow:0 12px 40px rgba(0,0,0,0.45);
}
.gamesmenu-grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:16px;
  margin:18px auto 10px;
  width:min(820px, 92vw);
}
.gamesmenu-btn{
  background:var(--accent);
  color:white;
  border:none;
  padding:22px 18px;
  border-radius:22px;
  font-size:1.6rem;
  font-weight:1000;
  cursor:pointer;
  box-shadow:0 12px 30px rgba(255,107,53,0.35);
}
.gamesmenu-btn:hover{transform:scale(1.03)}
/* Image tile buttons (Games menu) */
.gamesmenu-tile{
  position:relative;
  border:none;
  padding:0;
  border-radius:22px;
  overflow:hidden;
  cursor:pointer;
  height:220px;
  background:rgba(0,0,0,0.25);
  box-shadow:0 14px 34px rgba(0,0,0,0.35);
  transform:translateZ(0);
}
.gamesmenu-tile:hover{transform:scale(1.02)}
.gamesmenu-tileimg{
  width:100%;
  height:100%;
  object-fit:cover;
  display:block;
  filter:saturate(1.05) contrast(1.05);
}
.gamesmenu-tilelabel{
  position:absolute;
  left:12px; right:12px; bottom:12px;
  padding:10px 12px;
  border-radius:16px;
  background:rgba(10,10,20,0.72);
  border:2px solid rgba(255,255,255,0.14);
  color:#fff;
  font-weight:1000;
  font-size:1.25rem;
  text-shadow:0 2px 10px rgba(0,0,0,0.6);
}
.gamesmenu-tile--empty .gamesmenu-tileimg{filter:grayscale(0.9) brightness(0.75)}
.gamesmenu-tile--empty .gamesmenu-tilelabel{opacity:0.95}
@media(max-width:640px){
  .gamesmenu-grid{grid-template-columns:1fr}
  .gamesmenu-tile{height:170px}
}
.gamesmenu-btn--empty{
  background:rgba(255,255,255,0.10);
  border:2px dashed rgba(255,255,255,0.28);
  box-shadow:none;
}
.gamesmenu-btn--empty:hover{transform:none}
@media(max-width:720px){
  .gamesmenu-grid{grid-template-columns:1fr}
}
.quiz-transparent{
  background: transparent !important;
  box-shadow: none !important;
  border: none !important;
}

/* =========================
   TOP TRUMPS STYLES
========================= */
.tt-wrap{max-width:1100px;text-align:center; padding-bottom:14px;}
.tt-topbar{display:flex;align-items:center;justify-content:space-between;gap:14px;margin-bottom:10px;flex-wrap:wrap}
.tt-banner{
  flex:1;min-width:180px;padding:14px 16px;border-radius:16px;
  background:rgba(30,20,10,0.85);border:2px solid rgba(255,255,255,0.20);
  color:#ffcc66;font-weight:1000;letter-spacing:1px;text-transform:uppercase;font-size:1.25rem;
  box-shadow:0 12px 40px rgba(0,0,0,0.45)
}
.tt-scoreboard{
  width:220px;border-radius:16px;background:rgba(25,25,25,0.85);
  border:2px solid rgba(255,255,255,0.20);color:#fff;padding:10px 12px;
  box-shadow:0 12px 40px rgba(0,0,0,0.45);text-align:left
}
.tt-scoreboard .sb-row{display:flex;justify-content:space-between;align-items:center;font-weight:900}
.tt-back-top{
  background:rgba(255,255,255,0.14);
  color:#fff;border:1px solid rgba(255,255,255,0.25);
  padding:10px 14px;border-radius:999px;cursor:pointer;font-weight:1000;
}
.tt-message{font-size:1.15rem;font-weight:900;margin:10px 0 14px;min-height:32px;color:#fff;text-shadow:0 2px 14px rgba(0,0,0,0.55)}
.tt-message.good{color:#d6ffb7}
.tt-message.bad{color:#ffb7b7}

.tt-table{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:18px;
  align-items:start;
  margin:0 auto 10px;
  max-width:1000px;
}

.tt-side{
  background:rgba(255,255,255,0.10);
  border:1px solid rgba(255,255,255,0.18);
  border-radius:22px;
  padding:12px;
  box-shadow:0 14px 40px rgba(0,0,0,0.35);
}

.tt-name{color:#fff;font-weight:1000;font-size:1.25rem;margin:6px 0 10px}

.tt-card{
  position:relative;
  border-radius:18px;
  overflow:hidden;
  box-shadow:0 12px 35px rgba(0,0,0,0.45);
  background:#000;
  perspective:1000px;
}
.tt-cardimg{
  width:100%;
  height:auto;
  display:block;
  border-radius:18px;
  transform-style:preserve-3d;
  transition:transform 420ms ease;
  will-change:transform;
  background:#000;
  max-height:min(62vh, 620px);
  object-fit:contain;
}

/* Mask that hides the printed name/stats on the card image */
.tt-mask{
  position:absolute;
  left:0;right:0;
  pointer-events:none;
  opacity:1;
  transition:opacity 220ms ease;
}
.tt-mask.top{top:0;height:18%;}
.tt-mask.bottom{bottom:0;height:45%;}
.tt-mask.top::before,
.tt-mask.bottom::before{
  content:"";
  position:absolute;inset:0;
  background:rgba(15, 15, 25, 0.82);
  backdrop-filter: blur(4px);
}
.tt-mask.top::after{
  content:"";
  position:absolute;left:50%;top:50%;
  transform:translate(-50%,-50%);
  font-weight:1000;letter-spacing:1px;
  color:rgba(255,255,255,0.85);
  font-size:0.95rem;
  text-shadow:0 2px 10px rgba(0,0,0,0.6);
}
.tt-mask.bottom::after{
  content:"";
  position:absolute;left:50%;top:50%;
  transform:translate(-50%,-50%);
  font-weight:1000;letter-spacing:1px;
  color:rgba(255,255,255,0.85);
  font-size:0.95rem;
  text-shadow:0 2px 10px rgba(0,0,0,0.6);
}

.tt-card.revealed .tt-mask{opacity:0}

.tt-stats{display:flex;flex-wrap:wrap;gap:10px;justify-content:center;margin-top:12px}
.tt-statbtn{
  background:#ff6b35;color:#fff;border:none;
  padding:12px 18px;border-radius:999px;
  font-size:1.05rem;font-weight:1000;
  cursor:pointer;box-shadow:0 8px 22px rgba(255,107,53,0.45);
  transition:transform 0.12s ease, box-shadow 0.12s ease, opacity 0.12s ease;
}
.tt-statbtn:hover{transform:scale(1.08)}
.tt-statbtn:disabled{opacity:0.5;cursor:not-allowed;box-shadow:none;transform:none}

/* Compact, sticky controls */
.tt-controls{
  position:sticky;
  bottom:0;
  padding:10px 12px;
  background:rgba(20,16,40,0.92);
  backdrop-filter: blur(6px);
  border-top: 1px solid rgba(255,255,255,0.12);
  display:flex;
  gap:10px;
  justify-content:center;
  z-index:9999;
  border-radius:18px;
  margin-top:10px;
}

#ttStartBtn, #ttNextBtn, #ttBackBtn{
  padding:10px 16px !important;
  font-size:1.05rem !important;
  border-radius:999px !important;
  min-height:44px;
}
#ttBackBtn{width:auto !important; min-width:120px;}

.tt-winfx, .tt-losefx{
  position:fixed;
  inset:0;
  pointer-events:none;
  opacity:0;
  transition:opacity 150ms ease;
  z-index:10050;
}
.tt-winfx.active{opacity:1;}
.tt-losefx.active{opacity:1;}

.tt-winfx .streamer{
  position:absolute;
  top:-20vh;
  width:18px;height:140vh;
  border-radius:999px;
  opacity:0.9;
  animation:tt-stream 1100ms ease-out forwards;
}
@keyframes tt-stream{
  0%{transform:translateY(-20vh) rotate(12deg);}
  100%{transform:translateY(120vh) rotate(12deg);}
}
.tt-losefx .boo{
  position:absolute;left:50%;top:35%;
  transform:translate(-50%,-50%);
  font-size:3.2rem;font-weight:1000;
  color:#ffb7b7;
  text-shadow:0 10px 40px rgba(0,0,0,0.6);
  animation:tt-pop 900ms ease-out forwards;
}
@keyframes tt-pop{
  0%{transform:translate(-50%,-50%) scale(0.7); opacity:0;}
  20%{opacity:1;}
  100%{transform:translate(-50%,-50%) scale(1.05); opacity:0;}
}


.tt-flash{
  position:fixed;
  left:50%;top:18%;
  transform:translateX(-50%);
  padding:14px 22px;
  border-radius:999px;
  font-weight:1000;
  font-size:1.6rem;
  z-index:99999;
  color:#fff;
  background:rgba(0,0,0,0.7);
  box-shadow:0 10px 40px rgba(0,0,0,0.6);
}
.tt-flash.win{background:rgba(34,197,94,0.85);}
.tt-flash.lose{background:rgba(239,68,68,0.85);}
.tt-flash.draw{background:rgba(234,179,8,0.85);}

.tt-final{
  position:fixed;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:1000;
  font-size:min(14vw, 120px);
  z-index:999999;
  color:#fff;
  text-shadow:0 10px 60px rgba(0,0,0,0.65);
  background:rgba(0,0,0,0.75);
}
.tt-final.win{background:rgba(34,197,94,0.35);}
.tt-final.lose{background:rgba(239,68,68,0.35);}
.tt-final.draw{background:rgba(234,179,8,0.35);}
/* Flip animation: we swap image src in JS, but keep a card flip feel */
.tt-card.flipping .tt-cardimg{transform:rotateY(180deg)}

@media(max-width:900px){
  .tt-topbar{flex-direction:column;align-items:stretch}
  .tt-scoreboard{width:100%}
  .tt-table{grid-template-columns:1fr}
}

/* =========================
   TROPHY CABINET
========================= */
.trophy-wrap{max-width:1200px;width:min(1200px,96vw);max-height:calc(var(--vh, 1vh)*92);text-align:center;display:flex;flex-direction:column;overflow:hidden}
.trophy-topbar{display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:8px}
.trophy-banner{
  flex:1;padding:14px 16px;border-radius:16px;
  background:rgba(30,20,10,0.85);border:2px solid rgba(255,255,255,0.20);
  color:#ffcc66;font-weight:1000;letter-spacing:1px;text-transform:uppercase;font-size:1.1rem;
  box-shadow:0 12px 40px rgba(0,0,0,0.45)
}
.trophy-back{padding:10px 14px;font-size:1rem}
.trophy-sub{color:#fff;font-weight:900;margin:8px 0 14px;text-shadow:0 2px 14px rgba(0,0,0,0.55)}
.trophy-grid{flex:1;overflow:auto;padding:10px;border-radius:16px;background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.12)}

.trophy-img{
  width:100%;
  aspect-ratio: 3 / 4;
  object-fit: cover;
  border-radius:12px;
  box-shadow:0 10px 28px rgba(0,0,0,0.45);
  cursor:pointer;
  background:#000;
  border:1px solid rgba(255,255,255,0.16);
}

.trophy-lightbox{
  position:fixed;
  inset:0;
  display:none;
  align-items:center;
  justify-content:center;
  background:rgba(0,0,0,0.92);
  z-index:99999;
}

.trophy-lightbox img{
  width:100vw;
  height:100vh;
  object-fit: contain;
  border-radius:0;
  box-shadow:none;
}

.trophy-lightbox.active{display:flex}


/* Trophy Cabinet: grid wrapper & sticky header */
.trophy-topbar{position:sticky;top:0;background:rgba(30,20,10,0.70);backdrop-filter:blur(6px);padding:10px;border-radius:16px;z-index:5}
.trophy-grid-inner{display:grid;grid-template-columns:repeat(auto-fit,minmax(clamp(72px,10vw,140px),1fr));gap:10px;align-items:stretch}



/* =========================
   CONFETTI (WIN EFFECT)
========================= */
#confettiContainer{
  position:fixed;
  inset:0;
  pointer-events:none;
  overflow:hidden;
  z-index:1000000;
}
.confetti{
  position:absolute;
  top:-10vh;
  width:10px;
  height:14px;
  opacity:0.95;
  transform:rotate(0deg);
  animation: confetti-fall linear forwards;
  border-radius:2px;
}
@keyframes confetti-fall{
  0%{ transform: translateY(-10vh) rotate(0deg); }
  100%{ transform: translateY(120vh) rotate(720deg); }
}


/* =========================
   FUN FLOATING SCOREBOARDS (Top Trumps + Penalties)
   - sits on purple background at right side
========================= */
.fun-scoreboard{
  position:fixed;
  right:18px;
  top:110px;
  width:min(340px, 34vw);
  min-width:240px;
  padding:18px 18px 16px;
  border-radius:24px;
  color:#fff;
  text-align:left;
  border:2px solid rgba(255,255,255,0.22);
  box-shadow:0 18px 55px rgba(0,0,0,0.55);
  background:
    radial-gradient(circle at 20% 20%, rgba(255,230,109,0.35), transparent 45%),
    radial-gradient(circle at 80% 70%, rgba(78,205,196,0.28), transparent 46%),
    linear-gradient(135deg, rgba(0,0,0,0.55), rgba(40,20,80,0.70));
  backdrop-filter: blur(6px);
  z-index:10060;
  overflow:hidden;
}
.fun-scoreboard::before{
  content:"";
  position:absolute;
  inset:-30px;
  background:
    radial-gradient(circle at 30px 30px, rgba(255,255,255,0.18), transparent 40%),
    repeating-linear-gradient(45deg, rgba(255,255,255,0.08) 0 10px, transparent 10px 22px);
  opacity:0.35;
  transform:rotate(-8deg);
  pointer-events:none;
}
.fun-scoreboard::after{
  content:"âš½ðŸ†";
  position:absolute;
  right:14px;
  top:10px;
  font-size:44px;
  opacity:0.40;
  transform:rotate(10deg);
  pointer-events:none;
}
.fun-scoreboard .sb-row{
  position:relative;
  display:flex;
  align-items:baseline;
  justify-content:space-between;
  gap:12px;
  font-weight:1000;
  padding:8px 0;
  font-size:1.15rem;
  text-shadow:0 2px 12px rgba(0,0,0,0.45);
}
.fun-scoreboard span{opacity:0.9;font-weight:900}
.fun-scoreboard strong{font-size:1.55rem}

@media(max-width:900px){
  /* On phones, revert to normal flow so it doesn't cover the pitch/cards */
  .fun-scoreboard{
    position:static;
    width:100%;
    min-width:unset;
    right:auto; top:auto;
    margin:10px 0 0;
  }
}


/* =========================
   OFFSIDE TRAINER
========================= */
.offside-pitch{
  position:relative;
  width:min(960px,94vw);
  height:min(420px,52vh);
  margin:0 auto 10px;
  border-radius:22px;
  overflow:hidden;
  border:2px solid rgba(255,255,255,0.18);
  box-shadow:0 18px 55px rgba(0,0,0,0.55);
  background:linear-gradient(180deg, rgba(15,10,40,0.85), rgba(10,8,24,0.92));
}
.offside-pitch::before{
  content:"";
  position:absolute;inset:0;
  background:
    repeating-linear-gradient(90deg, rgba(34,197,94,0.22) 0 90px, rgba(34,197,94,0.14) 90px 180px),
    linear-gradient(180deg, rgba(34,197,94,0.12), rgba(0,0,0,0.35));
  opacity:0.9;
}
.offside-halfline{
  position:absolute;top:0;bottom:0;left:50%;
  width:4px;background:rgba(255,255,255,0.55);
  transform:translateX(-50%);
  box-shadow:0 0 18px rgba(255,255,255,0.25);
  z-index:2;
}
.offside-goal{
  position:absolute;right:18px;top:22%;bottom:22%;
  width:10px;background:rgba(255,255,255,0.85);
  border-radius:6px;
  box-shadow:0 10px 30px rgba(0,0,0,0.35);
  z-index:2;
}
.offside-lastdef{
  position:absolute;top:0;bottom:0;
  border-left:4px dashed rgba(255,230,109,0.95);
  filter:drop-shadow(0 0 14px rgba(255,230,109,0.35));
  z-index:3;
}
.offside-ball,.offside-attacker,.offside-defender{
  position:absolute;top:50%;
  transform:translate(-50%,-50%);
  width:74px;height:74px;border-radius:999px;
  display:flex;align-items:center;justify-content:center;
  font-size:40px;
  z-index:5;
  user-select:none;
  box-shadow:0 14px 35px rgba(0,0,0,0.45);
}
.offside-ball{background:rgba(0,0,0,0.35);border:2px solid rgba(255,255,255,0.35)}
.offside-ball::after{content:"âš½";}
.offside-attacker{background:rgba(37,99,235,0.85);border:2px solid rgba(255,255,255,0.35)}
.offside-attacker::after{content:"ðŸ”µ";}
.offside-defender{background:rgba(239,68,68,0.85);border:2px solid rgba(255,255,255,0.35)}
.offside-defender::after{content:"ðŸ”´";}
.offside-label{
  position:absolute;
  z-index:6;
  background:rgba(0,0,0,0.45);
  color:#fff;
  padding:8px 12px;
  border-radius:999px;
  font-weight:1000;
  font-size:14px;
}
.offside-help{
  color:#fff;
  font-weight:900;
  font-size:1.25rem;
  margin:10px 0 0;
  text-shadow:0 2px 14px rgba(0,0,0,0.55);
  min-height:32px;
  width:min(960px,94vw);
  margin-left:auto;margin-right:auto;
}
.offside-controls{
  margin:12px auto 0;
  width:min(860px,94vw);
  background:rgba(255,255,255,0.10);
  border:1px solid rgba(255,255,255,0.16);
  border-radius:18px;
  padding:14px;
  box-shadow:0 14px 40px rgba(0,0,0,0.35);
  color:#fff;
}
.offside-row{
  display:flex;
  gap:12px;
  align-items:center;
  justify-content:space-between;
  flex-wrap:wrap;
  margin:10px 0;
}
.offside-row input[type="range"]{width:min(520px,90vw)}
@media(max-width:900px){
  .offside-pitch{height:min(420px,56vh)}
  .offside-ball,.offside-attacker,.offside-defender{width:64px;height:64px;font-size:34px}
}
/* =========================
   OFFSIDE SLIDER DEMO UPGRADE
========================= */
.offlearn-layout{
  display:grid;
  grid-template-columns: 1.6fr 0.9fr;
  gap:16px;
  align-items:start;
  width:min(1180px,96vw);
  margin:0 auto;
}
.offlearn-sidebar{display:flex;flex-direction:column;gap:16px;min-width:280px}
.offlearn-pitchwrap{justify-content:stretch}
.offlearn-pitchwrap .offside-pitch{width:100%;max-width:900px}
.offlearn-controlsbox{max-width:520px}
@media(max-width:1100px){
  .offlearn-layout{grid-template-columns:1fr}
  .offlearn-sidebar{max-width:740px;margin:0 auto}
  .offlearn-controlsbox{max-width:none}
}

.offlearn-pitchwrap{display:flex;justify-content:center}
.offlearn-pitch{position:relative}
.offlearn-coach{
  background:rgba(255,255,255,0.10);
  border:1px solid rgba(255,255,255,0.18);
  border-radius:18px;
  padding:12px;
  box-shadow:0 14px 40px rgba(0,0,0,0.35);
}
.offlearn-coachimg{
  width:100%;
  border-radius:16px;
  box-shadow:0 10px 30px rgba(0,0,0,0.5);
  display:block;
}
.offlearn-coachbox{
  margin-top:12px;
  background:rgba(0,0,0,0.75);
  border:2px solid rgba(255,255,255,0.22);
  border-radius:14px;
  padding:12px;
  color:#fff;
  font-weight:900;
  font-size:1rem;
  line-height:1.25;
}
.offlearn-controlsbox{
  background:rgba(255,255,255,0.10);
  border:1px solid rgba(255,255,255,0.18);
  border-radius:18px;
  padding:12px;
  box-shadow:0 14px 40px rgba(0,0,0,0.35);
}

/* Freeze + badge */
.offlearn-freeze{
  position:absolute;
  left:50%;
  top:10%;
  transform:translateX(-50%);
  background:rgba(0,0,0,0.70);
  border:1px solid rgba(255,255,255,0.20);
  color:#fff;
  padding:10px 16px;
  border-radius:999px;
  font-weight:1000;
  font-size:1.05rem;
  z-index:30;
  opacity:0;
  pointer-events:none;
}
.offlearn-freeze.show{opacity:1; animation:offPop 900ms ease-out}
.offlearn-badge{
  position:absolute;
  left:50%;
  top:20%;
  transform:translateX(-50%);
  padding:12px 18px;
  border-radius:999px;
  font-weight:1000;
  font-size:1.35rem;
  z-index:31;
  display:none;
  color:#fff;
  box-shadow:0 12px 40px rgba(0,0,0,0.55);
}
.offlearn-badge.show{display:block; animation:offPop 900ms ease-out}
.offlearn-badge.onside{background:rgba(34,197,94,0.85)}
.offlearn-badge.offside{background:rgba(239,68,68,0.85)}
@keyframes offPop{0%{transform:translateX(-50%) scale(0.9);opacity:0}15%{opacity:1}100%{transform:translateX(-50%) scale(1);opacity:1}}

/* Pulse the defender line at freeze-frame */
.offside-lastdef.pulse{animation:offLinePulse 900ms ease-in-out infinite}
@keyframes offLinePulse{0%,100%{opacity:0.55}50%{opacity:1}}

/* Ball kick animation (transform) */
.offlearn-ball{transition:transform 650ms cubic-bezier(.2,.9,.2,1);}
.offlearn-ball.flying{transform:translate(calc(var(--dx, 0px)), calc(var(--dy, 0px)));}

@media(max-width:980px){
  .offlearn-layout{grid-template-columns:1fr; gap:14px;}
}

/* ===== Offside Trainer label + layout fixes ===== */
.offlearn-layout{width:min(1280px,96vw);} /* allow a bit wider on desktop */

.offlearn-layout .offside-pitch{
  width:100%;
  max-width:760px;   /* stop it overflowing the grid column */
  height:min(460px,56vh);
  margin:0 auto 10px;
}

.player-label{
  position:absolute;
  top:-28px;
  left:50%;
  transform:translateX(-50%);
  padding:4px 10px;
  border-radius:999px;
  font-size:0.85rem;
  font-weight:1000;
  color:#fff;
  background:rgba(0,0,0,0.55);
  border:1px solid rgba(255,255,255,0.25);
  pointer-events:none;
  white-space:nowrap;
}
.player-label.blue{background:rgba(37,99,235,0.95);}
.player-label.red{background:rgba(220,38,38,0.95);}
.player-label.yellow{background:rgba(250,204,21,0.98); color:#2d1b69;}

@media(max-width:1100px){
  .offlearn-layout{grid-template-columns:1fr; gap:14px;}
  .offlearn-layout .offside-pitch{max-width:92vw;}
}

/* ===== Offside Learn Layout (Coach + Pitch + Controls) ===== */
.offlearn-container{max-width:1280px !important;text-align:center;}
.offlearn-toprow{display:flex;gap:14px;align-items:center;justify-content:space-between;margin:0 auto 14px;flex-wrap:wrap}
.offlearn-title{flex:1;min-width:280px}
.offlearn-status{width:360px;max-width:94vw}

.offlearn-shell{display:flex;gap:18px;align-items:flex-start;justify-content:center;margin:0 auto;max-width:1280px}
.offlearn-coachpanel{
  width:240px;flex:0 0 240px;
  background:rgba(255,255,255,0.08);
  border:1px solid rgba(255,255,255,0.14);
  border-radius:22px;
  padding:14px 14px 16px;
  box-shadow:0 18px 55px rgba(0,0,0,0.45);
}
.offlearn-coachimg{
  width:100%;
  border-radius:16px;
  display:block;
  box-shadow:0 14px 38px rgba(0,0,0,0.45);
}
.offlearn-coachbox{
  margin-top:12px;
  background:rgba(0,0,0,0.65);
  border:1px solid rgba(255,255,255,0.18);
  border-radius:16px;
  padding:12px 12px;
  color:#fff;
  font-weight:900;
  line-height:1.25;
  font-size:0.98rem;
}

.offlearn-main{width:min(980px,92vw);flex:1;display:flex;flex-direction:column;align-items:center}
.offlearn-pitchwrap{width:100%;display:flex;justify-content:center}
.offlearn-pitch{width:100% !important;max-width:980px !important;height:min(420px,48vh) !important}
.offlearn-controlsbox{
  width:min(640px,92vw);
  margin-top:14px;
  background:rgba(255,255,255,0.08);
  border:1px solid rgba(255,255,255,0.14);
  border-radius:20px;
  padding:14px 14px 16px;
  box-shadow:0 16px 45px rgba(0,0,0,0.35);
}
.offlearn-btnrow{justify-content:center;gap:14px;flex-wrap:wrap}
.offlearn-btn{border-radius:999px !important;padding:16px 26px !important;font-size:1.25rem !important;font-weight:1000 !important}
.offlearn-btn.play{background:#2563eb !important;color:#fff !important}
.offlearn-btn.rand{background:#16a34a !important;color:#fff !important}

.offlearn-rulebar{
  width:min(860px,94vw);
  margin:14px auto 8px;
  padding:10px 14px;
  border-radius:999px;
  background:rgba(0,0,0,0.55);
  border:1px solid rgba(255,255,255,0.18);
  color:#fff;
  font-weight:900;
  font-size:1.0rem;
}
.offlearn-back{margin-top:10px}

/* Keep player labels small */
.player-label{position:absolute;top:-26px;left:50%;transform:translateX(-50%);padding:4px 10px;border-radius:999px;font-size:0.78rem;font-weight:1000;color:#fff;pointer-events:none;z-index:30}
.player-label.blue{background:#2563eb;}
.player-label.red{background:#dc2626;}
.player-label.yellow{background:#facc15;color:#2d1b69;}

/* Responsive: stack coach above on small screens */
@media(max-width:980px){
  .offlearn-shell{flex-direction:column;align-items:center}
  .offlearn-coachpanel{width:min(520px,92vw);flex:0 0 auto;display:grid;grid-template-columns:140px 1fr;gap:12px;align-items:stretch}
  .offlearn-coachimg{height:140px;object-fit:cover}
  .offlearn-coachbox{margin-top:0}
  .offlearn-main{width:min(980px,94vw)}
  .offlearn-pitch{height:min(380px,44vh) !important}
}

/* ---- Offside Slider Demo: tighten controls layout to match mock ---- */
.offlearn-controlsbox{max-width:560px !important;}
.offlearn-controlsbox .offside-controls{
  width:100% !important;
  background:transparent !important;
  border:none !important;
  box-shadow:none !important;
  padding:0 !important;
  margin:0 !important;
}
.offlearn-controlsbox .offside-row{margin:12px 0 !important;}
.offlearn-controlsbox .offside-row input[type="range"]{width:100% !important;}
.offlearn-btnrow{display:flex !important; gap:18px !important; flex-wrap:nowrap !important;}
.offlearn-btnrow .offlearn-btn{flex:1 1 0; width:auto !important; padding:16px 22px !important; font-size:1.2rem !important;}
@media(max-width:900px){
  .offlearn-shell{flex-direction:column !important; align-items:center !important;}
  .offlearn-coachpanel{width:min(320px,92vw) !important;}
  .offlearn-btnrow{flex-wrap:wrap !important;}
}


/* =========================
   CUSTOM SCREEN BACKGROUNDS
========================= */
#gamesMenuScreen{
  background:
    linear-gradient(rgba(45,27,105,0.25), rgba(45,27,105,0.25)),
    url("assets/images/games-bg.jpg") center/cover no-repeat;
}
#quizMenuScreen, #quizScreen{
  background:
    linear-gradient(rgba(45,27,105,0.35), rgba(45,27,105,0.35)),
    url("assets/images/quiz-bg.jpg") center/cover no-repeat;
}


/* =========================
   PLAYER PROGRESS (XP + Challenges)
========================= */
.xpbar-wrap{
  width:min(900px, 92vw);
  margin: 12px auto 0;
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:12px;
}
.xp-pill{
  display:flex;
  align-items:center;
  gap:12px;
  padding:10px 14px;
  border-radius:999px;
  background:rgba(10,10,20,0.55);
  border:2px solid rgba(255,255,255,0.16);
  box-shadow:0 12px 30px rgba(0,0,0,0.25);
  backdrop-filter: blur(8px);
}
.xp-pill strong{font-weight:1000;letter-spacing:.2px}
.xp-meter{
  width:min(320px, 40vw);
  height:14px;
  background:rgba(255,255,255,0.14);
  border-radius:999px;
  overflow:hidden;
  border:1px solid rgba(255,255,255,0.18);
}
.xp-meter > div{
  height:100%;
  width:0%;
  background:linear-gradient(90deg, #22c55e, #38bdf8, #a78bfa);
  border-radius:999px;
  transition:width .35s ease;
}
.xp-actions{display:flex;gap:10px;flex-wrap:wrap;justify-content:center}
.xp-mini-btn{
  border:none;
  cursor:pointer;
  padding:10px 14px;
  border-radius:999px;
  font-weight:900;
  background:rgba(255,255,255,0.14);
  color:white;
  border:2px solid rgba(255,255,255,0.16);
}
.xp-mini-btn:hover{transform:scale(1.02)}
.xp-toast{
  position:fixed;
  left:50%;
  bottom:18px;
  transform:translateX(-50%);
  z-index:9999;
  padding:12px 16px;
  border-radius:16px;
  background:rgba(10,10,20,0.86);
  border:2px solid rgba(255,255,255,0.18);
  color:white;
  font-weight:1000;
  box-shadow:0 20px 50px rgba(0,0,0,0.45);
  display:none;
  max-width:min(520px, 92vw);
}
.chal-grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:14px;
  width:min(920px, 92vw);
  margin:16px auto 10px;
}
.chal-card{
  text-align:left;
  padding:16px 16px;
  border-radius:20px;
  background:rgba(255,255,255,0.12);
  border:2px solid rgba(255,255,255,0.14);
  box-shadow:0 16px 44px rgba(0,0,0,0.30);
}
.chal-title{font-weight:1000;font-size:1.15rem;margin:0 0 6px}
.chal-desc{opacity:.92;margin:0 0 10px;font-weight:800}
.chal-bar{height:12px;border-radius:999px;background:rgba(255,255,255,0.14);overflow:hidden;border:1px solid rgba(255,255,255,0.18)}
.chal-bar > div{height:100%;width:0%;background:linear-gradient(90deg,#ffcc66,#22c55e);transition:width .35s ease;border-radius:999px}
.chal-meta{display:flex;justify-content:space-between;align-items:center;margin-top:10px;font-weight:1000}
.chal-meta span{opacity:.95}
@media(max-width:760px){
  .chal-grid{grid-template-columns:1fr}
  .xpbar-wrap{flex-direction:column;align-items:stretch}
  .xp-pill{justify-content:center}
  .xp-meter{width:min(520px, 86vw)}
}

/* =========================
   POSITION ACADEMY
========================= */
.pos-wrap{max-width:1100px;text-align:center}
.pos-grid{
  display:grid;
  grid-template-columns:repeat(2, minmax(220px, 1fr));
  gap:16px;
  width:min(920px, 92vw);
  margin:18px auto 10px;
}
.pos-card{
  border:none;
  cursor:pointer;
  border-radius:24px;
  padding:18px 16px;
  background:rgba(255,255,255,0.12);
  border:2px solid rgba(255,255,255,0.14);
  box-shadow:0 16px 44px rgba(0,0,0,0.30);
  color:#fff;
  text-align:left;
}
.pos-card:hover{transform:scale(1.02)}
.pos-card .big{font-size:1.45rem;font-weight:1000;margin:0 0 6px}
.pos-card .sm{opacity:.92;font-weight:800;margin:0}
.pos-detail{
  display:grid;
  grid-template-columns: 0.95fr 1.05fr;
  gap:14px;
  width:min(1100px, 94vw);
  margin:0 auto;
  align-items:start;
}
.pos-panel{
  background:rgba(0,0,0,0.45);
  border:2px solid rgba(255,255,255,0.14);
  border-radius:22px;
  padding:14px;
  box-shadow:0 18px 52px rgba(0,0,0,0.45);
  text-align:left;
  color:#fff;
}
.pos-panel h3{margin:2px 0 10px;font-size:1.2rem;font-weight:1000}
.pos-pill{
  display:inline-block;
  padding:8px 12px;
  border-radius:999px;
  background:rgba(255,255,255,0.14);
  border:1px solid rgba(255,255,255,0.16);
  font-weight:1000;
  margin:0 8px 8px 0;
}
.pos-video-grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:12px;
}
.pos-vthumb{
  border:none;
  padding:0;
  cursor:pointer;
  border-radius:18px;
  overflow:hidden;
  background:rgba(255,255,255,0.10);
  box-shadow:0 12px 30px rgba(0,0,0,0.35);
}
.pos-vthumb img{width:100%;height:140px;object-fit:cover;display:block}
.pos-vthumb .cap{padding:10px 10px;font-weight:1000;color:#fff;background:rgba(10,10,20,0.70)}
.pos-qa{margin-top:12px}
.pos-q{
  background:#fff;
  color:#2d1b69;
  border-radius:18px;
  padding:16px 16px;
  font-weight:1000;
  margin:10px 0 12px;
}
.pos-opt{
  display:inline-flex;
  align-items:center;
  gap:10px;
  background:#fff;
  color:#2d1b69;
  font-weight:1000;
  border-radius:999px;
  padding:10px 14px;
  margin:8px 8px 0 0;
  cursor:pointer;
  user-select:none;
  box-shadow:0 10px 20px rgba(0,0,0,0.18);
}
.pos-opt input{transform:scale(1.15)}
.pos-result{
  margin-top:12px;
  padding:12px 14px;
  border-radius:16px;
  background:rgba(255,255,255,0.12);
  border:1px solid rgba(255,255,255,0.16);
  font-weight:1000;
}
@media(max-width:860px){
  .pos-detail{grid-template-columns:1fr}
  .pos-grid{grid-template-columns:1fr}
  .pos-vthumb img{height:160px}
}

/* =========================
   KEEPER REACTION GAME
========================= */
.keeper-wrap{max-width:1100px;text-align:center}
.keeper-arena{
  position:relative;
  width:min(900px, 92vw);
  height:min(520px, 56vh);
  margin:14px auto 10px;
  border-radius:28px;
  overflow:hidden;
  background:linear-gradient(180deg, rgba(10,15,40,0.85), rgba(0,0,0,0.45));
  border:2px solid rgba(255,255,255,0.14);
  box-shadow:0 18px 60px rgba(0,0,0,0.5);
}
.keeper-goal{
  position:absolute; inset:42px 60px 110px 60px;
  border:8px solid rgba(255,255,255,0.88);
  border-bottom:10px solid rgba(255,255,255,0.95);
  border-radius:14px;
  box-shadow:inset 0 0 0 2px rgba(0,0,0,0.25);
}
.keeper-net{
  position:absolute; inset:42px 60px 110px 60px;
  background:
    linear-gradient(90deg, rgba(255,255,255,0.14) 1px, transparent 1px) 0 0/24px 24px,
    linear-gradient(0deg, rgba(255,255,255,0.14) 1px, transparent 1px) 0 0/24px 24px;
  opacity:0.55;
  pointer-events:none;
}
.keeper-grass{
  position:absolute; left:0; right:0; bottom:0; height:170px;
  background:linear-gradient(180deg, rgba(14,68,45,0.9), rgba(6,36,24,0.95));
}
.keeper-grass:before{
  content:"";
  position:absolute; inset:0;
  background:linear-gradient(90deg, rgba(255,255,255,0.08) 0 10%, transparent 10% 20%) 0 0/180px 100%;
  opacity:0.35;
}
.keeper-savezone{
  position:absolute;
  width:28%;
  height:34%;
  border-radius:22px;
  background:rgba(255,255,255,0.06);
  border:2px dashed rgba(255,255,255,0.16);
  backdrop-filter: blur(2px);
  cursor:pointer;
  transition:transform .08s ease, background .12s ease, border-color .12s ease;
}
.keeper-savezone:active{transform:scale(0.98)}
.keeper-savezone.good{
  background:rgba(34,197,94,0.18);
  border-color:rgba(34,197,94,0.55);
}
.keeper-savezone.bad{
  background:rgba(239,68,68,0.18);
  border-color:rgba(239,68,68,0.55);
}
.kz-tl{left:70px; top:58px}
.kz-tr{right:70px; top:58px}
.kz-bl{left:70px; bottom:140px}
.kz-br{right:70px; bottom:140px}

.keeper-label{
  position:absolute;
  top:10px; left:12px;
  padding:8px 10px;
  border-radius:999px;
  font-weight:1000;
  background:rgba(10,10,20,0.58);
  border:1px solid rgba(255,255,255,0.14);
  color:#fff;
  font-size:0.95rem;
}
.keeper-ball{
  position:absolute;
  width:44px; height:44px;
  border-radius:999px;
  background:#fff;
  display:flex; align-items:center; justify-content:center;
  box-shadow:0 14px 30px rgba(0,0,0,0.45);
  transform:translate(-50%,-50%);
  left:50%; top:65%;
  z-index:5;
}
.keeper-ball:before{
  content:"âš½";
  font-size:26px;
  transform:translateY(1px);
}
.keeper-hint{
  margin:10px auto 0;
  max-width:900px;
  font-weight:900;
  color:#fff;
  opacity:0.95;
}
.keeper-flash{
  position:absolute; inset:0;
  background:rgba(255,255,255,0);
  pointer-events:none;
  transition:background .12s ease;
}
.keeper-flash.win{background:rgba(34,197,94,0.10)}
.keeper-flash.lose{background:rgba(239,68,68,0.10)}

@media(max-width:640px){
  .keeper-goal, .keeper-net{inset:40px 24px 120px 24px}
  .kz-tl{left:28px; top:56px}
  .kz-tr{right:28px; top:56px}
  .kz-bl{left:28px; bottom:150px}
  .kz-br{right:28px; bottom:150px}
}


/* =========================
   BUILD YOUR PLAYER (AVATAR)
========================= */
.avatar-mini{width:120px; min-width:120px; height:120px; display:flex; align-items:center; justify-content:center;}
.avatar-large{width:180px; height:180px; display:flex; align-items:center; justify-content:center;}
.avatar-card{
  width:min(860px, 94vw);
  margin:0 auto;
  padding:16px;
  border-radius:22px;
  background:rgba(255,255,255,0.10);
  border:1px solid rgba(255,255,255,0.16);
  box-shadow:0 16px 44px rgba(0,0,0,0.35);
  color:#fff;
}
.avatar-form{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:12px;
  margin-top:12px;
}
.avatar-form label{font-weight:1000; text-align:left; display:flex; flex-direction:column; gap:6px;}
.avatar-form select, .avatar-form input{
  font-size:1.1rem;
  padding:10px 12px;
  border-radius:14px;
  border:2px solid rgba(255,255,255,0.18);
  background:rgba(0,0,0,0.35);
  color:#fff;
}
@media(max-width:720px){
  .avatar-form{grid-template-columns:1fr;}
  .avatar-mini{width:96px; min-width:96px; height:96px;}
  .avatar-large{width:150px; height:150px;}
}

</style>
</head>
<body>
<div id="confettiContainer" aria-hidden="true"></div>

  <div id="splash">
    <img src="assets/images/splash.jpg">
  </div>

  <audio id="cheer" src="https://cdn.freesound.org/previews/612/612345_5674468-lq.mp3"></audio>
  <audio id="whistle" src="https://cdn.freesound.org/previews/276/276898_5123851-lq.mp3"></audio>
  <audio id="crowd" src="https://cdn.freesound.org/previews/711/711378_5674468-lq.mp3"></audio>
  <audio id="clubSong" src="assets/audio/club-song.mp3"></audio>
  <audio id="beep" src="https://cdn.freesound.org/previews/341/341695_5260877-lq.mp3" preload="auto"></audio>
<div class="container">
    <div class="grid">

<!-- Backdrop for sign zoom -->
<div id="homeSignBackdrop" aria-hidden="true"></div>

<!-- Top signs (tap to zoom) -->
<div class="home-top-signs" aria-label="Club signs">
  <img src="assets/images/green-sign.jpg" class="home-sign" data-home-sign alt="Green sign">
<img src="assets/images/blue-sign.jpg" class="home-sign" data-home-sign alt="Blue sign">
  </div>

<div class="home-stage">
  <!-- empty top area so the background can shine -->
</div>

<!-- Tidy grid homepage actions (Concept 1) -->
<div class="home-grid-wrap" aria-label="Homepage actions">

  <div class="xpbar-wrap" aria-label="Player progress">
    <div class="xp-pill">
      <div style="font-size:1.2rem">â­</div>
      <div>
        <div style="display:flex;gap:10px;align-items:baseline;flex-wrap:wrap">
          <strong id="xpLevelText">Level 1</strong>
          <span id="xpCountText" style="opacity:.92;font-weight:900">0 XP</span>
        </div>
        <div class="xp-meter" aria-label="XP progress"><div id="xpMeterFill"></div></div>
        <div id="xpNextText" style="opacity:.92;font-weight:900;margin-top:6px">0 / 200 to next level</div>
      </div>
    </div>

    <div class="xp-actions">
      <button class="xp-mini-btn" onclick="openChallenges(); playSound('whistle');">ðŸŽ¯ Weekly Challenges</button>
      <button class="xp-mini-btn" onclick="openTrophyCabinet(); playSound('cheer');">ðŸ† Trophies</button>
      <button class="xp-mini-btn" onclick="openPlayerBuilder(); playSound('whistle');">ðŸ§© Build Your Player</button>
        <button class="xp-mini-btn" onclick="openVote()">â­ Player of the Week</button>

    </div>
  </div>


  <div class="home-grid">
      <button class="tile" onclick="openPositionAcademy(); playSound('whistle');">
        <div class="tile-emoji">ðŸ§ </div>
        <div class="tile-title">Position Academy</div>
        <div class="tile-sub">Learn roles + quick tasks</div>
      </button>


    <button id="videosBtn" class="tile-btn" aria-label="Training Videos">
      <img class="tile-img" src="assets/images/training-videos.jpg" alt="Training Videos">
      <div class="tile-label">Training Videos</div>
    </button>

    <button id="penaltyBtn" class="tile-btn" aria-label="Games" onclick="openGamesMenu(); playSound('whistle');">
      <img class="tile-img" src="assets/images/games.jpg" alt="Games">
      <div class="tile-label">Games</div>
    </button>

    <button class="tile-btn" aria-label="Players" onclick="openPhotoGallery();playSound('crowd')">
      <img class="tile-img" src="assets/images/team.jpg" alt="Players">
      <div class="tile-label">Players</div>
    </button>

    <button class="tile-btn" aria-label="Quiz" onclick="openQuizMenu();playSound('whistle')">
      <img class="tile-img" src="assets/images/quiz-card.jpg" alt="Quiz">
      <div class="tile-label">Quiz</div>
    </button>

    <button id="clubSongBtn" class="tile-btn" aria-label="Club Song" onclick="toggleClubSong()">
      <img class="tile-img" src="assets/images/club-song.jpg" alt="Club Song">
      <div class="tile-label" id="clubSongLabel">ðŸŽ¶ Club Song</div>
    </button>
</div>
</div>
</div>

  <div id="photoGallery">
    <h2>Team Photos & Moments</h2>
    <button class="menu-btn" style="margin:10px auto 14px;" onclick="openTrophyCabinet(); playSound('cheer');">Trophy Cabinet</button>

    <div class="gallery-scroll">
      <img src="assets/images/Alfie.jpg">
      <img src="assets/images/Bobby.jpg">
      <img src="assets/images/Caleb.jpg">
      <img src="assets/images/Charlie.jpg">
      <img src="assets/images/Jensen.jpg">
      <img src="assets/images/Kyle.jpg">
      <img src="assets/images/Leo.jpg">
      <img src="assets/images/Logan.jpg">
      <img src="assets/images/Oakley.jpg">
      <img src="assets/images/Thomas.jpg">
      <img src="assets/images/Will.jpg">
      <img src="assets/images/Will-Dog.jpg">
    </div>

    <div id="groupSlideshow" class="slideshow">
      <div class="slideshow-frame">
        <button class="slide-nav" id="prevSlide" aria-label="Previous slide">â€¹</button>
        <img id="groupSlideImg" src="assets/images/Group (1).jpg" alt="Group photo slideshow">
        <button class="slide-nav" id="nextSlide" aria-label="Next slide">â€º</button>
      </div>
      <div class="slideshow-controls">
        <button class="slide-btn" id="toggleSlides">â¸ Pause</button>
        <div id="slideCounter" class="slide-counter">1 / 25</div>
      </div>
    </div>

    <button class="back-btn" onclick="closePhotoGallery()">Back to Home</button>
  </div>

  <div id="videosOverlay" class="overlay">
    <div class="overlay-card">
      <h2 style="margin-bottom:30px">Training Videos</h2>
      <button onclick="openMenu('GK')" class="menu-btn">GOALKEEPER</button>
      <button onclick="openMenu('DEF')" class="menu-btn">DEFENCE</button>
      <button onclick="openMenu('MID')" class="menu-btn">MIDFIELD</button>
      <button onclick="openMenu('STR')" class="menu-btn">STRIKER</button>
      <button onclick="openMenu('ALL')" class="menu-btn">ALL PLAYERS</button>
      <button onclick="openMenu('SKL')" class="menu-btn">SKILLS & TRICKS</button>
      <button class="back-btn" onclick="closeOverlay()">Back to Home</button>
    </div>
  </div>

  <div id="menu_ALL" class="videoMenu">
    <h2>All Players</h2>
    <div class="video-grid">
      <div class="video-thumb" onclick="window.open('https://youtu.be/_dYy4QGXnns','_blank')">
        <img src="https://i.ytimg.com/vi/_dYy4QGXnns/maxresdefault.jpg"><div class="play-icon"></div>
        <div class="video-title">All Players Drill 1</div>
      </div>
      <div class="video-thumb" onclick="window.open('https://youtu.be/V4Q4H7CXomM','_blank')">
        <img src="https://i.ytimg.com/vi/V4Q4H7CXomM/maxresdefault.jpg"><div class="play-icon"></div>
        <div class="video-title">All Players Drill 2</div>
      </div>
      <div class="video-thumb" onclick="window.open('https://youtu.be/TdmSGgPcsjU','_blank')">
        <img src="https://i.ytimg.com/vi/TdmSGgPcsjU/maxresdefault.jpg"><div class="play-icon"></div>
        <div class="video-title">All Players Drill 3</div>
      </div>
      <div class="video-thumb" onclick="window.open('https://youtu.be/--llBGWd4JA','_blank')">
        <img src="https://i.ytimg.com/vi/--llBGWd4JA/maxresdefault.jpg"><div class="play-icon"></div>
        <div class="video-title">All Players Drill 4</div>
      </div>
      <div class="video-thumb" onclick="window.open('https://youtu.be/FwBT3JSSq3o','_blank')">
        <img src="https://i.ytimg.com/vi/FwBT3JSSq3o/maxresdefault.jpg"><div class="play-icon"></div>
        <div class="video-title">All Players Drill 5</div>
      </div>
      <div class="video-thumb" onclick="window.open('https://youtu.be/X9f_c6LHoTI','_blank')">
        <img src="https://i.ytimg.com/vi/X9f_c6LHoTI/maxresdefault.jpg"><div class="play-icon"></div>
        <div class="video-title">All Players Drill 6</div>
      </div>
      <div class="video-thumb" onclick="window.open('https://youtu.be/0j7alDnjJI0','_blank')">
        <img src="https://i.ytimg.com/vi/0j7alDnjJI0/maxresdefault.jpg"><div class="play-icon"></div>
        <div class="video-title">All Players Drill 7</div>
      </div>
    </div>
    <button class="back-btn"<button class="back-btn" onclick="closeMenu('ALL')">Back</button>
  </div>

  <div id="menu_DEF" class="videoMenu">
    <h2>DEF Training</h2>
    <div class="video-grid">
      <div class="video-thumb" onclick="window.open('https://youtu.be/Xhn3OtXsHgE','_blank')">
        <img src="https://i.ytimg.com/vi/Xhn3OtXsHgE/maxresdefault.jpg"><div class="play-icon"></div>
        <div class="video-title">Defence Drill 1</div>
      </div>
      <div class="video-thumb" onclick="window.open('https://youtu.be/0pC2xwU72gw','_blank')">
        <img src="https://i.ytimg.com/vi/0pC2xwU72gw/maxresdefault.jpg"><div class="play-icon"></div>
        <div class="video-title">Defence Drill 2</div>
      </div>
      <div class="video-thumb" onclick="window.open('https://youtu.be/NhHs9rcANdg','_blank')">
        <img src="https://i.ytimg.com/vi/NhHs9rcANdg/maxresdefault.jpg"><div class="play-icon"></div>
        <div class="video-title">Defence Drill 3</div>
      </div>
      <div class="video-thumb" onclick="window.open('https://youtu.be/NhHs9rcANdg','_blank')">
        <img src="https://i.ytimg.com/vi/NhHs9rcANdg/maxresdefault.jpg"><div class="play-icon"></div>
        <div class="video-title">Defence Drill 4</div>
      </div>
    </div>
    <button class="back-btn"<button class="back-btn" onclick="closeMenu('DEF')">Back</button>
  </div>

  <div id="menu_SKL" class="videoMenu">
    <h2>Skills & Tricks Playlist</h2>
    <div class="video-grid">
      <div class="video-thumb" onclick="window.open('https://youtu.be/eLH0B83NbCU','_blank')">
        <img src="https://i.ytimg.com/vi/eLH0B83NbCU/maxresdefault.jpg"><div class="play-icon"></div>
        <div class="video-title">Skills & Tricks</div>
      </div>
    </div>
    <button class="back-btn"<button class="back-btn" onclick="closeMenu('SKL')">Back</button>
  </div>

  <div id="menu_GK" class="videoMenu">
    <h2>GK Training</h2>
    <div class="video-grid">
      <div class="video-thumb" onclick="window.open('https://youtu.be/k1i6kWXi2Ls','_blank')">
        <img src="https://i.ytimg.com/vi/k1i6kWXi2Ls/maxresdefault.jpg"><div class="play-icon"></div>
        <div class="video-title">Goalkeeper Drill 1</div>
      </div>
      <div class="video-thumb" onclick="window.open('https://youtu.be/TPt1yU3AQg0','_blank')">
        <img src="https://i.ytimg.com/vi/TPt1yU3AQg0/maxresdefault.jpg"><div class="play-icon"></div>
        <div class="video-title">Goalkeeper Drill 2</div>
      </div>
      <div class="video-thumb" onclick="window.open('https://youtu.be/YCENd1NOljM','_blank')">
        <img src="https://i.ytimg.com/vi/YCENd1NOljM/maxresdefault.jpg"><div class="play-icon"></div>
        <div class="video-title">Goalkeeper Drill 3</div>
      </div>
      <div class="video-thumb" onclick="window.open('https://youtu.be/Wli4p93mZxA','_blank')">
        <img src="https://i.ytimg.com/vi/Wli4p93mZxA/maxresdefault.jpg"><div class="play-icon"></div>
        <div class="video-title">Goalkeeper Drill 4</div>
      </div>
    </div>
    <button class="back-btn"<button class="back-btn" onclick="closeMenu('GK')">Back</button>
  </div>
  <div id="menu_MID" class="videoMenu">
    <h2>MID Training</h2>
    <div class="video-grid">
      <div class="video-thumb" onclick="window.open('https://youtu.be/4-jOdpR_TQw','_blank')">
        <img src="https://i.ytimg.com/vi/4-jOdpR_TQw/maxresdefault.jpg"><div class="play-icon"></div>
        <div class="video-title">Midfield Drill 1</div>
      </div>
      <div class="video-thumb" onclick="window.open('https://youtu.be/deMrJtWkiZs','_blank')">
        <img src="https://i.ytimg.com/vi/deMrJtWkiZs/maxresdefault.jpg"><div class="play-icon"></div>
        <div class="video-title">Midfield Drill 2</div>
      </div>
      <div class="video-thumb" onclick="window.open('https://youtu.be/FBFePmLZN1s','_blank')">
        <img src="https://i.ytimg.com/vi/FBFePmLZN1s/maxresdefault.jpg"><div class="play-icon"></div>
        <div class="video-title">Midfield Drill 3</div>
      </div>
      <div class="video-thumb" onclick="window.open('https://youtu.be/MtK38kSRyYA','_blank')">
        <img src="https://i.ytimg.com/vi/MtK38kSRyYA/maxresdefault.jpg"><div class="play-icon"></div>
        <div class="video-title">Midfield Drill 4</div>
      </div>
    </div>
    <button class="back-btn"<button class="back-btn" onclick="closeMenu('MID')">Back</button>
  </div>
  <div id="menu_STR" class="videoMenu">
    <h2>STR Training</h2>
    <div class="video-grid">
      <div class="video-thumb" onclick="window.open('https://youtu.be/SHBNBBdyYkA','_blank')">
        <img src="https://i.ytimg.com/vi/SHBNBBdyYkA/maxresdefault.jpg"><div class="play-icon"></div>
        <div class="video-title">Striker Drill 1</div>
      </div>
      <div class="video-thumb" onclick="window.open('https://youtu.be/Oe5SFSCAc6w','_blank')">
        <img src="https://i.ytimg.com/vi/Oe5SFSCAc6w/maxresdefault.jpg"><div class="play-icon"></div>
        <div class="video-title">Striker Drill 2</div>
      </div>
    </div>
    <button class="back-btn"<button class="back-btn" onclick="closeMenu('STR')">Back</button>
  </div>

  
  <!-- =========================
       QUIZ TOPICS MENU
  ========================== -->
  <div id="quizMenuScreen" class="overlay">
    <div class="overlay-card quiz-transparent" style="width:min(820px,92vw);">
      <h2 style="margin:0 0 26px;font-size:80px;font-weight:2000;">Football Quiz Topics</h2>
      <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:14px;align-items:stretch;">
        <button class="menu-btn" onclick="startQuizTopic('rules'); playSound('whistle');">ðŸŸ¨ Rules & Referees</button>
        <button class="menu-btn" onclick="startQuizTopic('skills'); playSound('whistle');">âš¡ Skills & Tricks</button>
        <button class="menu-btn" onclick="startQuizTopic('positions'); playSound('whistle');">ðŸ§¤ Positions</button>
        <button class="menu-btn" onclick="startQuizTopic('matchday'); playSound('whistle');">ðŸŸï¸ Matchday</button>
        <button class="menu-btn" onclick="startQuizTopic('teamwork'); playSound('whistle');">ðŸ¤ Teamwork</button>
        <button class="menu-btn" onclick="startQuizTopic('offside'); playSound('whistle');">ðŸš© Offside Basics</button>
      </div>
      <button class="back-btn" style="margin-top:22px" onclick="closeQuizMenu()">Back to Home</button>
    </div>
  </div>

<div id="quizScreen">
    <h2>Mini Quiz â€“ Test Your Football Brain!</h2>
    <div id="quizTimer">120</div>
    <div id="quizContent"></div>
    <div id="quizResult" style="display:none;margin-top:10px">
      <div style="font-size:2.2rem;font-weight:900;margin:10px 0">Result</div>
      <div id="quizAvatar" class="avatar-large" aria-label="Your player"></div>
      <div id="quizScoreLine" style="font-size:1.6rem;margin:8px 0"></div>
      <div id="quizBestLine" style="font-size:1.2rem;opacity:0.9;margin:6px 0 16px"></div>
      <div style="display:flex;gap:12px;justify-content:center;flex-wrap:wrap">
        <button id="shareScoreBtn" class="menu-btn" style="background:#16a34a;color:white;width:auto;padding:16px 26px;font-size:1.4rem">Share score</button>
        <button id="copyScoreBtn" class="menu-btn" style="background:#2563eb;color:white;width:auto;padding:16px 26px;font-size:1.4rem">Copy score</button>
        <button id="playAgainBtn" class="menu-btn" style="background:#ffe66d;color:#2d1b69;width:auto;padding:16px 26px;font-size:1.4rem">Play again</button>
      </div>
      <div id="copyHint" style="margin-top:10px;font-size:1rem;opacity:0.85;display:none">Copied âœ…</div>
    </div>

    <button class="back-btn" onclick="backToQuizTopics()">Back to Topics</button>
  </div>

  <div id="imgZoomBackdrop" aria-hidden="true"></div>


<!-- =========================
     GAMES MENU OVERLAY
========================== -->
<div id="gamesMenuScreen" class="overlay">
  <div class="overlay-content gamesmenu-wrap">
    <div class="gamesmenu-topbar">
      <div class="gamesmenu-banner">GAMES</div>
    </div>

    <div class="gamesmenu-grid">

  <!-- Penalty Shootout -->
  <button class="gamesmenu-tile" onclick="openPenaltyFromGames(); playSound('whistle');" aria-label="Penalty Shootout">
    <img class="gamesmenu-tileimg" src="assets/images/games.jpg" alt="Penalty Shootout">
    <div class="gamesmenu-tilelabel">Penalty Shootout</div>
  </button>

  <!-- Top Trumps -->
  <button class="gamesmenu-tile" onclick="closeGamesMenu(); openTopTrumps(); playSound('whistle');" aria-label="Top Trumps">
    <img class="gamesmenu-tileimg" src="assets/images/games_toptrumps.png" alt="Top Trumps">
    <div class="gamesmenu-tilelabel">Top Trumps</div>
  </button>

  <!-- Offside Trainer -->
  <button class="gamesmenu-tile" onclick="closeGamesMenu(); openOffsideMenu(); playSound('whistle');" aria-label="Offside Trainer">
    <img class="gamesmenu-tileimg" src="assets/images/mean-coach-lee.jpg" alt="Offside Trainer">
    <div class="gamesmenu-tilelabel">Offside Trainer</div>
  </button>

<!-- Keeper Reaction -->
<button class="gamesmenu-tile" onclick="closeGamesMenu(); openKeeperGame(); playSound('whistle');" aria-label="Keeper Reaction">
  <img class="gamesmenu-tileimg" src="assets/images/games.jpg" alt="Keeper Reaction">
  <div class="gamesmenu-tilelabel">Keeper Reaction</div>
</button>

  <!-- Coming soon -->
  <button class="gamesmenu-tile gamesmenu-tile--empty" onclick="futureGameToast();" aria-label="Coming soon">
    <img class="gamesmenu-tileimg" src="assets/images/games.jpg" alt="Coming soon">
    <div class="gamesmenu-tilelabel">Coming soon</div>
  </button>

</div>


    <button class="back-btn" onclick="closeGamesMenu()">Back to Home</button>
  </div>
</div>


<!-- =========================
     PENALTY SHOOTOUT OVERLAY
========================== -->
<div id="penaltyScreen" class="overlay">
  <div class="overlay-content penalty-wrap">
    <div class="penalty-topbar">
      <div class="penalty-banner">CHOOSE WHERE TO SHOOT</div>
      <div id="penaltyAvatar" class="avatar-mini" aria-label="Your player"></div>

      <div class="penalty-scoreboard fun-scoreboard" aria-label="Scoreboard">
        <div class="sb-row"><span>Shot</span><strong id="penaltyShotInfo">1 / 5</strong></div>
        <div class="sb-row"><span>Score</span><strong id="penaltyScoreInfo">0</strong></div>
      </div>

      <button class="tt-back-top" type="button" onclick="closePenalty()">Back</button>
    </div>

    <div id="penaltyMessage" class="penalty-message">Press Start to begin</div>

    <div id="penaltyGoal" class="penalty-goal" aria-label="Penalty goal">
      <!-- Stadium layers -->
      <div class="stadium-sky" aria-hidden="true"></div>
      <div class="stadium-stands" aria-hidden="true"></div>
      <div class="pitch" aria-hidden="true"></div>

      <div class="goal-frame" aria-hidden="true">
        <div class="post left"></div>
        <div class="post right"></div>
        <div class="crossbar"></div>
        <div class="net"></div>
      </div>

      <!-- Targets -->
      <div class="target t-left" aria-hidden="true"></div>
      <div class="target t-centre" aria-hidden="true"></div>
      <div class="target t-right" aria-hidden="true"></div>

      <!-- 3 invisible tap zones -->
      <div class="goal-zone" data-zone="left" aria-label="Shoot left"></div>
      <div class="goal-zone" data-zone="centre" aria-label="Shoot centre"></div>
      <div class="goal-zone" data-zone="right" aria-label="Shoot right"></div>

      <!-- Keeper -->
      <div id="keeper" class="keeper" aria-hidden="true">
        <svg class="keeper-svg" viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
          <circle cx="60" cy="30" r="14" fill="#ffd1a1"/>
          <rect x="35" y="44" width="50" height="44" rx="14" fill="#ef4444"/>
          <rect x="22" y="54" width="20" height="12" rx="6" fill="#ef4444"/>
          <rect x="78" y="54" width="20" height="12" rx="6" fill="#ef4444"/>
          <rect x="42" y="84" width="14" height="24" rx="7" fill="#0b1020"/>
          <rect x="64" y="84" width="14" height="24" rx="7" fill="#0b1020"/>
          <circle cx="28" cy="60" r="7" fill="#ffffff"/>
          <circle cx="92" cy="60" r="7" fill="#ffffff"/>
        </svg>
      </div>

      <!-- Ball -->
      <div id="ball" class="ball" aria-hidden="true">
        <svg class="ball-svg" viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
          <circle cx="60" cy="60" r="46" fill="#ffffff"/>
          <circle cx="60" cy="60" r="46" fill="none" stroke="#111" stroke-width="6"/>
          <polygon points="60,36 44,50 50,70 70,70 76,50" fill="#111"/>
        </svg>
      </div>
    </div>

    <div style="display:flex;gap:12px;justify-content:center;flex-wrap:wrap;margin-top:6px">
      <button id="penaltyStartBtn" class="menu-btn" onclick="startPenaltyGame()">Start</button>
      <button id="penaltyAgainBtn" class="menu-btn" style="display:none;background:#16a34a;color:white" onclick="startPenaltyGame()">Play again</button>
    </div>

    <button class="back-btn" onclick="closePenalty()">Back to Home</button>
  </div>
</div>



<div id="topTrumpsScreen" class="overlay">
  <div class="overlay-content tt-wrap">
    <div class="tt-topbar">
      <div class="tt-banner">TOP TRUMPS</div>
      <div class="tt-scoreboard fun-scoreboard">
        <div class="sb-row"><span>You</span><strong id="ttYouCount">0</strong></div>
        <div class="sb-row"><span>Opponent</span><strong id="ttCpuCount">0</strong></div>
        <div class="sb-row"><span>Pot</span><strong id="ttPotCount">0</strong></div>
      </div>
      <button class="tt-back-top" type="button" onclick="closeTopTrumps()">Back</button>
    </div>

    <div id="ttMessage" class="tt-message">Press Start to begin</div>
<div id="ttFlash" class="tt-flash" style="display:none;">WINNER</div>
<div id="ttFinal" class="tt-final" style="display:none;"></div>

    <div class="tt-table">
      <div class="tt-side">
        <div class="tt-name" id="ttYouName">Your card</div>
        <div id="ttAvatar" class="avatar-mini" style="margin:10px auto 0;"></div>
        <div class="tt-card" id="ttYouCard">
          <img id="ttYouImg" class="tt-cardimg" src="assets/images/card_back.png" alt="Your Top Trumps card">
          <div class="tt-mask top"></div>
          <div class="tt-mask bottom"></div>
        </div>
      </div>

      <div class="tt-side">
        <div class="tt-name" id="ttCpuName">Opponent card</div>
        <div class="tt-card" id="ttCpuCard">
          <img id="ttCpuImg" class="tt-cardimg" src="assets/images/card_back.png" alt="Opponent Top Trumps card">
          <div class="tt-mask top"></div>
          <div class="tt-mask bottom"></div>
        </div>
      </div>
    </div>

    <div id="ttStatButtons" class="tt-stats" aria-label="Choose a stat">
      <!-- buttons injected by JS -->
    </div>

    <div class="tt-controls">
      <button class="menu-btn" id="ttStartBtn" onclick="startTopTrumps()">Start</button>
      <button class="menu-btn" id="ttNextBtn" onclick="nextTopTrumpsRound()" style="display:none;background:#16a34a;color:white;">Next Round</button>
      <button id="ttBackBtn" class="back-btn" onclick="closeTopTrumps()">Back</button>
    </div>
  </div>
</div>

<!-- =========================
     OFFSIDE TRAINER OVERLAYS
========================== -->
<div id="offsideMenuScreen" class="overlay">
  <div class="overlay-card" style="width:min(860px,94vw);">
    <h2 style="margin:0 0 18px;font-size:42px;font-weight:900;">ðŸš© Offside Trainer</h2>
    <div style="font-size:1.35rem;font-weight:800;margin:0 0 18px;color:#2d1b69;">
      Offside is checked <u>when the pass is played</u>.
    </div>
    <div style="display:flex;gap:14px;justify-content:center;flex-wrap:wrap;">
      <button id="offsidePlayBtn" class="menu-btn" style="background:#16a34a;color:white;">Play: Onside or Offside?</button>
      <button id="offsideLearnBtn" class="menu-btn" style="background:#2563eb;color:white;">Learn: Slider Demo</button>
    </div>
    <button class="back-btn" style="margin-top:18px" onclick="closeOffsideMenu()">Back</button>
  </div>
</div>

<div id="offsideGameScreen" class="overlay">
  <div class="overlay-content" style="max-width:1100px;text-align:center;">
    <div class="penalty-topbar" style="margin-bottom:8px;">
      <div class="penalty-banner">ON-SIDE or OFF-SIDE?</div>
      <div class="penalty-scoreboard" style="width:260px;">
        <div class="sb-row"><span>Score</span><strong id="offScore">0</strong></div>
        <div class="sb-row"><span>Streak</span><strong id="offStreak">0</strong></div>
        <div class="sb-row"><span>Round</span><strong id="offRound">1</strong></div>
      </div>
    </div>

    <div class="offside-pitch" aria-label="Offside pitch">
      <div class="offside-halfline"></div>
      <div class="offside-goal"></div>
      <div class="offside-lastdef" id="offLastLine"></div>

      <div class="offside-ball" id="offBall" title="Ball"></div>
      <div class="offside-attacker" id="offAtt" title="Attacker"></div>
      <div class="offside-defender" id="offDef" title="Last defender"></div>

      <div class="offside-label" style="left:10px;top:10px;">Your half</div>
      <div class="offside-label" style="right:10px;top:10px;">Goal</div>
    </div>

    <div class="offside-help" id="offHelp">Tap ON-SIDE or OFF-SIDE for this position.</div>

    <div style="display:flex;gap:12px;justify-content:center;flex-wrap:wrap;margin-top:12px;">
      <button class="menu-btn" style="background:#16a34a;color:white;width:auto;padding:18px 28px;font-size:1.6rem" onclick="answerOffside(false)">âœ… ON-SIDE</button>
      <button class="menu-btn" style="background:#ef4444;color:white;width:auto;padding:18px 28px;font-size:1.6rem" onclick="answerOffside(true)">ðŸš« OFF-SIDE</button>
      <button class="menu-btn" style="background:#ffe66d;color:#2d1b69;width:auto;padding:18px 22px;font-size:1.2rem" onclick="nextOffsideRound()">Next</button>
    </div>

    <button class="back-btn" style="margin-top:14px" onclick="closeOffsideGame()">Back</button>
  </div>
</div>

<!-- =========================
     OFFSIDE SLIDER DEMO (Learn)
========================== -->
<div id="offsideLearnScreen" class="overlay">
  <div class="overlay-content offlearn-container">
    <div class="offlearn-toprow">
      <div class="penalty-banner offlearn-title">OFFSIDE SLIDER DEMO</div>
      <div id="offsideAvatar" class="avatar-mini" aria-label="Your player"></div>
      <div class="penalty-scoreboard offlearn-status">
        <div class="sb-row"><span>Status</span><strong id="learnStatus">ON-SIDE</strong></div>
        <div class="sb-row"><span>Rule</span><strong style="font-size:0.95rem">Checked when pass is played</strong></div>
      </div>
    </div>

    <div class="offlearn-shell">
      <!-- COACH (left) -->
      <div class="offlearn-coachpanel">
        <img class="offlearn-coachimg" src="assets/images/mean-coach-lee.jpg" alt="Coach Lee">
        <div class="offlearn-coachbox" id="learnHelp">
          ðŸ‘‹ Coach says: Move <b>YOU</b> with the slider, then press <b>Play the pass</b>.
          We check offside at the <b>freeze-frame moment</b> when the pass is played.
        </div>
      </div>

      <!-- MAIN (center) -->
      <div class="offlearn-main">
        <div class="offlearn-pitchwrap">
          <div class="offside-pitch offlearn-pitch" aria-label="Offside slider pitch">
            <div class="offside-halfline"></div>
            <div class="offside-goal"></div>
            <div class="offside-lastdef" id="learnLastLine"></div>

            <div class="offlearn-freeze" id="learnFreeze">â¸ï¸ FREEZE FRAME â€” CHECK NOW!</div>
            <div class="offlearn-badge" id="learnBadge">âœ… ON-SIDE!</div>

            <div class="offside-ball offlearn-ball" id="learnBall" title="Ball">
              <div class="player-label yellow">BALL</div>
            </div>
            <div class="offside-attacker" id="learnAtt" title="Attacker">
              <div class="player-label blue">YOU</div>
            </div>
            <div class="offside-defender" id="learnDef" title="Last defender">
              <div class="player-label red">DEFENDER</div>
            </div>
          </div>
        </div>

        <div class="offlearn-controlsbox">
          <div class="offside-controls">
            <div class="offside-row">
              <label><strong>Move attacker</strong></label>
              <input id="attSlider" type="range" min="10" max="90" value="55">
            </div>

            <div class="offside-row">
              <label><strong>Attacker behind ball?</strong></label>
              <input id="behindBallToggle" type="checkbox">
            </div>

            <div class="offside-row offlearn-btnrow">
              <button class="menu-btn offlearn-btn play" onclick="playOffsidePass()">â–¶ï¸ Play the pass</button>
              <button class="menu-btn offlearn-btn rand" onclick="randomiseOffsideLearn()">ðŸŽ² Random</button>
            </div>
          </div>
        </div>

        <div class="offlearn-rulebar" id="learnRuleBar">
          ON-SIDE: level/behind the last defender, OR behind the ball, OR in your own half.
        </div>

        <button class="back-btn offlearn-back" onclick="closeOffsideLearn()">Back</button>
      </div>
    </div>
  </div>
</div>

<!-- =========================
     TROPHY CABINET OVERLAY
========================== -->
<div id="trophyCabinetScreen" class="overlay">
  <div class="overlay-content trophy-wrap">
    <div class="trophy-topbar">
      <div class="trophy-banner">TROPHY CABINET</div>
      <button class="back-btn trophy-back" onclick="closeTrophyCabinet()">Back</button>
    </div>

    <div class="trophy-sub">We are the Champions ðŸ†</div>

    <div class="trophy-grid">
      <div id="trophyGrid" class="trophy-grid-inner"></div>
    </div>

<div id="trophyLightbox" class="trophy-lightbox" onclick="closeTrophyLightbox()">
  <img id="trophyLightboxImg" alt="Trophy image">
</div>

<script>
    // Improved splash screen handling
    (function(){
      const splash = document.getElementById('splash');
      if (!splash) return;

      let hidden = false;

      const hideSplash = () => {
        if (hidden) return;
        hidden = true;
        splash.style.opacity = '0';
        setTimeout(() => {
          splash.style.display = 'none';
        }, 800);
      };

      // 1. Auto hide after 5 seconds maximum (safety net)
      setTimeout(hideSplash, 5000);

      // 2. Hide when page is fully loaded + small delay
      window.addEventListener('load', () => {
        setTimeout(hideSplash, 1500);
      });

      // 3. Hide on first user interaction (most reliable on mobile)
      document.addEventListener('click', () => {
        hideSplash();
      }, { once: true });

      // 4. Also hide on touchstart (mobile)
      document.addEventListener('touchstart', () => {
        hideSplash();
      }, { once: true });
    })();

    function playSound(id){
      const audio = document.getElementById(id);
      if(audio){
        audio.currentTime = 0;
        audio.volume = 0.8;
        audio.play().catch(()=>{});
      }
    }

    let songPlayed = false;

    function toggleClubSong(){
      const song = document.getElementById('clubSong');
      const label = document.getElementById('clubSongLabel');
      if (song.paused) {
        song.play().catch(()=>{});
        playSound('crowd');
        if (label) label.textContent = 'â¸ Pause Club Song';
      } else {
        song.pause();
        if (label) label.textContent = 'ðŸŽ¶ Play Club Song ðŸŽ¶';
      }
    }

    document.getElementById('videosBtn').onclick = () => {
      document.getElementById('videosOverlay').classList.add('active');
      playSound('crowd');
    };

    function closeOverlay(){
      document.getElementById('videosOverlay').classList.remove('active');
    }
    function openMenu(cat){
      document.getElementById('menu_'+cat).classList.add('active');
    }
    function closeMenu(cat){
      document.getElementById('menu_'+cat).classList.remove('active');
    }

    // --- Group slideshow (25 images) ---
    const GROUP_SLIDES = Array.from({length:25}, (_,i)=>`assets/images/Group (${i+1}).jpg`);
    let groupSlideIndex = 0;
    let groupSlideInterval = null;
    let groupSlidePlaying = true;
    let imageZoomReady = false;

    function renderGroupSlide(){
      const img = document.getElementById('groupSlideImg');
      const counter = document.getElementById('slideCounter');
      if (!img || !counter) return;
      img.src = GROUP_SLIDES[groupSlideIndex];
      counter.textContent = `${groupSlideIndex+1} / ${GROUP_SLIDES.length}`;
    }

    function nextGroupSlide(){
      groupSlideIndex = (groupSlideIndex + 1) % GROUP_SLIDES.length;
      renderGroupSlide();
    }

    function prevGroupSlide(){
      groupSlideIndex = (groupSlideIndex - 1 + GROUP_SLIDES.length) % GROUP_SLIDES.length;
      renderGroupSlide();
    }

    function startGroupSlides(){
      stopGroupSlides();
      groupSlidePlaying = true;
      const toggleBtn = document.getElementById('toggleSlides');
      if (toggleBtn) toggleBtn.textContent = 'â¸ Pause';
      groupSlideInterval = setInterval(nextGroupSlide, 3500);
    }

    function stopGroupSlides(){
      if (groupSlideInterval){
        clearInterval(groupSlideInterval);
        groupSlideInterval = null;
      }
    }

    function toggleGroupSlides(){
      const toggleBtn = document.getElementById('toggleSlides');
      if (groupSlidePlaying){
        groupSlidePlaying = false;
        stopGroupSlides();
        if (toggleBtn) toggleBtn.textContent = 'â–¶ï¸ Play';
      }else{
        startGroupSlides();
      }
    }

    function initGroupSlideshowControls(){
      const prevBtn = document.getElementById('prevSlide');
      const nextBtn = document.getElementById('nextSlide');
      const toggleBtn = document.getElementById('toggleSlides');
      if (prevBtn) prevBtn.onclick = () => { prevGroupSlide(); };
      if (nextBtn) nextBtn.onclick = () => { nextGroupSlide(); };
      if (toggleBtn) toggleBtn.onclick = () => { toggleGroupSlides(); };

      groupSlideIndex = 0;
      renderGroupSlide();
      startGroupSlides();
    }

    // --- Click any photo to zoom to half-screen ---
    let currentZoomImg = null;

    function clearZoom(){
      const backdrop = document.getElementById('imgZoomBackdrop');
      if (currentZoomImg){
        currentZoomImg.classList.remove('zoom-half');
        currentZoomImg = null;
      }
      if (backdrop) backdrop.classList.remove('active');
    }

    function toggleZoom(img){
      const backdrop = document.getElementById('imgZoomBackdrop');
      if (!img) return;

      if (currentZoomImg && currentZoomImg !== img){
        currentZoomImg.classList.remove('zoom-half');
      }

      const willZoom = !img.classList.contains('zoom-half');
      clearZoom();
      if (willZoom){
        img.classList.add('zoom-half');
        currentZoomImg = img;
        if (backdrop) backdrop.classList.add('active');
      }
    }

    function initImageZoom(){
      const gallery = document.getElementById('photoGallery');
      const backdrop = document.getElementById('imgZoomBackdrop');
      if (!gallery) return;

      gallery.addEventListener('click', (e) => {
        const img = e.target && e.target.tagName === 'IMG' ? e.target : null;
        if (img){
          e.preventDefault();
          e.stopPropagation();
          toggleZoom(img);
        }
      });

      if (backdrop){
        backdrop.addEventListener('click', clearZoom);
      }

      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') clearZoom();
      });
    }

    function openPhotoGallery(){
      document.getElementById('photoGallery').classList.add('active');
      initGroupSlideshowControls();
      if(!imageZoomReady){ initImageZoom(); imageZoomReady = true; }
    }
    function closePhotoGallery(){document.getElementById('photoGallery').classList.remove('active');}

    // --- Homepage signs: tap to zoom ---
    let currentHomeSign = null;

    function clearHomeSignZoom(){
      const backdrop = document.getElementById('homeSignBackdrop');
      if(currentHomeSign){
        currentHomeSign.classList.remove('zoom');
        currentHomeSign = null;
      }
      if(backdrop) backdrop.classList.remove('active');
    }

    function toggleHomeSignZoom(img){
      if(!img) return;
      const willZoom = !img.classList.contains('zoom');
      clearHomeSignZoom();
      if(willZoom){
        img.classList.add('zoom');
        currentHomeSign = img;
        const backdrop = document.getElementById('homeSignBackdrop');
        if(backdrop) backdrop.classList.add('active');
      }
    }

    function initHomeSignZoom(){
      const signs = Array.from(document.querySelectorAll('[data-home-sign]'));
      const backdrop = document.getElementById('homeSignBackdrop');
      if(signs.length === 0) return;

      signs.forEach(img => {
        img.addEventListener('click', (e) => {
          e.preventDefault();
          e.stopPropagation();
          toggleHomeSignZoom(img);
        });
      });

      if(backdrop){
        backdrop.addEventListener('click', clearHomeSignZoom);
      }

      document.addEventListener('keydown', (e) => {
        if(e.key === 'Escape') clearHomeSignZoom();
      });
    }

    const QUIZZES = [
      {q:"Who stands in goal and tries to stop shots?",choices:['Striker','Goalkeeper','Defender'],ans:"Goalkeeper"},
      {q:"Which players try to score goals?",choices:['Goalkeepers','Defenders','Forwards'],ans:"Forwards"},
      {q:"Who helps move the ball from defence to attack?",choices:['Goalkeeper','Midfielders','Strikers'],ans:"Midfielders"},
      {q:"What do we call it when you kick the ball hard away from danger?",choices:['A clearance','A nutmeg','A rainbow flick'],ans:"A clearance"},
      {q:"How many players are on a 7-a-side team (including goalkeeper)?",choices:['5','7','11'],ans:"7"},
      {q:"What should you do when your teammate has the ball?",choices:['Stand still','Make a run into space','Shout at them'],ans:"Make a run into space"},
      {q:"What is it called when the other team kicks the ball from the side after it goes out?",choices:['Corner kick','Goal kick','Throw-in'],ans:"Throw-in"},
      {q:"If the ball goes out behind the goal after touching a defender last, what do we get?",choices:['Goal kick','Corner kick','Free kick'],ans:"Corner kick"},
      {q:"What should you do when you win the ball back?",choices:['Kick it as hard as you can','Look for a teammate','Run with it forever'],ans:"Look for a teammate"},
      {q:"How do we start the game?",choices:['With a throw-in','With a kick-off','With a goal kick'],ans:"With a kick-off"},
      {q:"What is the offside rule in simple terms?",choices:['You canâ€™t be behind the last defender when the ball is passed','You canâ€™t touch the ball with your hands','You have to stay in your half'],ans:"You canâ€™t be behind the last defender when the ball is passed"},
      {q:"What colour card means 'stop playing badly'?",choices:['Yellow card','Red card','Green card'],ans:"Yellow card"},
      {q:"What colour card means you have to leave the pitch?",choices:['Yellow card','Red card','Blue card'],ans:"Red card"},
      {q:"What do we call it when you gently lift the ball over an opponent?",choices:['A chip','A header','A volley'],ans:"A chip"},
      {q:"What should you always do before a game?",choices:['Warm up','Eat lots of sweets','Sit down and wait'],ans:"Warm up"},
      {q:"Whatâ€™s the most important thing in football?",choices:['Winning every game','Having fun and trying your best','Scoring the most goals'],ans:"Having fun and trying your best"},
      {q:"What do we call a pass that goes behind the defence for a teammate to run onto?",choices:['A through ball','A cross','A back pass'],ans:"A through ball"},
      {q:"When should you use a header?",choices:['To pass or score with your head','To kick the ball harder','To stop the ball with your hands'],ans:"To pass or score with your head"},
      {q:"What does 'pressing' mean?",choices:['Running at the player with the ball to win it back','Standing still','Passing backwards'],ans:"Running at the player with the ball to win it back"},
      {q:"Why do we spread out on the pitch?",choices:['To make space and give teammates options','To stand close together','To make it easier for the other team'],ans:"To make space and give teammates options"}
    ];

    // 5 topics Ã— 10 questions
    
    /* =========================
       OFFSIDE TRAINER (game + slider demo)
    ========================= */
    function openOffsideMenu(){ document.getElementById('offsideMenuScreen').classList.add('active'); }
    function closeOffsideMenu(){ document.getElementById('offsideMenuScreen').classList.remove('active'); }
    function closeOffsideGame(){ document.getElementById('offsideGameScreen').classList.remove('active'); }
    function closeOffsideLearn(){ document.getElementById('offsideLearnScreen').classList.remove('active'); }

    // --- Option 1: Onside/Offside mini game ---
    let offState = { round:1, score:0, streak:0, isOffside:false };

    function startOffsideGame(){
      closeOffsideMenu();
      offState = { round:1, score:0, streak:0, isOffside:false };
      document.getElementById('offsideGameScreen').classList.add('active');
      nextOffsideRound(true);
    }

    function positionEl(el, xPct, yPct){
      if(!el) return;
      el.style.left = xPct + '%';
      el.style.top = yPct + '%';
      // store for easy rule checking
      el.dataset.x = String(xPct);
      el.dataset.y = String(yPct);
    }

    function nextOffsideRound(reset=false){
      if(!document.getElementById('offsideGameScreen').classList.contains('active')) return;

      if(reset){
        offState.round = 1; offState.score=0; offState.streak=0;
      }else{
        offState.round++;
      }

      // Scenario:
      // goal is on the right. Defender line at 55â€“80%.
      const defX = Math.floor(55 + Math.random()*25);
      const attX = Math.floor(35 + Math.random()*55);
      const ballX = Math.floor(30 + Math.random()*45);
      const y1 = Math.floor(28 + Math.random()*44);
      const y2 = Math.max(18, Math.min(82, y1 + (Math.random()*24 - 12)));

      // Simplified offside (kid version):
      // OFFSIDE if attacker is in opponents half AND ahead of ball AND ahead of last defender.
      const isInOppHalf = attX > 50;
      offState.isOffside = isInOppHalf && (attX > ballX) && (attX > defX);

      const lastLine = document.getElementById('offLastLine');
      if(lastLine) lastLine.style.left = defX + '%';

      positionEl(document.getElementById('offDef'), defX, y2);
      positionEl(document.getElementById('offAtt'), attX, y1);
      positionEl(document.getElementById('offBall'), ballX, Math.floor(58 + Math.random()*18));

      const help = document.getElementById('offHelp');
      if(help) help.textContent = "Freeze-frame (pass moment)â€¦ ON-SIDE or OFF-SIDE?";
      document.getElementById('offRound').textContent = offState.round;
      document.getElementById('offScore').textContent = offState.score;
      document.getElementById('offStreak').textContent = offState.streak;
    }

    function answerOffside(userSaysOffside){
      const help = document.getElementById('offHelp');
      const correct = (userSaysOffside === offState.isOffside);

      if(correct){
        offState.score++;
        offState.streak++;
        try{ noteOffsideCorrect(offState.streak); }catch(e){}
        if(help) help.textContent = "âœ… Correct! " + (offState.isOffside ? "Ahead of the last defender AND the ball." : "Level/behind the line, or behind the ball, or in own half.");
        playSound('cheer');
      }else{
        offState.streak = 0;
        if(help) help.textContent = "âŒ Not quite. " + (offState.isOffside ? "It WAS offside: ahead of the line AND ahead of the ball." : "It was ON-SIDE: level/behind the line, or behind the ball, or in own half.");
        playSound('beep');
      }
      document.getElementById('offScore').textContent = offState.score;
      document.getElementById('offStreak').textContent = offState.streak;
    }

    // --- Option 2: Slider demo ---
    function openOffsideLearn(){
      closeOffsideMenu();
      document.getElementById('offsideLearnScreen').classList.add('active');
      initOffsideLearn();
    }

    function initOffsideLearn(){
      const defX = 70;
      const ballX = 48;

      const last = document.getElementById('learnLastLine');
      if(last) last.style.left = defX + '%';

      positionEl(document.getElementById('learnDef'), defX, 55);
      positionEl(document.getElementById('learnBall'), ballX, 70);

      const slider = document.getElementById('attSlider');
      const toggle = document.getElementById('behindBallToggle');

      if(slider){
        slider.value = 55;
        slider.oninput = () => updateOffsideLearn();
      }
      if(toggle){
        toggle.checked = false;
        toggle.onchange = () => updateOffsideLearn();
      }

      updateOffsideLearn();
    }

    function updateOffsideLearn(){
      const last = document.getElementById('learnLastLine');
      const defX = last ? parseFloat(last.style.left) : 70;

      const ballEl = document.getElementById('learnBall');
      const ballX = ballEl ? parseFloat(ballEl.style.left) : 48;

      const slider = document.getElementById('attSlider');
      const toggle = document.getElementById('behindBallToggle');

      let attX = slider ? parseFloat(slider.value) : 55;
      if(toggle && toggle.checked){
        attX = Math.min(attX, ballX - 2); // force behind ball
      }

      positionEl(document.getElementById('learnAtt'), attX, 45);

      const isInOppHalf = attX > 50;
      const isOff = isInOppHalf && (attX > ballX) && (attX > defX);

      const status = document.getElementById('learnStatus');
      const help = document.getElementById('learnHelp');
      if(status){
        status.textContent = isOff ? "OFF-SIDE" : "ON-SIDE";
        status.style.color = isOff ? "#ffb7b7" : "#d6ffb7";
      }
      if(help){
        help.textContent = isOff
          ? "OFF-SIDE: ahead of the last defender AND ahead of the ball (in their half)."
          : "ON-SIDE: level/behind the last defender, OR behind the ball, OR in your own half.";
      }
    }

    function playOffsidePass(){
      const lastLine = document.getElementById('learnLastLine');
      const badge = document.getElementById('learnBadge');
      const freeze = document.getElementById('learnFreeze');
      const help = document.getElementById('learnHelp');
      const ball = document.getElementById('learnBall');
      const att = document.getElementById('learnAtt');
      const def = document.getElementById('learnDef');
      const behind = document.getElementById('behindBallToggle');

      // Determine verdict at the exact moment the pass is played (NOW)
      const attX = Number(att?.dataset.x || 55);
      const defX = Number(def?.dataset.x || 70);
      const behindBall = !!(behind && behind.checked);

      const onside = behindBall || (attX <= defX); // level is on-side
      const verdict = onside ? 'onside' : 'offside';

      // UI effects: freeze-frame + pulsing line
      if(lastLine) lastLine.classList.add('pulse');
      if(freeze){
        freeze.classList.add('show');
        setTimeout(()=>freeze.classList.remove('show'), 1200);
      }

      // Ball kick animation: fly from its current position toward YOU
      if(ball && att){
        const b = ball.getBoundingClientRect();
        const a = att.getBoundingClientRect();
        const dx = (a.left + a.width/2) - (b.left + b.width/2);
        const dy = (a.top + a.height/2) - (b.top + b.height/2);
        ball.style.setProperty('--dx', dx + 'px');
        ball.style.setProperty('--dy', dy + 'px');
        ball.classList.add('flying');
        setTimeout(()=>ball.classList.remove('flying'), 750);
      }

      // Big badge result
      if(badge){
        badge.classList.remove('onside','offside');
        badge.classList.add(verdict,'show');
        badge.textContent = onside ? 'âœ… ON-SIDE!' : 'ðŸš« OFF-SIDE!';
        setTimeout(()=>badge.classList.remove('show'), 1400);
      }

      // Update status text
      const status = document.getElementById('learnStatus');
      if(status){
        status.textContent = onside ? 'ON-SIDE' : 'OFF-SIDE';
        status.style.color = onside ? '#bbf7d0' : '#fecaca';
      }

      // Coach saysâ€¦
      if(help){
        help.innerHTML = onside
          ? "âœ… Coach says: At the pass moment, YOU are <b>level/behind</b> the DEFENDER line or behind the BALL â‡’ <b>ON-SIDE</b>."
          : "ðŸš« Coach says: At the pass moment, YOU are <b>in front</b> of the DEFENDER line â‡’ <b>OFF-SIDE</b>.";
      }

      try{ playSound('whistle'); }catch(e){}
    }

    function randomiseOffsideLearn(){
      const defX = Math.floor(55 + Math.random()*25);
      const ballX = Math.floor(35 + Math.random()*35);

      const last = document.getElementById('learnLastLine');
      if(last) last.style.left = defX + '%';

      positionEl(document.getElementById('learnDef'), defX, 55);
      positionEl(document.getElementById('learnBall'), ballX, 70);

      const slider = document.getElementById('attSlider');
      if(slider) slider.value = Math.floor(20 + Math.random()*75);
      const toggle = document.getElementById('behindBallToggle');
      if(toggle) toggle.checked = false;

      updateOffsideLearn();
    }

const QUIZ_SETS = {
      rules: [
        {q:"What do we call it when the ball goes out over the side line?",choices:['Throw-in','Corner','Penalty'],ans:"Throw-in"},
        {q:"What colour card is a warning?",choices:['Yellow','Red','Blue'],ans:"Yellow"},
        {q:"What colour card means you must leave the pitch?",choices:['Yellow','Red','Green'],ans:"Red"},
        {q:"If a defender touches the ball last and it goes out behind their goal, what do we get?",choices:['Corner kick','Goal kick','Kick-off'],ans:"Corner kick"},
        {q:"If the attacking team touches the ball last and it goes out behind the goal, what do we get?",choices:['Goal kick','Corner kick','Free kick'],ans:"Goal kick"},
        {q:"What is a foul?",choices:['Breaking the rules','Scoring a goal','Taking a throw-in'],ans:"Breaking the rules"},
        {q:"What is a penalty kick?",choices:['A free shot from the penalty spot','A throw-in','A corner'],ans:"A free shot from the penalty spot"},
        {q:"What do we call it when play stops for a broken rule and restarts with a kick?",choices:['Free kick','Kick-off','Drop ball'],ans:"Free kick"},
        {q:"In simple terms, offside meansâ€¦",choices:['You canâ€™t stand behind the last defender when the pass is played','You canâ€™t use your hands','You must stay in your half'],ans:"You canâ€™t stand behind the last defender when the pass is played"},
        {q:"Who makes sure the rules are followed?",choices:['Referee','Striker','Goalkeeper'],ans:"Referee"}
      ],
      skills: [
        {q:"What do we call a gentle lift of the ball over an opponent?",choices:['Chip','Tackle','Clearance'],ans:"Chip"},
        {q:"What is a tackle for?",choices:['To win the ball','To pick the ball up','To stop the clock'],ans:"To win the ball"},
        {q:"What does 'dribbling' mean?",choices:['Running with the ball close to your feet','Throwing the ball','Standing still'],ans:"Running with the ball close to your feet"},
        {q:"What is a 'pass'?",choices:['Kicking the ball to a teammate','Kicking the ball out','Shooting'],ans:"Kicking the ball to a teammate"},
        {q:"What is a 'shot'?",choices:['Trying to score a goal','A throw-in','A warm up'],ans:"Trying to score a goal"},
        {q:"What is a 'header'?",choices:['Hitting the ball with your head','Kicking with your heel','Using your hands'],ans:"Hitting the ball with your head"},
        {q:"What is the best first touch?",choices:['One that sets up your next action','A huge bounce away','No touch at all'],ans:"One that sets up your next action"},
        {q:"What does 'control' mean?",choices:['Keeping the ball close and safe','Kicking it away','Only shooting'],ans:"Keeping the ball close and safe"},
        {q:"Why do we look up when dribbling?",choices:['To find space and teammates','To close our eyes','To run slower'],ans:"To find space and teammates"},
        {q:"What is a 'cross'?",choices:['A ball played into the box from wide','A pass backwards only','A goal kick'],ans:"A ball played into the box from wide"}
      ],
      positions: [
        {q:"Who stands in goal and tries to stop shots?",choices:['Striker','Goalkeeper','Defender'],ans:"Goalkeeper"},
        {q:"Which players try to score goals?",choices:['Goalkeepers','Defenders','Forwards'],ans:"Forwards"},
        {q:"Who helps move the ball from defence to attack?",choices:['Goalkeeper','Midfielders','Strikers'],ans:"Midfielders"},
        {q:"What do defenders try to do most?",choices:['Stop goals and win the ball','Only score goals','Take corners only'],ans:"Stop goals and win the ball"},
        {q:"What does a goalkeeper wear that is different?",choices:['Gloves','Skates','A helmet'],ans:"Gloves"},
        {q:"If your team is attacking, what can defenders do?",choices:['Support and pass forward','Leave the pitch','Only sit down'],ans:"Support and pass forward"},
        {q:"What is teamwork in football?",choices:['Helping each other on and off the ball','Playing alone','Never passing'],ans:"Helping each other on and off the ball"},
        {q:"Who often takes throw-ins?",choices:['Any player','Only the referee','Only the goalkeeper'],ans:"Any player"},
        {q:"Who usually starts play with a goal kick?",choices:['Goalkeeper','Striker','Referee'],ans:"Goalkeeper"},
        {q:"What do we call the player who leads the team on the pitch?",choices:['Captain','Umpire','Coach'],ans:"Captain"}
      ],
      matchday: [
        {q:"What should you always do before a game?",choices:['Warm up','Eat lots of sweets','Sit down and wait'],ans:"Warm up"},
        {q:"What do we call the start of the game?",choices:['Kick-off','Throw-in','Corner'],ans:"Kick-off"},
        {q:"If the ball goes out over the goal line after the attacker touched it last, it'sâ€¦",choices:['Goal kick','Corner kick','Penalty'],ans:"Goal kick"},
        {q:"What should you do when your teammate has the ball?",choices:['Make a run into space','Stand still','Shout at them'],ans:"Make a run into space"},
        {q:"What should you do when you win the ball back?",choices:['Look for a teammate','Run with it forever','Kick it anywhere'],ans:"Look for a teammate"},
        {q:"What is the safest place to defend?",choices:['Between the ball and your goal','Behind the goal','In the corner flag'],ans:"Between the ball and your goal"},
        {q:"What does the whistle usually mean?",choices:['Stop / start play','Everyone scores','The match is over forever'],ans:"Stop / start play"},
        {q:"What should you bring to training?",choices:['Water bottle','A TV','A pillow'],ans:"Water bottle"},
        {q:"If you make a mistake, what should you do?",choices:['Try again and keep going','Give up','Blame everyone'],ans:"Try again and keep going"},
        {q:"Whatâ€™s the most important thing in football?",choices:['Having fun and trying your best','Winning every game','Never passing'],ans:"Having fun and trying your best"}
      ],
      teamwork: [
        {q:"When your teammate is under pressure, what can you do?",choices:['Offer a passing option','Hide','Stand behind opponents'],ans:"Offer a passing option"},
        {q:"Why is talking on the pitch helpful?",choices:['It helps teammates know whatâ€™s on','It makes you slower','It stops the ball'],ans:"It helps teammates know whatâ€™s on"},
        {q:"What is 'support' in football?",choices:['Getting close to help the player with the ball','Running away','Only shouting'],ans:"Getting close to help the player with the ball"},
        {q:"What should you do after you pass the ball?",choices:['Move to help again','Stop and watch only','Leave the pitch'],ans:"Move to help again"},
        {q:"What is a good attitude?",choices:['Encourage teammates','Laugh at mistakes','Argue with everyone'],ans:"Encourage teammates"},
        {q:"What should you do when defending as a team?",choices:['Stay compact and help each other','All chase the ball alone','Ignore your position'],ans:"Stay compact and help each other"},
        {q:"What is fair play?",choices:['Respecting opponents and officials','Cheating','Wasting time always'],ans:"Respecting opponents and officials"},
        {q:"What should you do if someone gets hurt?",choices:['Tell an adult/coach','Keep playing over them','Hide it'],ans:"Tell an adult/coach"},
        {q:"What does 'switch play' mean?",choices:['Move the ball to the other side','Swap boots','Stop the match'],ans:"Move the ball to the other side"},
        {q:"Whatâ€™s a great way to improve?",choices:['Practice regularly','Never train','Only play once'],ans:"Practice regularly"}
      ]
    
      ,
      offside: [
        {q:"Offside is checked whenâ€¦",choices:["You shoot","The ball is passed","The ball goes out"],ans:"The ball is passed"},
        {q:"You are ON-SIDE if you areâ€¦",choices:["Level with the last defender","Always behind the goal","Next to the goalkeeper"],ans:"Level with the last defender"},
        {q:"You are ON-SIDE if you areâ€¦",choices:["Behind the ball","In front of the goal","Touching the referee"],ans:"Behind the ball"},
        {q:"If you are in your own half, can you be offside?",choices:["Yes","No","Only on corners"],ans:"No"},
        {q:"If you are closer to the goal than the last defender when the pass is played, you areâ€¦",choices:["ON-SIDE","OFF-SIDE","A goalkeeper"],ans:"OFF-SIDE"},
        {q:"Offside is about where you are when your teammateâ€¦",choices:["Kicks the ball to you","Shouts your name","Tackles someone"],ans:"Kicks the ball to you"},
        {q:"If you are level with the last defender, you areâ€¦",choices:["OFF-SIDE","ON-SIDE","It depends on your boots"],ans:"ON-SIDE"},
        {q:"If you are behind the ball, you areâ€¦",choices:["ON-SIDE","OFF-SIDE","Yellow card"],ans:"ON-SIDE"},
        {q:"What do we call the defender you must be level with or behind?",choices:["Last defender","Best defender","Middle defender"],ans:"Last defender"},
        {q:"If you run too early and are offside, what happens?",choices:["Free kick to the other team","Corner to you","Penalty to you"],ans:"Free kick to the other team"},
      ]
};



    let quizTimerInterval;
    let quizTimeLeft = 120;

    
    // =========================
    // QUIZ TOPICS
    // =========================
    let ACTIVE_QUIZ = null;
    let quizTotalSeconds = 90;

    function openQuizMenu(){
      document.getElementById('quizMenuScreen').classList.add('active');
    }
    function closeQuizMenu(){
      document.getElementById('quizMenuScreen').classList.remove('active');
    }
    function backToQuizTopics(){
      closeQuiz();
      openQuizMenu();
    }

    function startQuizTopic(topicKey){
      // Pick the 10-question set, then start the existing quiz engine
      ACTIVE_QUIZ = QUIZ_SETS[topicKey] || QUIZZES.slice(0,10);
      quizTotalSeconds = 90; // 10 questions
      closeQuizMenu();
      openQuiz();
    }

function openQuiz(){
      document.getElementById('quizScreen').classList.add('active');

      const resultEl = document.getElementById('quizResult');
      const quizContent = document.getElementById('quizContent');
      if (resultEl) resultEl.style.display = 'none';
      if (quizContent) quizContent.style.display = 'block';

      startFullQuiz();
      startQuizTimer();
    }

    function closeQuiz(){
      ACTIVE_QUIZ = null;
      document.getElementById('quizScreen').classList.remove('active');
      clearInterval(quizTimerInterval);

      const resultEl = document.getElementById('quizResult');
      const quizContent = document.getElementById('quizContent');
      if (resultEl) resultEl.style.display = 'none';
      if (quizContent) quizContent.style.display = 'block';
    }

    function startQuizTimer(){
      let timeLeft = quizTotalSeconds;
      quizTimeLeft = quizTotalSeconds;
      document.getElementById('quizTimer').textContent = timeLeft;
      document.getElementById('quizTimer').classList.remove('warn','danger');
      quizTimerInterval = setInterval(()=>{
        timeLeft--;
        quizTimeLeft = timeLeft;
        document.getElementById('quizTimer').textContent = timeLeft;
        if (timeLeft <= 30) document.getElementById('quizTimer').classList.add('warn');

        if(timeLeft <= 10){
          document.getElementById('quizTimer').classList.remove('warn');
          document.getElementById('quizTimer').classList.add('danger');
          document.getElementById('quizTimer').style.color = '#ff4757';
        }
        if (timeLeft <= 5 && timeLeft > 0) {
          const beep = document.getElementById('beep');
          if (beep) {
            beep.currentTime = 0;
            beep.volume = 0.7;
            beep.play().catch(()=>{});
          }
        }

        if(timeLeft <= 0){
          clearInterval(quizTimerInterval);
          submitFullQuiz(true);
        }
      },1000);
    }

    function startFullQuiz(){
      if(!ACTIVE_QUIZ) ACTIVE_QUIZ = ACTIVE_QUIZ;

      let html = '';
      ACTIVE_QUIZ.forEach((q,i)=>{
        html += `<div class="quiz-question">${i+1}. ${q.q}</div><div class="quiz-options">`;
        const shuffled = [...q.choices].sort(() => 0.5 - Math.random());
        shuffled.forEach(c => html += `<label class="quiz-answer"><input type="radio" name="q${i}" value="${c}"> <span>${c}</span></label>`);

        html += `</div><hr style="border-color:rgba(255,255,255,0.2);margin:40px 0">`;
      });
      html += `<button onclick="submitFullQuiz()" style="background:#16a34a;padding:18px 50px;font-size:22px;border-radius:50px;margin:30px 0">Submit Answers!</button>`;
      document.getElementById('quizContent').innerHTML = html;
    }

    function getQuizHistory(){
      try{
        return JSON.parse(localStorage.getItem('hjfc_quiz_history') || '[]');
      }catch(e){
        return [];
      }
    }

    function saveQuizResult(entry){
      const history = getQuizHistory();
      history.unshift(entry);
      localStorage.setItem('hjfc_quiz_history', JSON.stringify(history.slice(0,20)));
    }

    function getBestScore(total){
      const history = getQuizHistory();
      let best = 0;
      history.forEach(h => { if (h && typeof h.score === 'number') best = Math.max(best, h.score); });
      return best;
    }

    function buildShareText(entry){
      const mins = Math.floor(entry.seconds / 60);
      const secs = entry.seconds % 60;
      const timeStr = mins > 0 ? `${mins}m ${secs}s` : `${secs}s`;
      return `ðŸ† Hibaldstow Juniors Quiz
I scored ${entry.score}/${entry.total} in ${timeStr}! âš½ðŸ”¥`;
    }

    async function shareText(text){
      if (navigator.share){
        try{
          await navigator.share({ text });
          return true;
        }catch(e){}
      }
      return false;
    }

    async function copyText(text){
      try{
        await navigator.clipboard.writeText(text);
        return true;
      }catch(e){
        const ta = document.createElement('textarea');
        ta.value = text;
        ta.setAttribute('readonly','');
        ta.style.position = 'fixed';
        ta.style.left = '-9999px';
        document.body.appendChild(ta);
        ta.select();
        try{ document.execCommand('copy'); }catch(err){}
        document.body.removeChild(ta);
        return true;
      }
    }

    function showQuizResultUI(entry){
      const resultEl = document.getElementById('quizResult');
      const scoreLine = document.getElementById('quizScoreLine');
      const bestLine = document.getElementById('quizBestLine');
      const shareBtn = document.getElementById('shareScoreBtn');
      const copyBtn = document.getElementById('copyScoreBtn');
      const playAgainBtn = document.getElementById('playAgainBtn');
      const copyHint = document.getElementById('copyHint');

      if(!resultEl) return;

      const quizContent = document.getElementById('quizContent');
      if (quizContent) quizContent.style.display = 'none';
      resultEl.style.display = 'block';

      const mins = Math.floor(entry.seconds / 60);
      const secs = entry.seconds % 60;
      const timeStr = mins > 0 ? `${mins}m ${secs}s` : `${secs}s`;

      scoreLine.textContent = entry.timeUp
        ? `Timeâ€™s up! You got ${entry.score} out of ${entry.total}. (${timeStr})`
        : `You got ${entry.score} out of ${entry.total}! (${timeStr})`;

      const best = getBestScore(entry.total);
      bestLine.textContent = `Best score so far on this device: ${best}/${entry.total}`;

      const shareMsg = buildShareText(entry);

      shareBtn.onclick = async () => {
        const ok = await shareText(shareMsg);
        if (!ok){
          const copied = await copyText(shareMsg);
          if (copied){
            copyHint.style.display = 'block';
            setTimeout(()=>copyHint.style.display='none', 1200);
          }
        }
      };

      copyBtn.onclick = async () => {
        const copied = await copyText(shareMsg);
        if (copied){
          copyHint.style.display = 'block';
          setTimeout(()=>copyHint.style.display='none', 1200);
        }
      };

      playAgainBtn.onclick = () => {
        resultEl.style.display = 'none';
        if (quizContent) quizContent.style.display = 'block';
        startFullQuiz();
        startQuizTimer();
      };
    }

    function submitFullQuiz(timeUp = false){
      clearInterval(quizTimerInterval);

      let score = 0;
      ACTIVE_QUIZ.forEach((q,i)=>{
        const sel = document.querySelector(`input[name="q${i}"]:checked`);
        if(sel && sel.value === q.ans) score++;
      });

      playSound('cheer');

      const totalSeconds = 180;
      const secondsSpent = Math.max(0, totalSeconds - (typeof quizTimeLeft === 'number' ? quizTimeLeft : 0));

      const entry = {
        score,
        total: ACTIVE_QUIZ.length,
        seconds: secondsSpent,
        timeUp: !!timeUp,
        ts: new Date().toISOString()
      };

      saveQuizResult(entry);
      showQuizResultUI(entry);
      try{ noteQuizCompleted(entry.score, entry.total); }catch(e){}
    }

/* =========================
   PENALTY SHOOTOUT LOGIC
========================= */
let penaltyShot = 1;
let penaltyScore = 0;
const PENALTY_TOTAL = 5;
let penaltyLocked = false;

function openPenalty(){
  document.getElementById('penaltyScreen').classList.add('active');
  resetPenaltyUI();
}

function closePenalty(){
  document.getElementById('penaltyScreen').classList.remove('active');
  penaltyLocked = false;
}

function resetPenaltyUI(){
  penaltyShot = 1;
  penaltyScore = 0;
  penaltyLocked = false;

  const startBtn = document.getElementById('penaltyStartBtn');
  const againBtn = document.getElementById('penaltyAgainBtn');
  if(startBtn) startBtn.style.display = 'inline-block';
  if(againBtn) againBtn.style.display = 'none';

  document.getElementById('penaltyShotInfo').textContent = `${penaltyShot} / ${PENALTY_TOTAL}`;
  document.getElementById('penaltyScoreInfo').textContent = `${penaltyScore}`;
  setPenaltyMessage('Press Start to begin', '');

  resetKeeperBall();
}

function startPenaltyGame(){
  penaltyShot = 1;
  penaltyScore = 0;
  penaltyLocked = false;

  const startBtn = document.getElementById('penaltyStartBtn');
  const againBtn = document.getElementById('penaltyAgainBtn');
  if(startBtn) startBtn.style.display = 'none';
  if(againBtn) againBtn.style.display = 'none';

  document.getElementById('penaltyShotInfo').textContent = `${penaltyShot} / ${PENALTY_TOTAL}`;
  document.getElementById('penaltyScoreInfo').textContent = `${penaltyScore}`;
  setPenaltyMessage('Choose where to shoot', '');

  resetKeeperBall();
}

function setPenaltyMessage(text, mood){
  const el = document.getElementById('penaltyMessage');
  el.textContent = text;
  el.classList.remove('good','bad');
  if(mood) el.classList.add(mood);
}

function resetKeeperBall(){
  const keeper = document.getElementById('keeper');
  const ball = document.getElementById('ball');
  keeper.classList.remove('dive-left','dive-centre','dive-right');
  ball.classList.remove('shoot-left','shoot-centre','shoot-right');
}

function randomZone(){
  const zones = ['left','centre','right'];
  return zones[Math.floor(Math.random()*zones.length)];
}

function applyDive(zone){
  const keeper = document.getElementById('keeper');
  keeper.classList.remove('dive-left','dive-centre','dive-right');
  keeper.classList.add(`dive-${zone}`);
}

function applyShot(zone){
  const ball = document.getElementById('ball');
  ball.classList.remove('shoot-left','shoot-centre','shoot-right');
  ball.classList.add(`shoot-${zone}`);
}

function takePenalty(playerZone){
  if(penaltyLocked) return;

  const startBtn = document.getElementById('penaltyStartBtn');
  if(startBtn && startBtn.style.display !== 'none') return;

  penaltyLocked = true;
  resetKeeperBall();

  const keeperZone = randomZone(); // Option A: pure random dive

  applyShot(playerZone);
  setTimeout(()=>applyDive(keeperZone), 80);

  const isGoal = playerZone !== keeperZone;

  playSound('whistle');

  setTimeout(()=>{
    if(isGoal){
      penaltyScore++;
      setPenaltyMessage('GOAL!!! ðŸŽ‰', 'good');
      playSound('cheer');
    }else{
      setPenaltyMessage('SAVED! ðŸ§¤', 'bad');
      playSound('crowd');
    }
    document.getElementById('penaltyScoreInfo').textContent = `${penaltyScore}`;
  }, 700);

  setTimeout(()=>{
    penaltyShot++;
    if(penaltyShot > PENALTY_TOTAL){
      finishPenaltyGame();
      return;
    }
    document.getElementById('penaltyShotInfo').textContent = `${penaltyShot} / ${PENALTY_TOTAL}`;
    setPenaltyMessage('Choose where to shoot', '');
    resetKeeperBall();
    penaltyLocked = false;
  }, 1400);
}

function finishPenaltyGame(){
  // Show final score + fun end-of-game visuals (same as Top Trumps)
  const result = (penaltyScore >= 3) ? "WINNER" : "LOSER";

  try{ noteTopTrumpsCompleted(result); }catch(e){}
  setPenaltyMessage(`Final score: ${penaltyScore} / ${PENALTY_TOTAL}`, result === "WINNER" ? "good" : "bad");


  try{ notePenaltyCompleted(penaltyScore); }catch(e){}
  // Reuse Top Trumps flash + big final overlay
  try{ showTTFlash(result); }catch(e){}
  try{ showGlobalFinal(result); }catch(e){}

  const againBtn = document.getElementById('penaltyAgainBtn');
  if(againBtn) againBtn.style.display = 'inline-block';
  penaltyLocked = true;
}

(function(){
  document.addEventListener('DOMContentLoaded', () => {
    // Homepage sign zoom
    try{ initHomeSignZoom(); }catch(e){}

    const goal = document.getElementById('penaltyGoal');
    if(!goal) return;
    goal.addEventListener('click', (e) => {
      const zoneEl = e.target.closest('.goal-zone');
      if(!zoneEl) return;
      takePenalty(zoneEl.getAttribute('data-zone'));
    });
  });
})();

/* =========================
   STRIKER'S CHOICE GAME LOGIC
========================= */


/* =========================
   GAMES MENU LOGIC
========================= */
function openGamesMenu(){
  const el = document.getElementById('gamesMenuScreen');
  if(el) el.classList.add('active');
}
function closeGamesMenu(){
  const el = document.getElementById('gamesMenuScreen');
  if(el) el.classList.remove('active');
}
function openPenaltyFromGames(){
  closeGamesMenu();
  openPenalty();
}


function futureGameToast(){
  try{ playSound('crowd'); }catch(e){}
  alert('New game coming soon! âš½âœ¨');
}

/* =========================
   TOP TRUMPS LOGIC
========================= */

// Put your player card PNGs (and card_back.png) in ./assets/images/
const TT_IMG_BASE = "./assets/images/";
const TT_CARD_BACK = "card_back.png";

const TT_CARDS = [
  // Goalkeepers (no David Raya image)
  { id: 1,  name: "Alisson", position: "Goalkeeper", team: "Liverpool", img: "alisson.png",
    stats: { Attack: 40, Speed: 65, Strength: 85, Skill: 88 } },
  { id: 2,  name: "Ederson", position: "Goalkeeper", team: "Manchester City", img: "ederson.png",
    stats: { Attack: 45, Speed: 70, Strength: 82, Skill: 90 } },
  { id: 3,  name: "Nick Pope", position: "Goalkeeper", team: "Newcastle United", img: "nick_pope.png",
    stats: { Attack: 35, Speed: 68, Strength: 88, Skill: 78 } },
  { id: 4,  name: "AndrÃ© Onana", position: "Goalkeeper", team: "Manchester United", img: "andre_onana.png",
    stats: { Attack: 42, Speed: 66, Strength: 83, Skill: 86 } },

  // Defenders
  { id: 5,  name: "Virgil van Dijk", position: "Defender", team: "Liverpool", img: "virgil_van_dijk.png",
    stats: { Attack: 70, Speed: 78, Strength: 95, Skill: 82 } },
  { id: 6,  name: "William Saliba", position: "Defender", team: "Arsenal", img: "william_saliba.png",
    stats: { Attack: 65, Speed: 80, Strength: 90, Skill: 80 } },
  { id: 7,  name: "RÃºben Dias", position: "Defender", team: "Manchester City", img: "ruben_dias.png",
    stats: { Attack: 68, Speed: 75, Strength: 92, Skill: 78 } },
  { id: 8,  name: "Gabriel MagalhÃ£es", position: "Defender", team: "Arsenal", img: "gabriel_magalhaes.png",
    stats: { Attack: 66, Speed: 74, Strength: 90, Skill: 76 } },
  { id: 9,  name: "Ben White", position: "Defender", team: "Arsenal", img: "ben_white.png",
    stats: { Attack: 72, Speed: 79, Strength: 85, Skill: 82 } },
  { id: 10, name: "Trent Alexander-Arnold", position: "Defender", team: "Liverpool", img: "trent_alexander_arnold.png",
    stats: { Attack: 85, Speed: 78, Strength: 70, Skill: 92 } },
  { id: 11, name: "Kyle Walker", position: "Defender", team: "Manchester City", img: "kyle_walker.png",
    stats: { Attack: 75, Speed: 95, Strength: 88, Skill: 78 } },
  { id: 12, name: "JoÅ¡ko Gvardiol", position: "Defender", team: "Manchester City", img: "josko_gvardiol.png",
    stats: { Attack: 73, Speed: 82, Strength: 89, Skill: 80 } },
  { id: 13, name: "Lisandro MartÃ­nez", position: "Defender", team: "Manchester United", img: "lisandro_martinez.png",
    stats: { Attack: 70, Speed: 76, Strength: 86, Skill: 84 } },
  { id: 14, name: "John Stones", position: "Defender", team: "Manchester City", img: "john_stones.png",
    stats: { Attack: 74, Speed: 77, Strength: 88, Skill: 86 } },

  // Midfielders
  { id: 15, name: "Kevin De Bruyne", position: "Midfielder", team: "Manchester City", img: "kevin_de_bruyne.png",
    stats: { Attack: 92, Speed: 82, Strength: 78, Skill: 96 } },
  { id: 16, name: "Rodri", position: "Midfielder", team: "Manchester City", img: "rodri.png",
    stats: { Attack: 78, Speed: 72, Strength: 90, Skill: 86 } },
  { id: 17, name: "Martin Ã˜degaard", position: "Midfielder", team: "Arsenal", img: "martin_odegaard.png",
    stats: { Attack: 88, Speed: 80, Strength: 70, Skill: 94 } },
  { id: 18, name: "Bruno Fernandes", position: "Midfielder", team: "Manchester United", img: "bruno_fernandes.png",
    stats: { Attack: 90, Speed: 78, Strength: 75, Skill: 92 } },
  { id: 19, name: "Declan Rice", position: "Midfielder", team: "Arsenal", img: "declan_rice.png",
    stats: { Attack: 80, Speed: 77, Strength: 88, Skill: 82 } },
  { id: 20, name: "Bernardo Silva", position: "Midfielder", team: "Manchester City", img: "bernardo_silva.png",
    stats: { Attack: 86, Speed: 83, Strength: 72, Skill: 95 } },
  { id: 21, name: "Phil Foden", position: "Midfielder", team: "Manchester City", img: "phil_foden.png",
    stats: { Attack: 89, Speed: 88, Strength: 70, Skill: 93 } },
  { id: 22, name: "James Maddison", position: "Midfielder", team: "Tottenham Hotspur", img: "james_maddison.png",
    stats: { Attack: 87, Speed: 79, Strength: 72, Skill: 91 } },
  { id: 23, name: "Alexis Mac Allister", position: "Midfielder", team: "Liverpool", img: "alexis_mac_allister.png",
    stats: { Attack: 84, Speed: 76, Strength: 74, Skill: 88 } },
  { id: 24, name: "Enzo FernÃ¡ndez", position: "Midfielder", team: "Chelsea", img: "enzo_fernandez.png",
    stats: { Attack: 82, Speed: 75, Strength: 76, Skill: 89 } },

  // Forwards
  { id: 25, name: "Erling Haaland", position: "Forward", team: "Manchester City", img: "erling_haaland.png",
    stats: { Attack: 99, Speed: 90, Strength: 95, Skill: 88 } },
  { id: 26, name: "Mohamed Salah", position: "Forward", team: "Liverpool", img: "mohamed_salah.png",
    stats: { Attack: 94, Speed: 92, Strength: 78, Skill: 91 } },
  { id: 27, name: "Bukayo Saka", position: "Forward", team: "Arsenal", img: "bukayo_saka.png",
    stats: { Attack: 90, Speed: 88, Strength: 76, Skill: 89 } },
  { id: 28, name: "Son Heung-min", position: "Forward", team: "Tottenham Hotspur", img: "son_heung_min.png",
    stats: { Attack: 93, Speed: 90, Strength: 77, Skill: 90 } },
  { id: 29, name: "Ollie Watkins", position: "Forward", team: "Aston Villa", img: "ollie_watkins.png",
    stats: { Attack: 88, Speed: 87, Strength: 82, Skill: 84 } },
];

const TT_STAT_KEYS = ["Attack", "Speed", "Strength", "Skill"];

let ttState = null;

// --- UI helpers
function openTopTrumps(){
  document.getElementById('topTrumpsScreen').classList.add('active');
  resetTopTrumpsUI();
}

function closeTopTrumps(){
  document.getElementById('topTrumpsScreen').classList.remove('active');
  ttState = null;
}

function resetTopTrumpsUI(){
  setTTMessage("Press Start to begin", "");
  const startBtn = document.getElementById("ttStartBtn");
  const nextBtn  = document.getElementById("ttNextBtn");
  if(startBtn) startBtn.style.display = "inline-block";
  if(nextBtn)  nextBtn.style.display  = "none";

  // reset scoreboard
  setTTScore(0, 0, 0);

  // blank splash (use card back for both)
  setTTCardFacing("you", TT_CARD_BACK);
  setTTCardFacing("opp", TT_CARD_BACK);
  setTTCardName("you","Your card");
  setTTCardName("opp","Opponent card");

  // No masks on the card backs
  setTTMasksVisible(false, false);

  // buttons
  renderTTChoiceButtons(false);
}

function setTTMessage(text, mood){
  const el = document.getElementById("ttMessage");
  if(!el) return;
  el.textContent = text;
  el.classList.remove("good","bad");
  if(mood) el.classList.add(mood);
}

function setTTScore(youPts, oppPts, roundNum){
  const you = document.getElementById("ttYouCount");
  const opp = document.getElementById("ttCpuCount");
  const rnd = document.getElementById("ttPotCount");
  if(you) you.textContent = String(youPts);
  if(opp) opp.textContent = String(oppPts);
  if(rnd) rnd.textContent = `${roundNum} / 10`;
}

function setTTCardName(side, text){
  const el = document.getElementById(side === "you" ? "ttYouName" : "ttCpuName");
  if(el) el.textContent = text;
}

function safeSetImg(imgEl, filename){
  if(!imgEl) return;
  const url = TT_IMG_BASE + filename;
  imgEl.onerror = () => {
    // If an image filename is wrong/missing, fall back to card back instead of breaking the round
    imgEl.onerror = null;
    imgEl.src = TT_IMG_BASE + TT_CARD_BACK;
  };
  imgEl.src = url;
}

function setTTCardFacing(side, filename){
  const img = document.getElementById(side === "you" ? "ttYouImg" : "ttCpuImg");
  safeSetImg(img, filename);
}

function setTTMasksVisible(youMaskOn, oppMaskOn){
  // Backwards compatible: if only one arg is passed, apply to both
  if (typeof oppMaskOn === "undefined") oppMaskOn = youMaskOn;

  const youMasks = document.querySelectorAll("#ttYouCard .tt-mask");
  const oppMasks = document.querySelectorAll("#ttCpuCard .tt-mask");

  youMasks.forEach(m => m.style.opacity = youMaskOn ? "1" : "0");
  oppMasks.forEach(m => m.style.opacity = oppMaskOn ? "1" : "0");
}

function setTTFlipping(isFlipping){
  const youCard = document.getElementById("ttYouCard");
  const oppCard = document.getElementById("ttCpuCard");
  if(youCard) youCard.classList.toggle("flipping", isFlipping);
  if(oppCard) oppCard.classList.toggle("flipping", isFlipping);
}

function renderTTChoiceButtons(enabled){
  const wrap = document.getElementById("ttStatButtons");
  if(!wrap) return;
  wrap.innerHTML = "";
  TT_STAT_KEYS.forEach(k => {
    const btn = document.createElement("button");
    btn.className = "tt-statbtn";
    btn.textContent = k;
    btn.disabled = !enabled;
    btn.onclick = () => chooseTTStat(k);
    wrap.appendChild(btn);
  });
}

// --- game setup
function shuffleTT(arr){
  const a = [...arr];
  for(let i=a.length-1;i>0;i--) {
    const j = Math.floor(Math.random()*(i+1));
    [a[i],a[j]] = [a[j],a[i]];
  }
  return a;
}

function createTTGame(deck){
  const shuffled = shuffleTT(deck);

  // Deal alternately so each side has a deck to draw from
  const youDeck = [];
  const oppDeck = [];
  for(let i=0;i<shuffled.length;i++) {
    (i%2===0 ? youDeck : oppDeck).push(shuffled[i]);
  }

  return {
    youDeck,
    oppDeck,
    round: 0,
    maxRounds: 10,
    youPts: 0,
    oppPts: 0,
    youCard: null,
    oppCard: null,
    locked: false,
    lastChoice: null
  };
}

function startTopTrumps(){
  ttState = createTTGame(TT_CARDS);
  const startBtn = document.getElementById("ttStartBtn");
  const nextBtn  = document.getElementById("ttNextBtn");
  if(startBtn) startBtn.style.display = "none";
  if(nextBtn)  nextBtn.style.display  = "none";
  nextTopTrumpsRound(true);
}

function nextTopTrumpsRound(isFirst=false){
  if(!ttState) return;

  // End if we hit 10 rounds
  if(ttState.round >= ttState.maxRounds) {
    endTopTrumpsGame();
    return;
  }

  // If either deck runs out, end early (rare but possible)
  if(ttState.youDeck.length === 0 || ttState.oppDeck.length === 0) {
    endTopTrumpsGame();
    return;
  }

  // Draw top cards
  ttState.youCard = ttState.youDeck[0];
  ttState.oppCard = ttState.oppDeck[0];

  ttState.round += 1;
  ttState.locked = false;
  ttState.lastChoice = null;

  // show card faces (but hide printed info with masks)
  setTTCardFacing("you", ttState.youCard.img);
  setTTCardFacing("opp", ttState.oppCard.img);

  setTTCardName("you", `${ttState.youCard.name} â€¢ ${ttState.youCard.position}`);
  setTTCardName("opp", `${ttState.oppCard.name} â€¢ Opponent`);

  // Show YOUR card fully, hide CPU printed name/stats until reveal
  setTTMasksVisible(false, true);

  setTTScore(ttState.youPts, ttState.oppPts, ttState.round);
  setTTMessage(isFirst ? "Pick an attribute (values hidden!)" : "Pick an attribute", "");

  // enable choice buttons
  renderTTChoiceButtons(true);

  const nextBtn = document.getElementById("ttNextBtn");
  if(nextBtn) nextBtn.style.display = "none";
}

function chooseTTStat(statKey){
  if(!ttState || ttState.locked) return;
  ttState.locked = true;
  ttState.lastChoice = statKey;

  // disable buttons immediately
  renderTTChoiceButtons(false);

  setTTMessage(`You chose ${statKey}â€¦`, "");

  // Flip both cards down
  setTTFlipping(true);
  setTimeout(() => {
    setTTCardFacing("you", TT_CARD_BACK);
    setTTCardFacing("opp", TT_CARD_BACK);
  }, 200);

  // Pause 2 seconds total, then flip up + reveal stats
  setTimeout(() => {
    // Flip up (swap src back)
    setTTCardFacing("you", ttState.youCard.img);
    setTTCardFacing("opp", ttState.oppCard.img);

    // reveal printed areas (CPU + you)
    setTTMasksVisible(false, false);

    // remove flip class after transition
    setTimeout(() => setTTFlipping(false), 420);

    // Decide winner + score
    const youVal = ttState.youCard.stats[statKey];
    const oppVal = ttState.oppCard.stats[statKey];

    // Remove the drawn cards from decks
    ttState.youDeck.shift();
    ttState.oppDeck.shift();

    if(youVal > oppVal) {
      ttState.youPts += 1;
      setTTMessage(`You win the round! (${statKey} ${youVal} vs ${oppVal})`, "good");
      playSound && playSound("cheer");
      showTTFlash("WINNER");
      burstConfetti(1400, 120);
    } else if(oppVal > youVal) {
      ttState.oppPts += 1;
      setTTMessage(`You lose the round. (${statKey} ${youVal} vs ${oppVal})`, "bad");
      playSound && playSound("crowd");
      showTTFlash("LOSER");
    } else {
      setTTMessage(`Draw! (${statKey} ${youVal} vs ${oppVal})`, "");
      playSound && playSound("whistle");
      showTTFlash("DRAW");
    }

    setTTScore(ttState.youPts, ttState.oppPts, ttState.round);

    // Show Next Round button
    const nextBtn = document.getElementById("ttNextBtn");
    if(nextBtn) nextBtn.style.display = "inline-block";

    // If this was round 10, show final result after a short delay
    if(ttState.round >= ttState.maxRounds) {
      setTimeout(endTopTrumpsGame, 800);
    }
  }, 2000);
}


function burstConfetti(durationMs=1400, pieces=120){
  const host = document.getElementById("confettiContainer");
  if(!host) return;
  // clear any leftovers
  host.innerHTML = "";
  const colors = ["#ff6b35","#ffd166","#06d6a0","#118ab2","#ef476f","#ffffff"];
  const vw = Math.max(document.documentElement.clientWidth || 0, window.innerWidth || 0);
  for(let i=0;i<pieces;i++){
    const d = document.createElement("div");
    d.className = "confetti";
    d.style.left = Math.floor(Math.random()*vw) + "px";
    d.style.background = colors[Math.floor(Math.random()*colors.length)];
    const size = 6 + Math.random()*10;
    d.style.width = size + "px";
    d.style.height = (size*1.3) + "px";
    d.style.animationDuration = (800 + Math.random()*900) + "ms";
    d.style.animationDelay = (Math.random()*150) + "ms";
    d.style.opacity = (0.6 + Math.random()*0.4).toFixed(2);
    host.appendChild(d);
  }
  setTimeout(()=>{ host.innerHTML=""; }, durationMs);
}

function showGlobalFinal(result){
  const el = document.getElementById("ttFinal");
  if(!el) return;

  el.textContent = (result === "DRAW") ? "DRAW" : (result === "WINNER" ? "WINNER!" : "LOSER!");
  el.style.display = "flex";
  el.classList.remove("win","lose","draw");
  if(result === "WINNER") el.classList.add("win");
  if(result === "LOSER") el.classList.add("lose");
  if(result === "DRAW") el.classList.add("draw");

  // Sounds + confetti (winner only) to match Top Trumps feel
  if(result === "WINNER") { try{ playSound && playSound("cheer"); }catch(e){} burstConfetti(3000, 220); }
  else if(result === "LOSER") { try{ playSound && playSound("crowd"); }catch(e){} }
  else { try{ playSound && playSound("whistle"); }catch(e){} }

  setTimeout(()=>{ el.style.display = "none"; }, 2600);
}


function showTTFlash(text){
  const el = document.getElementById("ttFlash");
  if(!el) return;
  el.textContent = text;
  el.style.display = "block";
  el.classList.remove("win","lose","draw");
  if(text === "WINNER") el.classList.add("win");
  if(text === "LOSER") el.classList.add("lose");
  if(text === "DRAW") el.classList.add("draw");

  setTimeout(() => {
    el.style.display = "none";
  }, 900);
}

function endTopTrumpsGame(){
  if(!ttState) return;

  const result = ttState.youPts > ttState.oppPts ? "WINNER" : (ttState.oppPts > ttState.youPts ? "LOSER" : "DRAW");

  // big final overlay for 3 seconds
  const el = document.getElementById("ttFinal");
  if(el) {
    el.textContent = result === "DRAW" ? "DRAW" : (result === "WINNER" ? "WINNER!" : "LOSER!");
    el.style.display = "flex";
    el.classList.remove("win","lose","draw");
    if(result === "WINNER") el.classList.add("win");
    if(result === "LOSER") el.classList.add("lose");
    if(result === "DRAW") el.classList.add("draw");
  }

  if(result === "WINNER") { playSound && playSound("cheer"); burstConfetti(3000, 220); }
  else if(result === "LOSER") playSound && playSound("crowd");
  else playSound && playSound("whistle");

  setTimeout(() => {
    if(el) el.style.display = "none";
    // Reset to splash so Start is visible again
    resetTopTrumpsUI();
  }, 3000);
}


/* =========================
   TROPHY CABINET LOGIC
========================= */
function openTrophyCabinet(){
  const screen = document.getElementById('trophyCabinetScreen');
  if(screen) screen.classList.add('active');

  
  populateTrophyGrid();
  startChampionsAudio();
// Start audio on user gesture (this click) - browsers allow it
  const audio = document.getElementById('championsAudio');
  if(audio){
    try{
      audio.currentTime = 0;
      const p = audio.play();
      if(p && typeof p.catch === 'function') p.catch(()=>{});
    }catch(e){}
  }
}

function closeTrophyCabinet(){
  const screen = document.getElementById('trophyCabinetScreen');
  if(screen) screen.classList.remove('active');

  
  stopChampionsAudio();
const audio = document.getElementById('championsAudio');
  if(audio){
    try{ audio.pause(); }catch(e){}
  }
}

function openTrophyLightbox(src){
  const lb = document.getElementById('trophyLightbox');
  const img = document.getElementById('trophyLightboxImg');
  if(img) img.src = src;
  if(lb) lb.classList.add('active');
}

function closeTrophyLightbox(){
  const lb = document.getElementById('trophyLightbox');
  if(lb) lb.classList.remove('active');
}


function populateTrophyGrid(){
  const grid = document.getElementById('trophyGrid');
  if(!grid) return;
  if(grid.dataset.built === "1") return;
  grid.dataset.built = "1";
  // Builds Champ (1).jpg ... Champ (26).jpg
  for(let i=1;i<=26;i++){
    const img = document.createElement('img');
    img.className = 'trophy-img';
    img.loading = 'lazy';
    img.src = `assets/images/champions/Champ (${i}).jpg`;
    img.alt = `Champ (${i}).jpg`;
    img.onclick = ()=> openTrophyLightbox(img.src);
    grid.appendChild(img);
  }
}

function startChampionsAudio(){
  const a = document.getElementById('championsAudio');
  if(!a) return;
  a.currentTime = 0;
  a.loop = true;
  a.volume = 0.8;
  a.play().catch(()=>{/* autoplay may be blocked */});
}

function stopChampionsAudio(){
  const a = document.getElementById('championsAudio');
  if(!a) return;
  a.pause();
  a.currentTime = 0;
}

/* Try to autoplay the club song on app open (may be blocked until first tap) */
function tryAutoPlayClubSong(){
  const a = document.getElementById('clubSong');
  if(!a) return;
  a.loop = true;
  a.volume = 0.6;
  const tryPlay = ()=> a.play().catch(()=>{});
  tryPlay();
  // If blocked, first user interaction will start it.
  const unlock = ()=>{
    tryPlay();
    window.removeEventListener('pointerdown', unlock);
    window.removeEventListener('keydown', unlock);
  };
  window.addEventListener('pointerdown', unlock, {once:true});
  window.addEventListener('keydown', unlock, {once:true});
}

document.addEventListener('DOMContentLoaded', tryAutoPlayClubSong);


/* Responsive viewport height fix (mobile address bar) */
(function(){
  const setVH = () => {
    const vh = window.innerHeight * 0.01;
    document.documentElement.style.setProperty('--vh', `${vh}px`);
  };
  setVH();
  window.addEventListener('resize', setVH);
})();

/* clubSongAutostop */
(function(){
  const song = document.getElementById("clubSong");
  if(!song) return;
  // ensure it plays only once
  song.loop = false;
  song.addEventListener("ended", ()=>{ 
    try{ song.pause(); song.currentTime = 0; }catch(e){} 
  });
})();


    // Wire Offside Trainer menu buttons (fallback in case inline handlers are blocked)
    document.addEventListener('DOMContentLoaded', () => {
      const playBtn = document.getElementById('offsidePlayBtn');
      const learnBtn = document.getElementById('offsideLearnBtn');
      if (playBtn) playBtn.addEventListener('click', () => { startOffsideGame(); playSound('whistle'); });
      if (learnBtn) learnBtn.addEventListener('click', () => { openOffsideLearn(); playSound('whistle'); });
    });



/* =========================
   PLAYER PROGRESS (XP + Weekly Challenges)
========================= */
const HJ_PROFILE_KEY = "hjfc_profile_v1";

function isoWeekKey(d=new Date()){
  // ISO week year-week string
  const date = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()));
  const dayNum = date.getUTCDay() || 7;
  date.setUTCDate(date.getUTCDate() + 4 - dayNum);
  const yearStart = new Date(Date.UTC(date.getUTCFullYear(),0,1));
  const weekNo = Math.ceil((((date - yearStart) / 86400000) + 1) / 7);
  return `${date.getUTCFullYear()}-W${String(weekNo).padStart(2,"0")}`;
}

function getProfile(){
  try{
    const raw = localStorage.getItem(HJ_PROFILE_KEY);
    if(raw){
      const p = JSON.parse(raw);
      return normalizeProfile(p);
    }
  }catch(e){}
  return normalizeProfile({});
}

function normalizeProfile(p){
  const now = new Date();
  const weekKey = isoWeekKey(now);
  const base = {
    xp: 0,
    level: 1,
    streak: { count: 0, lastDate: null },
    trophies: Array.isArray(p.trophies) ? p.trophies : (p.trophies ? p.trophies : []),
    weekly: { weekKey, progress: {} },
    stats: { quizzes:0, quizBest:0, penalties:0, toptrumps:0, offside:0 }
  };
  const out = Object.assign(base, p || {});
  if(!out.streak) out.streak = base.streak;
  if(!out.weekly) out.weekly = { weekKey, progress:{} };
  if(out.weekly.weekKey !== weekKey){
    // new week -> reset progress
    out.weekly = { weekKey, progress:{} };
  }
  if(!out.stats) out.stats = base.stats;
  if(!out.trophies) out.trophies = [];
  // level derived from xp
  const lv = calcLevelFromXP(out.xp || 0);
  out.level = lv.level;
  return out;
}

function saveProfile(p){
  try{ localStorage.setItem(HJ_PROFILE_KEY, JSON.stringify(p)); }catch(e){}
}

function xpForNextLevel(level){ return 200 + (level-1)*120; } // ramps gently

function calcLevelFromXP(xp){
  let level = 1;
  let remaining = Math.max(0, xp|0);
  while(true){
    const need = xpForNextLevel(level);
    if(remaining >= need){
      remaining -= need;
      level += 1;
      continue;
    }
    return { level, inLevelXP: remaining, need };
  }
}

function toastXP(text){
  const t = document.getElementById("xpToast");
  if(!t) return;
  t.textContent = text;
  t.style.display = "block";
  clearTimeout(window.__xpToastTimer);
  window.__xpToastTimer = setTimeout(()=>{ t.style.display="none"; }, 1600);
}

function touchStreak(p){
  const today = new Date();
  const todayKey = today.toISOString().slice(0,10);

  if(!p.streak) p.streak = { count:0, lastDate:null };
  const last = p.streak.lastDate;

  if(!last){
    p.streak.count = 1;
    p.streak.lastDate = todayKey;
    return;
  }
  if(last === todayKey) return; // already counted today

  // check if yesterday
  const y = new Date(today); y.setDate(today.getDate()-1);
  const yKey = y.toISOString().slice(0,10);

  if(last === yKey){
    p.streak.count = (p.streak.count||0) + 1;
  }else{
    p.streak.count = 1;
  }
  p.streak.lastDate = todayKey;
}

const WEEKLY_CHALLENGES = [
  { id:"play_quiz", title:"Quiz Warmâ€‘Up", desc:"Play any quiz topic 1 time.", goal:1, xp:60, trophy:"Quiz Starter" },
  { id:"quiz_7plus", title:"Smart Boots", desc:"Score 7/10 or higher in a quiz.", goal:1, xp:90, trophy:"Quiz Ace" },
  { id:"penalty_3plus", title:"Clinical Finisher", desc:"Score 3+ in Penalty Shootout.", goal:1, xp:80, trophy:"Penalty Pro" },
  { id:"tt_win", title:"Top Trumps Champ", desc:"Win a Top Trumps match.", goal:1, xp:110, trophy:"Card King" },
  { id:"offside_streak3", title:"Linesman Eyes", desc:"Get a 3â€‘correct streak in Offside Trainer.", goal:1, xp:90, trophy:"Offside Expert" },
];

function getWeeklyProgress(p){
  if(!p.weekly) p.weekly = { weekKey: isoWeekKey(new Date()), progress:{} };
  if(!p.weekly.progress) p.weekly.progress = {};
  return p.weekly.progress;
}

function markProgress(chId, delta=1){
  const p = getProfile();
  touchStreak(p);

  const prog = getWeeklyProgress(p);
  prog[chId] = (prog[chId] || 0) + delta;

  saveProfile(p);
  refreshProgressUI();
  refreshChallengesUI();
}

function isChallengeComplete(p, ch){
  const prog = getWeeklyProgress(p)[ch.id] || 0;
  return prog >= ch.goal;
}

function awardChallengeIfComplete(p, ch){
  const progVal = getWeeklyProgress(p)[ch.id] || 0;
  if(progVal < ch.goal) return false;

  // prevent double-claim by storing claimed flag in weekly progress
  const claimedKey = ch.id + "_claimed";
  const prog = getWeeklyProgress(p);
  if(prog[claimedKey]) return false;

  prog[claimedKey] = true;
  const beforeLevel = p.level;

  p.xp = (p.xp || 0) + (ch.xp || 0);
  const lv = calcLevelFromXP(p.xp);
  p.level = lv.level;

  if(ch.trophy){
    tryAwardTrophy(p, ch.trophy);
  }

  saveProfile(p);
  refreshProgressUI();
  refreshChallengesUI();

  toastXP(`ðŸŽ¯ Challenge complete! +${ch.xp} XP`);
  if(p.level > beforeLevel) toastXP(`ðŸš€ Level up! Youâ€™re Level ${p.level}`);

  return true;
}

function awardXP(amount, reason=""){
  const a = Math.max(0, Math.round(amount || 0));
  if(!a) return;

  const p = getProfile();
  touchStreak(p);

  const beforeLevel = p.level;
  p.xp = (p.xp || 0) + a;

  const lv = calcLevelFromXP(p.xp);
  p.level = lv.level;

  saveProfile(p);
  refreshProgressUI();
  refreshChallengesUI();

  toastXP(`+${a} XP${reason ? " â€¢ " + reason : ""}`);
  if(p.level > beforeLevel) toastXP(`ðŸš€ Level up! Youâ€™re Level ${p.level}`);
}

function tryAwardTrophy(p, name){
  if(!name) return;
  if(!Array.isArray(p.trophies)) p.trophies = [];
  if(p.trophies.includes(name)) return;

  p.trophies.push(name);

  // If the Trophy Cabinet uses localStorage too, mirror into it.
  try{
    const raw = localStorage.getItem("hjfc_trophies");
    const arr = raw ? JSON.parse(raw) : [];
    if(Array.isArray(arr) && !arr.includes(name)){
      arr.push(name);
      localStorage.setItem("hjfc_trophies", JSON.stringify(arr));
    }
  }catch(e){}
}

function refreshProgressUI(){
  const p = getProfile();
  const lv = calcLevelFromXP(p.xp || 0);

  const levelText = document.getElementById("xpLevelText");
  const xpCountText = document.getElementById("xpCountText");
  const fill = document.getElementById("xpMeterFill");
  const nextText = document.getElementById("xpNextText");

  if(levelText) levelText.textContent = `Level ${lv.level}`;
  if(xpCountText) xpCountText.textContent = `${p.xp || 0} XP`;

  const pct = lv.need ? Math.max(0, Math.min(100, (lv.inLevelXP / lv.need) * 100)) : 0;
  if(fill) fill.style.width = pct.toFixed(1) + "%";
  if(nextText) nextText.textContent = `${lv.inLevelXP} / ${lv.need} to next level`;
}

function openChallenges(){
  const el = document.getElementById("challengesScreen");
  if(el) el.classList.add("active");
  refreshChallengesUI();
}
function closeChallenges(){
  const el = document.getElementById("challengesScreen");
  if(el) el.classList.remove("active");
}

function refreshChallengesUI(){
  const p = getProfile();
  const lv = calcLevelFromXP(p.xp || 0);

  const elLv = document.getElementById("chalLevel");
  const elXp = document.getElementById("chalXP");
  const elSt = document.getElementById("chalStreak");
  if(elLv) elLv.textContent = String(lv.level);
  if(elXp) elXp.textContent = String(p.xp || 0);
  if(elSt) elSt.textContent = String((p.streak && p.streak.count) ? p.streak.count : 0);

  const grid = document.getElementById("chalGrid");
  if(!grid) return;

  const prog = getWeeklyProgress(p);
  grid.innerHTML = "";

  WEEKLY_CHALLENGES.forEach(ch => {
    const val = prog[ch.id] || 0;
    const claimed = !!prog[ch.id + "_claimed"];
    const done = val >= ch.goal;
    const pct = Math.max(0, Math.min(100, (val / ch.goal) * 100));

    const card = document.createElement("div");
    card.className = "chal-card";
    card.innerHTML = `
      <div class="chal-title">${done ? "âœ… " : "ðŸŽ¯ "}${ch.title}</div>
      <div class="chal-desc">${ch.desc}</div>
      <div class="chal-bar" aria-label="Challenge progress"><div style="width:${pct.toFixed(1)}%"></div></div>
      <div class="chal-meta">
        <span>${Math.min(val, ch.goal)} / ${ch.goal}</span>
        <span>${claimed ? "Claimed" : (done ? `Claim +${ch.xp} XP` : `+${ch.xp} XP`)}</span>
      </div>
    `;

    if(done && !claimed){
      card.style.cursor = "pointer";
      card.addEventListener("click", () => {
        const p2 = getProfile();
        awardChallengeIfComplete(p2, ch);
      });
    }else{
      card.style.opacity = done ? 0.95 : 1;
    }

    grid.appendChild(card);
  });
}

// Hook into DOMContentLoaded without breaking existing listeners
(function(){
  document.addEventListener("DOMContentLoaded", () => {
    refreshProgressUI();
    refreshChallengesUI();
  });
})();

/* =========================
   PROGRESS HOOKS (award XP + challenge progress)
========================= */
function noteQuizCompleted(score, total){
  const p = getProfile();
  p.stats.quizzes = (p.stats.quizzes||0) + 1;
  p.stats.quizBest = Math.max(p.stats.quizBest||0, score||0);
  saveProfile(p);

  markProgress("play_quiz", 1);
  if((score||0) >= 7) markProgress("quiz_7plus", 1);

  // XP: base + accuracy bonus
  const base = 30;
  const per = 8;
  const bonus = (score||0) >= 9 ? 25 : ((score||0) >= 7 ? 12 : 0);
  awardXP(base + (score||0)*per + bonus, "Quiz");
}

function notePenaltyCompleted(finalScore){
  const p = getProfile();
  p.stats.penalties = (p.stats.penalties||0) + 1;
  saveProfile(p);

  if((finalScore||0) >= 3) markProgress("penalty_3plus", 1);

  awardXP(25 + (finalScore||0)*15, "Penalties");
}

function noteTopTrumpsCompleted(result){
  const p = getProfile();
  p.stats.toptrumps = (p.stats.toptrumps||0) + 1;
  saveProfile(p);

  if(result === "WINNER") markProgress("tt_win", 1);

  awardXP(result === "WINNER" ? 110 : (result === "DRAW" ? 65 : 40), "Top Trumps");
}

function noteOffsideCorrect(streak){
  const p = getProfile();
  p.stats.offside = (p.stats.offside||0) + 1;
  saveProfile(p);

  awardXP(8, "Offside");
  if((streak||0) >= 3) markProgress("offside_streak3", 1);
}


/* =========================
   POSITION ACADEMY LOGIC
========================= */
const POS_DATA = {
  GK: {
    title:"ðŸ§¤ Goalkeeper",
    tips:[
      "Hands ready (W shape) â€¢ Catch or parry away from danger.",
      "Set position: knees bent, weight forward, eyes on the ball.",
      "Talk! Shout 'AWAY!' 'TIME!' 'MAN ON!' to help your team."
    ],
    videos:[
      {t:"Handling basics", url:"https://youtu.be/k1i6kWXi2Ls"},
      {t:"Diving technique", url:"https://youtu.be/TPt1yU3AQg0"}
    ],
    quiz:[
      {q:"Where should your hands be when youâ€™re ready to catch?", a:"In front, ready (W shape)", c:["Down by your sides","In front, ready (W shape)","Behind your back"]},
      {q:"Best place to push a strong shot if you canâ€™t catch it?", a:"Wide, away from goal", c:["Back into the middle","Wide, away from goal","Straight up and hope"]},
      {q:"What should keepers do a lot?", a:"Communicate to teammates", c:["Stay silent","Communicate to teammates","Never move"]},
    ],
    scenario:{q:"Cross comes in. A teammate is close. What do you shout?", a:"KEEPER!", c:["Nothing","KEEPER!","Nice one mate"]}
  },
  DEF: {
    title:"ðŸ›¡ Defender",
    tips:[
      "Stay side-on, low and balanced. Show them away from goal.",
      "Donâ€™t dive inâ€”wait for a heavy touch.",
      "If in doubt: clear it wide (not into the middle!)."
    ],
    videos:[
      {t:"1v1 defending", url:"https://youtu.be/Xhn3OtXsHgE"},
      {t:"Tackling timing", url:"https://youtu.be/0pC2xwU72gw"}
    ],
    quiz:[
      {q:"When is the best time to tackle?", a:"When they take a heavy touch", c:["As soon as you see them","When they take a heavy touch","Never tackle"]},
      {q:"Where should you try to force the attacker?", a:"Towards the side line", c:["Towards your goal","Towards the side line","Into the middle"]},
      {q:"If you clear the ball, safest direction isâ€¦", a:"Wide", c:["Straight up the middle","Wide","Back towards your goal"]},
    ],
    scenario:{q:"Youâ€™re 1v1 near your box. Whatâ€™s the key?", a:"Stay patient and donâ€™t dive in", c:["Slide tackle instantly","Stay patient and donâ€™t dive in","Turn your back"]}
  },
  MID: {
    title:"ðŸŽ¯ Midfielder",
    tips:[
      "Scan before you receive: look left/right so you know your next pass.",
      "Use simple passes: play to feet or into space.",
      "Help both ways: win it, then keep it."
    ],
    videos:[
      {t:"Scanning & awareness", url:"https://youtu.be/4-jOdpR_TQw"},
      {t:"Passing practice", url:"https://youtu.be/deMrJtWkiZs"}
    ],
    quiz:[
      {q:"Why should midfielders scan?", a:"To know options before the ball arrives", c:["So you look cool","To know options before the ball arrives","To ignore teammates"]},
      {q:"A safe pass is usuallyâ€¦", a:"To feet or into space away from danger", c:["A risky one every time","To feet or into space away from danger","Always backwards"]},
      {q:"Midfielders should helpâ€¦", a:"Attack and defence", c:["Only attack","Only defence","Attack and defence"]},
    ],
    scenario:{q:"You receive with a marker close. Best first idea?", a:"One-touch pass if possible", c:["Hold it forever","One-touch pass if possible","Kick it randomly"]}
  },
  STR: {
    title:"âš¡ Striker",
    tips:[
      "Move off the defender: check away then dart in.",
      "Shoot early when youâ€™re in spaceâ€”donâ€™t over-dribble.",
      "Finish: inside foot for accuracy, laces for power."
    ],
    videos:[
      {t:"Finishing basics", url:"https://youtu.be/SHBNBBdyYkA"},
      {t:"Movement & timing", url:"https://youtu.be/Oe5SFSCAc6w"}
    ],
    quiz:[
      {q:"Best type of shot for accuracy?", a:"Inside of your foot", c:["Outside of the boot always","Inside of your foot","Your knee"]},
      {q:"A good striker shouldâ€¦", a:"Move to lose defenders", c:["Stand still","Move to lose defenders","Hide behind the keeper"]},
      {q:"When youâ€™re through on goal, often best isâ€¦", a:"Shoot early when youâ€™re set", c:["Wait forever","Shoot early when youâ€™re set","Turn back to halfway"]},
    ],
    scenario:{q:"Cross is coming. Where do you attack?", a:"Front or back post run", c:["Stay outside the box","Front or back post run","Run away from goal"]}
  }
};

let POS_CURRENT = null;


/* === Overlay visibility hardening (Chromebook/Chrome) === */
function forceShowOverlayById(id){
  const el = document.getElementById(id);
  if(!el){
    console.warn("Missing overlay element:", id);
    alert("Missing screen: " + id + " (overlay not found in HTML)");
    return false;
  }

  // If a splash layer exists, hide it so it canâ€™t sit above overlays.
  const splash = document.getElementById("splash");
  if(splash) splash.style.display = "none";

  // Make sure the overlay is the *last* element in <body> (top of paint order)
  try{
    if(el.parentElement !== document.body){
      document.body.appendChild(el);
    }else{
      document.body.appendChild(el); // re-append to move to end
    }
  }catch(e){}

  el.classList.add("active");

  // Hard-force visibility & stacking (Chromebook/Chrome-safe)
  el.style.position = "fixed";
  el.style.inset = "0";
  el.style.display = "flex";
  el.style.opacity = "1";
  el.style.visibility = "visible";
  el.style.pointerEvents = "auto";
  el.style.zIndex = "2147483647"; // max 32-bit int
  return true;
}

function forceHideOverlayById(id){
  const el = document.getElementById(id);
  if(!el) return;
  el.classList.remove("active");
  el.style.display = "";
  el.style.opacity = "";
  el.style.visibility = "";
  el.style.pointerEvents = "";
  el.style.zIndex = "";
  el.style.position = "";
  el.style.inset = "";
}

function openPositionAcademy(){
  const p = (typeof getProfile === "function") ? getProfile() : {xp:0,level:1,trophies:[]};
  const lvl = document.getElementById("posLevel");
  const xp = document.getElementById("posXP");
  const bdg = document.getElementById("posBadges");
  if(lvl) lvl.textContent = String(p.level||1);
  if(xp) xp.textContent = String(p.xp||0);
  if(bdg) bdg.textContent = String((p.trophies||[]).length);
  forceShowOverlayById("positionAcademyScreen");
}
function closePositionAcademy(){
  forceHideOverlayById("positionAcademyScreen");
}
function backToPositionAcademy(){
  // Use hardened overlay toggles so the detail screen canâ€™t end up â€œbehindâ€ home on Chromebooks
  forceHideOverlayById("positionDetailScreen");
  // refresh top stats
  const p = (typeof getProfile === "function") ? getProfile() : {xp:0,trophies:[]};
  const xpEl = document.getElementById("posXP");
  const bdgEl = document.getElementById("posBadges");
  if(xpEl) xpEl.textContent = String(p.xp||0);
  if(bdgEl) bdgEl.textContent = String((p.trophies||[]).length);
  forceShowOverlayById("positionAcademyScreen");
}

function ytThumb(url){
  const m = url.match(/youtu\.be\/([A-Za-z0-9_\-]+)/);
  const id = m ? m[1] : "";
  return id ? `https://i.ytimg.com/vi/${id}/maxresdefault.jpg` : "";
}
function escapeHtml(str){
  return String(str).replace(/[&<>"']/g, s=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;" }[s]));
}

function openPositionDetail(key){
  POS_CURRENT = key;
  const d = POS_DATA[key];
  if(!d) return;

  // Hardened overlay toggles (prevents â€œopened but hidden behind homeâ€)
  forceHideOverlayById("positionAcademyScreen");
  forceShowOverlayById("positionDetailScreen");

  const p = (typeof getProfile === "function") ? getProfile() : {xp:0};
  document.getElementById("posTitle").textContent = d.title;
  document.getElementById("posXP2").textContent = String(p.xp||0);
  document.getElementById("posQuizScore").textContent = "0/3";
  document.getElementById("posScenarioScore").textContent = "0/1";
  const result = document.getElementById("posResult");
  if(result){ result.style.display="none"; result.textContent=""; }

  const tips = document.getElementById("posTips");
  if(tips) tips.innerHTML = d.tips.map(t=>`<span class="pos-pill">â­ ${t}</span>`).join("");

  const vids = document.getElementById("posVideos");
  if(vids) vids.innerHTML = d.videos.map(v=>`
    <button class="pos-vthumb" onclick="window.open('${v.url}','_blank')">
      <img src="${ytThumb(v.url)}" alt="${escapeHtml(v.t)}">
      <div class="cap">â–¶ ${escapeHtml(v.t)}</div>
    </button>
  `).join("");

  renderPosQuiz(d);
  renderPosScenario(d);
}

function renderPosQuiz(d){
  const host = document.getElementById("posQuizArea");
  if(!host) return;
  let out = "";
  d.quiz.forEach((q,i)=>{
    const opts = [...q.c].sort(()=>0.5-Math.random());
    out += `<div class="pos-q">${i+1}. ${escapeHtml(q.q)}</div><div class="pos-opts">`;
    opts.forEach(c=>{
      out += `<label class="pos-opt"><input type="radio" name="posq${i}" value="${escapeHtml(c)}"><span>${escapeHtml(c)}</span></label>`;
    });
    out += `</div>`;
  });
  out += `<div style="margin-top:12px;text-align:center"><button class="menu-btn" style="background:#16a34a;color:white;" id="posSubmitQuizBtn" type="button">Submit mini-quiz</button></div>`;
  host.innerHTML = out;
  // Bind click in code (more reliable than inline onclick)
  const b = document.getElementById("posSubmitQuizBtn");
  if(b) b.onclick = (e)=>{ try{e.preventDefault(); e.stopPropagation();}catch(_){} submitPosQuiz(); };
}

function renderPosScenario(d){
  const host = document.getElementById("posScenarioArea");
  if(!host) return;
  const opts = [...d.scenario.c].sort(()=>0.5-Math.random());
  host.innerHTML = `
    <div class="pos-q">${escapeHtml(d.scenario.q)}</div>
    <div class="pos-opts">
      ${opts.map(c=>`
        <label class="pos-opt"><input type="radio" name="posScenario" value="${escapeHtml(c)}"><span>${escapeHtml(c)}</span></label>
      `).join("")}
    </div>
    <div style="margin-top:12px;text-align:center">
      <button class="menu-btn" style="background:#2563eb;color:white;" id="posSubmitScenarioBtn" type="button">Answer scenario</button>
    </div>
  `;


  const b2 = document.getElementById("posSubmitScenarioBtn");
  if(b2) b2.onclick = (e)=>{ try{e.preventDefault(); e.stopPropagation();}catch(_){} submitPosScenario(); };
}

function submitPosQuiz(){
  const d = POS_DATA[POS_CURRENT];
  if(!d) return;
  let score = 0;
  d.quiz.forEach((q,i)=>{
    const picked = document.querySelector(`input[name="posq${i}"]:checked`)?.value || "";
    if(picked === q.a) score += 1;
  });
  document.getElementById("posQuizScore").textContent = `${score}/3`;

  const xp = 25 + score*20;
  try{ if(typeof awardXP==="function") awardXP(xp, "Position Quiz"); }catch(e){}

  try{
    const p = (typeof getProfile === "function") ? getProfile() : {xp:0};
    document.getElementById("posXP2").textContent = String(p.xp||0);
  }catch(e){}

  const res = document.getElementById("posResult");
  if(res){
    res.style.display="block";
    res.textContent = score===3 ? "ðŸ”¥ Perfect! You know this position!" : (score===2 ? "Nice! Nearly perfect." : "Good try â€” replay and improve!");
  }

  if(score===3){
    try{
      const p = getProfile();
      if(typeof tryAwardTrophy==="function") tryAwardTrophy(p, `${d.title.replace(/^[^ ]+ /,'')} Star`);
      if(typeof saveProfile==="function") saveProfile(p);
    }catch(e){}
  }
}

function submitPosScenario(){
  const d = POS_DATA[POS_CURRENT];
  if(!d) return;
  const picked = document.querySelector(`input[name="posScenario"]:checked`)?.value || "";
  const correct = picked === d.scenario.a;
  document.getElementById("posScenarioScore").textContent = `${correct?1:0}/1`;

  try{ if(typeof awardXP==="function") awardXP(correct?55:20, "Scenario"); }catch(e){}
  try{
    const p = (typeof getProfile === "function") ? getProfile() : {xp:0};
    document.getElementById("posXP2").textContent = String(p.xp||0);
  }catch(e){}

  const res = document.getElementById("posResult");
  if(res){
    res.style.display="block";
    res.textContent = correct ? "âœ… Great decision!" : `âŒ Not quite. Best answer: ${d.scenario.a}`;
  }
}


// Make sure inline onclick can access these in all browsers
window.openPositionAcademy = openPositionAcademy;
window.closePositionAcademy = closePositionAcademy;
window.openPositionDetail = openPositionDetail;
window.backToPositionAcademy = backToPositionAcademy;
window.submitPosQuiz = submitPosQuiz;
window.submitPosScenario = submitPosScenario;


/* =========================
   KEEPER REACTION GAME LOGIC
========================= */
let keeperRunning = false;
let keeperTarget = null;
let keeperTimer = null;
let keeperRoundTimer = null;
let keeperSaves = 0;
let keeperMisses = 0;
let keeperSpeedLevel = 1; // 1x..
let keeperTimeLimit = 1300; // ms per shot
let keeperCanTap = false;

function openKeeperGame(){
  forceShowOverlayById("keeperGameScreen");
  resetKeeperGameUI();
  bindKeeperZonesOnce();
}
function closeKeeperGame(){
  stopKeeperGame();
  forceHideOverlayById("keeperGameScreen");
}
function resetKeeperGameUI(){
  keeperRunning = false;
  keeperCanTap = false;
  keeperTarget = null;
  keeperSaves = 0;
  keeperMisses = 0;
  keeperSpeedLevel = 1;
  keeperTimeLimit = 1300;

  const ball = document.getElementById("keeperBall");
  if(ball){
    ball.style.left = "50%";
    ball.style.top  = "65%";
    ball.style.transition = "none";
  }
  document.getElementById("keepSaves").textContent = "0";
  document.getElementById("keepMisses").textContent = "0";
  document.getElementById("keepSpeed").textContent = "1x";
  document.getElementById("keeperHint").textContent = "Tap the corner where the ball is goingâ€¦ before time runs out!";
  document.getElementById("keeperStartBtn").style.display = "inline-flex";
  document.getElementById("keeperRestartBtn").style.display = "none";
  clearKeeperZoneStates();
  flashKeeper("");
}
function bindKeeperZonesOnce(){
  const arena = document.getElementById("keeperGameScreen");
  if(!arena || arena.dataset.bound === "1") return;
  arena.dataset.bound = "1";

  document.getElementById("keeperStartBtn")?.addEventListener("click", ()=>{
    if(!keeperRunning) startKeeperGame();
  });
  document.getElementById("keeperRestartBtn")?.addEventListener("click", ()=>{
    resetKeeperGameUI();
    startKeeperGame();
  });

  document.querySelectorAll(".keeper-savezone").forEach(z=>{
    z.addEventListener("click", (e)=>{ e.stopPropagation();
      if(!keeperCanTap) return;
      handleKeeperTap(z.dataset.zone);
    });
    // better on touch
    z.addEventListener("touchstart", (e)=>{ e.stopPropagation();
      if(!keeperCanTap) return;
      e.preventDefault();
      handleKeeperTap(z.dataset.zone);
    }, {passive:false});
  });
}
function clearKeeperZoneStates(){
  document.querySelectorAll(".keeper-savezone").forEach(z=>{
    z.classList.remove("good","bad");
  });
}
function flashKeeper(mode){
  const f = document.getElementById("keeperFlash");
  if(!f) return;
  f.classList.remove("win","lose");
  if(mode==="win") f.classList.add("win");
  if(mode==="lose") f.classList.add("lose");
  // reset quickly
  if(mode){
    setTimeout(()=>{ f.classList.remove("win","lose"); }, 140);
  }
}

function startKeeperGame(){
  keeperRunning = true;
  keeperSaves = 0;
  keeperMisses = 0;
  keeperSpeedLevel = 1;
  keeperTimeLimit = 1300;
  document.getElementById("keeperStartBtn").style.display = "none";
  document.getElementById("keeperRestartBtn").style.display = "none";
  nextKeeperShot();
}
function stopKeeperGame(){
  keeperRunning = false;
  keeperCanTap = false;
  keeperTarget = null;
  if(keeperTimer) clearTimeout(keeperTimer);
  if(keeperRoundTimer) clearTimeout(keeperRoundTimer);
  keeperTimer = null;
  keeperRoundTimer = null;
}
function nextKeeperShot(){
  if(!keeperRunning) return;

  clearKeeperZoneStates();
  keeperCanTap = true;

  const zones = ["TL","TR","BL","BR"];
  keeperTarget = zones[Math.floor(Math.random()*zones.length)];

  // Animate ball to target
  const ball = document.getElementById("keeperBall");
  if(ball){
    const coords = {
      TL:{x:"22%", y:"22%"},
      TR:{x:"78%", y:"22%"},
      BL:{x:"22%", y:"58%"},
      BR:{x:"78%", y:"58%"}
    }[keeperTarget];

    // reset to start
    ball.style.transition = "none";
    ball.style.left = "50%";
    ball.style.top  = "65%";
    // force reflow
    void ball.offsetWidth;

    const travel = Math.max(260, Math.floor(keeperTimeLimit*0.72));
    ball.style.transition = `left ${travel}ms cubic-bezier(.2,.9,.2,1), top ${travel}ms cubic-bezier(.2,.9,.2,1)`;
    ball.style.left = coords.x;
    ball.style.top  = coords.y;
  }

  // Time out if not saved in time limit
  if(keeperTimer) clearTimeout(keeperTimer);
  keeperTimer = setTimeout(()=>{
    if(!keeperCanTap) return;
    keeperCanTap = false;
    keeperMisses += 1;
    document.getElementById("keepMisses").textContent = String(keeperMisses);
    markKeeperZone(keeperTarget, false);
    flashKeeper("lose");
    playSoundSafe("beep");

    if(keeperMisses >= 3){
      endKeeperGame(false);
    }else{
      keeperRoundTimer = setTimeout(nextKeeperShot, 520);
    }
  }, keeperTimeLimit);
}
function playSoundSafe(name){
  try{ if(typeof playSound==="function") playSound(name); }catch(e){}
}

function markKeeperZone(zone, good){
  const el = document.querySelector(`.keeper-savezone[data-zone="${zone}"]`);
  if(el){
    el.classList.add(good ? "good" : "bad");
  }
}

function handleKeeperTap(zone){
  if(!keeperRunning) return;
  keeperCanTap = false;

  if(keeperTimer) clearTimeout(keeperTimer);

  const correct = (zone === keeperTarget);
  if(correct){
    keeperSaves += 1;
    document.getElementById("keepSaves").textContent = String(keeperSaves);
    markKeeperZone(zone, true);
    flashKeeper("win");
    playSoundSafe("cheer");

    // speed up every 5 saves
    if(keeperSaves % 5 === 0){
      keeperSpeedLevel += 1;
      keeperTimeLimit = Math.max(520, Math.floor(keeperTimeLimit * 0.88));
      document.getElementById("keepSpeed").textContent = `${keeperSpeedLevel}x`;
      document.getElementById("keeperHint").textContent = `ðŸ”¥ Speed up! Youâ€™re now at ${keeperSpeedLevel}x`;
    }else{
      document.getElementById("keeperHint").textContent = "âœ… Save! Ready for the next shotâ€¦";
    }

    keeperRoundTimer = setTimeout(nextKeeperShot, 520);
  }else{
    keeperMisses += 1;
    document.getElementById("keepMisses").textContent = String(keeperMisses);
    markKeeperZone(zone, false);
    markKeeperZone(keeperTarget, false);
    flashKeeper("lose");
    playSoundSafe("beep");
    document.getElementById("keeperHint").textContent = "âŒ Wrong corner! Watch the targetâ€¦";

    if(keeperMisses >= 3){
      endKeeperGame(false);
    }else{
      keeperRoundTimer = setTimeout(nextKeeperShot, 650);
    }
  }
}

function endKeeperGame(won){
  stopKeeperGame();
  document.getElementById("keeperRestartBtn").style.display = "inline-flex";

  // XP reward (if profile system exists)
  try{
    const base = 40;
    const bonus = keeperSaves * 12;
    const xp = Math.min(420, base + bonus);
    if(typeof awardXP==="function") awardXP(xp, "Keeper Reaction");
  }catch(e){}

  // Winner/Loser visuals if your app has them
  try{
    if(typeof showWinnerLoserOverlay === "function"){
      // won if 15+ saves
      showWinnerLoserOverlay(keeperSaves >= 15 ? "WINNER" : "LOSER");
    }
  }catch(e){}

  document.getElementById("keeperHint").textContent =
    `Game over! Saves: ${keeperSaves}. Speed reached: ${keeperSpeedLevel}x. Tap Restart to try again.`;
}

// expose for inline onclick
window.openKeeperGame = openKeeperGame;
window.closeKeeperGame = closeKeeperGame;



/* =========================
   BUILD YOUR PLAYER (AVATAR) LOGIC
========================= */
const AVATAR_KEY = "hjfc_avatar_v1";
function defaultAvatar(){
  return { shirt:"#ff6b35", shorts:"#0b1020", boots:"#111827", cele:"ðŸ™Œ" };
}
function getAvatar(){
  try{
    return JSON.parse(localStorage.getItem(AVATAR_KEY) || "null") || defaultAvatar();
  }catch(e){
    return defaultAvatar();
  }
}
function saveAvatar(a){
  localStorage.setItem(AVATAR_KEY, JSON.stringify(a));
}
function avatarSVG(a, size=160){
  const s = Math.max(120, Math.floor(size));
  const head = Math.floor(s*0.16);
  const cx = Math.floor(s*0.5);
  const cy = Math.floor(s*0.22);
  const bodyY = Math.floor(s*0.34);
  const bodyH = Math.floor(s*0.28);
  const bodyW = Math.floor(s*0.36);
  const shortsY = bodyY + bodyH - Math.floor(s*0.02);
  const shortsH = Math.floor(s*0.18);
  const legY = shortsY + shortsH;
  const legH = Math.floor(s*0.16);
  const bootH = Math.floor(s*0.06);
  const armY = bodyY + Math.floor(s*0.06);
  const armW = Math.floor(s*0.12);
  const armH = Math.floor(s*0.20);
  const celeY = Math.floor(s*0.06);

  return `
  <svg width="${s}" height="${s}" viewBox="0 0 ${s} ${s}" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
    <text x="${cx}" y="${celeY}" text-anchor="middle" font-size="${Math.floor(s*0.18)}">${a.cele || "ðŸ™Œ"}</text>
    <circle cx="${cx}" cy="${cy}" r="${head}" fill="#ffd1a1"/>
    <rect x="${cx - bodyW/2}" y="${bodyY}" width="${bodyW}" height="${bodyH}" rx="${Math.floor(s*0.08)}" fill="${a.shirt}"/>
    <rect x="${cx - bodyW/2 - armW + 2}" y="${armY}" width="${armW}" height="${armH}" rx="${Math.floor(s*0.06)}" fill="${a.shirt}"/>
    <rect x="${cx + bodyW/2 - 2}" y="${armY}" width="${armW}" height="${armH}" rx="${Math.floor(s*0.06)}" fill="${a.shirt}"/>
    <rect x="${cx - bodyW/2}" y="${shortsY}" width="${bodyW}" height="${shortsH}" rx="${Math.floor(s*0.07)}" fill="${a.shorts}"/>
    <rect x="${cx - bodyW/2 + Math.floor(s*0.06)}" y="${legY}" width="${Math.floor(s*0.10)}" height="${legH}" rx="${Math.floor(s*0.04)}" fill="#0b1020"/>
    <rect x="${cx + bodyW/2 - Math.floor(s*0.16)}" y="${legY}" width="${Math.floor(s*0.10)}" height="${legH}" rx="${Math.floor(s*0.04)}" fill="#0b1020"/>
    <rect x="${cx - bodyW/2 + Math.floor(s*0.04)}" y="${legY + legH}" width="${Math.floor(s*0.16)}" height="${bootH}" rx="${Math.floor(s*0.04)}" fill="${a.boots}"/>
    <rect x="${cx + bodyW/2 - Math.floor(s*0.20)}" y="${legY + legH}" width="${Math.floor(s*0.16)}" height="${bootH}" rx="${Math.floor(s*0.04)}" fill="${a.boots}"/>
  </svg>`;
}
function renderAvatarInto(el, size){
  if(!el) return;
  const a = getAvatar();
  el.innerHTML = avatarSVG(a, size);
}
function updateAvatarDisplays(){
  renderAvatarInto(document.getElementById("penaltyAvatar"), 120);
  renderAvatarInto(document.getElementById("offsideAvatar"), 120);
  renderAvatarInto(document.getElementById("ttAvatar"), 120);
  renderAvatarInto(document.getElementById("keeperAvatar"), 120);
  renderAvatarInto(document.getElementById("quizAvatar"), 180);
  renderAvatarInto(document.getElementById("avatarPreview"), 180);
}

function openPlayerBuilder(){
  forceShowOverlayById("playerBuilderScreen");
  const a = getAvatar();
  const shirt = document.getElementById("avShirt");
  const shorts = document.getElementById("avShorts");
  const boots = document.getElementById("avBoots");
  const cele = document.getElementById("avCele");
  if(shirt) shirt.value = a.shirt;
  if(shorts) shorts.value = a.shorts;
  if(boots) boots.value = a.boots;
  if(cele) cele.value = a.cele || "ðŸ™Œ";
  updateAvatarDisplays();
}
function closePlayerBuilder(){
  const s = document.getElementById("playerBuilderScreen");
  if(s){
    s.classList.remove("active");
    s.style.display = "none";
  }
}
function readBuilder(){
  return {
    shirt: document.getElementById("avShirt")?.value || "#ff6b35",
    shorts: document.getElementById("avShorts")?.value || "#0b1020",
    boots: document.getElementById("avBoots")?.value || "#111827",
    cele: document.getElementById("avCele")?.value || "ðŸ™Œ",
  };
}
function hookBuilderLivePreview(){
  ["avShirt","avShorts","avBoots","avCele"].forEach(id=>{
    const el = document.getElementById(id);
    if(el) el.addEventListener("change", ()=> {
      saveTempPreview();
      updateAvatarDisplays();
    });
  });
}
function saveTempPreview(){
  // don't persist on every change; just preview
  const a = readBuilder();
  const preview = document.getElementById("avatarPreview");
  if(preview) preview.innerHTML = avatarSVG(a, 180);
}
function savePlayerBuilder(){
  const a = readBuilder();
  saveAvatar(a);
  updateAvatarDisplays();
  const hint = document.getElementById("avatarSaveHint");
  if(hint){
    hint.style.display = "block";
    setTimeout(()=> hint.style.display="none", 1200);
  }
}
function resetPlayerBuilder(){
  const d = defaultAvatar();
  saveAvatar(d);
  const shirt = document.getElementById("avShirt");
  const shorts = document.getElementById("avShorts");
  const boots = document.getElementById("avBoots");
  const cele = document.getElementById("avCele");
  if(shirt) shirt.value = d.shirt;
  if(shorts) shorts.value = d.shorts;
  if(boots) boots.value = d.boots;
  if(cele) cele.value = d.cele;
  updateAvatarDisplays();
}

// Make sure avatar is ready
document.addEventListener("DOMContentLoaded", ()=>{
  hookBuilderLivePreview();
  updateAvatarDisplays();
});

// Also refresh avatars whenever key screens open
try{
  const _openPenalty = openPenalty;
  openPenalty = function(){
    updateAvatarDisplays();
    return _openPenalty.apply(this, arguments);
  };
}catch(e){}
try{
  const _openOffsideMenu = openOffsideMenu;
  openOffsideMenu = function(){
    updateAvatarDisplays();
    return _openOffsideMenu.apply(this, arguments);
  };
}catch(e){}
try{
  const _showQuizResultUI = showQuizResultUI;
  showQuizResultUI = function(entry){
    const r = _showQuizResultUI.apply(this, arguments);
    updateAvatarDisplays();
    return r;
  };
}catch(e){}


const POTW_ENDPOINT = "https://script.google.com/macros/s/AKfycbyWyVKpTiF9l13DJP3wnozgHTp4i_s5ZMr2_BY-jP1JiZsPdbb3dEa70fe_mZimd7MAUQ/exec";

const POTW_CANDIDATES = [
  {id:"p1", name:"Alfie", img:"assets/images/champions/Champ (2).jpg"},
  {id:"p2", name:"Bobby", img:"assets/images/champions/Champ (9).jpg"},
  {id:"p3", name:"Caleb", img:"assets/images/champions/Champ (17).jpg"},
  {id:"p4", name:"Charlie", img:"assets/images/champions/Champ (10).jpg"},
  {id:"p5", name:"Jensen", img:"assets/images/champions/Champ (13).jpg"},
  {id:"p6", name:"Kyle", img:"assets/images/champions/Champ (21).jpg"},
  {id:"p7", name:"Leo", img:"assets/images/champions/Champ (4).jpg"},
  {id:"p8", name:"Logan", img:"assets/images/champions/Champ (18).jpg"},
  {id:"p9", name:"Oakley", img:"assets/images/champions/Champ (6).jpg"},
  {id:"p10", name:"Thomas", img:"assets/images/champions/Champ (15).jpg"},
  {id:"p11", name:"Will-Dog", img:"assets/images/champions/Champ (19).jpg"}
];

function getISOWeekKey(d=new Date()){const date=new Date(Date.UTC(d.getFullYear(),d.getMonth(),d.getDate()));const dayNum=date.getUTCDay()||7;date.setUTCDate(date.getUTCDate()+4-dayNum);const yearStart=new Date(Date.UTC(date.getUTCFullYear(),0,1));const weekNo=Math.ceil((((date-yearStart)/86400000)+1)/7);return date.getUTCFullYear()+"-W"+String(weekNo).padStart(2,"0");}
function getOrCreateVoterId(){let id=localStorage.getItem("hjfc_voter_id");if(!id){id="v_"+Math.random().toString(16).slice(2)+"_"+Date.now();localStorage.setItem("hjfc_voter_id",id);}return id;}

async function submitPOTWVote(candidateId){
 const res=await fetch(POTW_ENDPOINT,{method:"POST",headers:{"Content-Type":"text/plain"},body:JSON.stringify({action:"vote",weekKey:getISOWeekKey(),voterId:getOrCreateVoterId(),candidateId})}).then(r=>r.json());
 return res;
}
async function fetchLeaderboard(){
 return await fetch(POTW_ENDPOINT,{method:"POST",headers:{"Content-Type":"text/plain"},body:JSON.stringify({action:"leaderboard",weekKey:getISOWeekKey()})}).then(r=>r.json());
}
function openVote(){forceShowOverlayById("voteScreen");renderVoteCards();}
function closeVote(){const el=document.getElementById("voteScreen");if(el){el.classList.remove("active");el.style.display="none";}}
async function handlePOTW(id){const r=await submitPOTWVote(id);alert(r.ok?"âœ… Vote submitted!":r.error);renderVoteCards();}
async function renderVoteCards(){const grid=document.getElementById("voteGrid");if(!grid)return;grid.innerHTML=POTW_CANDIDATES.map(c=>`<button class="gamesmenu-tile" type="button" onclick="handlePOTW('${c.id}')"><img class="gamesmenu-tileimg" src="${c.img}"><div class="gamesmenu-tilelabel">â­ ${c.name}</div></button>`).join("");}
function openLeaderboard(){forceShowOverlayById("leaderboardScreen");renderLeaderboard();}
async function renderLeaderboard(){const r=await fetchLeaderboard();const list=document.getElementById("lbList");const totals=r.totals||{};const rows=POTW_CANDIDATES.map(c=>({...c,count:totals[c.id]||0})).sort((a,b)=>b.count-a.count);list.innerHTML=rows.map((r,i)=>`<div style="display:flex;justify-content:space-between;padding:10px;color:white;font-weight:900;">${i+1}. ${r.name}<span>${r.count}</span></div>`).join("");}

</script>

<!-- =========================
     WEEKLY CHALLENGES OVERLAY
========================== -->
<div id="challengesScreen" class="overlay">
  <div class="overlay-content" style="max-width:1100px;text-align:center;">
    <div class="penalty-topbar" style="margin-bottom:10px;">
      <div class="penalty-banner">WEEKLY CHALLENGES</div>
      <div class="penalty-scoreboard" style="width:310px;">
        <div class="sb-row"><span>Level</span><strong id="chalLevel">1</strong></div>
        <div class="sb-row"><span>XP</span><strong id="chalXP">0</strong></div>
        <div class="sb-row"><span>Streak</span><strong id="chalStreak">0</strong></div>
      </div>
    </div>

    <div class="offside-help" style="margin:8px auto 0;max-width:920px;">
      Complete challenges to earn bonus XP and unlock trophies!
    </div>

    <div id="chalGrid" class="chal-grid" aria-label="Weekly challenge list"></div>

    <button class="back-btn" style="margin-top:14px" onclick="closeChallenges()">Back</button>
  </div>
</div>

<div id="xpToast" class="xp-toast"></div>

<!-- =========================
     POSITION ACADEMY OVERLAYS
========================== -->
<div id="positionAcademyScreen" class="overlay">
  <div class="overlay-content pos-wrap">
    <div class="penalty-topbar" style="margin-bottom:10px;">
      <div class="penalty-banner">POSITION ACADEMY</div>
      <div class="penalty-scoreboard" style="width:310px;">
        <div class="sb-row"><span>Level</span><strong id="posLevel">1</strong></div>
        <div class="sb-row"><span>XP</span><strong id="posXP">0</strong></div>
        <div class="sb-row"><span>Badges</span><strong id="posBadges">0</strong></div>
      </div>
    </div>

    <div class="offside-help" style="margin:8px auto 0;max-width:920px;">
      Pick a position, watch 2 quick clips, then do a miniâ€‘quiz and a match scenario.
    </div>

    <div class="pos-grid">
      <button class="pos-card" onclick="openPositionDetail('GK')">
        <div class="big">ðŸ§¤ Goalkeeper</div>
        <p class="sm">Shotâ€‘stopping â€¢ handling â€¢ positioning</p>
      </button>
      <button class="pos-card" onclick="openPositionDetail('DEF')">
        <div class="big">ðŸ›¡ Defender</div>
        <p class="sm">1v1 defending â€¢ tackling â€¢ staying compact</p>
      </button>
      <button class="pos-card" onclick="openPositionDetail('MID')">
        <div class="big">ðŸŽ¯ Midfielder</div>
        <p class="sm">Passing â€¢ scanning â€¢ helping attack & defence</p>
      </button>
      <button class="pos-card" onclick="openPositionDetail('STR')">
        <div class="big">âš¡ Striker</div>
        <p class="sm">Movement â€¢ finishing â€¢ quick decisions</p>
      </button>
    </div>

    <button class="back-btn" style="margin-top:12px" onclick="closePositionAcademy()">Back</button>
  </div>
</div>

<div id="positionDetailScreen" class="overlay">
  <div class="overlay-content pos-wrap">
    <div class="penalty-topbar" style="margin-bottom:10px;">
      <div class="penalty-banner" id="posTitle">POSITION</div>
      <div class="penalty-scoreboard" style="width:310px;">
        <div class="sb-row"><span>Miniâ€‘quiz</span><strong id="posQuizScore">0/3</strong></div>
        <div class="sb-row"><span>Scenario</span><strong id="posScenarioScore">0/1</strong></div>
        <div class="sb-row"><span>XP</span><strong id="posXP2">0</strong></div>
      </div>
    </div>

    <div class="pos-detail">
      <div class="pos-panel">
        <h3>Coach Tips</h3>
        <div id="posTips"></div>

        <h3 style="margin-top:12px">Quick Videos</h3>
        <div class="pos-video-grid" id="posVideos"></div>
      </div>

      <div class="pos-panel">
        <h3>Miniâ€‘Quiz (3 questions)</h3>
        <div id="posQuizArea"></div>

        <h3 style="margin-top:14px">Match Scenario</h3>
        <div id="posScenarioArea"></div>

        <div id="posResult" class="pos-result" style="display:none;"></div>
      </div>
    </div>

    <button class="back-btn" style="margin-top:12px" onclick="backToPositionAcademy()">Back to Positions</button>
  </div>
</div>

<!-- =========================
     KEEPER REACTION GAME OVERLAY
========================== -->
<div id="keeperGameScreen" class="overlay">
  <div class="overlay-content keeper-wrap">
    <div class="penalty-topbar" style="margin-bottom:10px;">
      <div class="penalty-banner">KEEPER REACTION</div>
      <div class="penalty-scoreboard" style="width:320px;">
        <div class="sb-row"><span>Saves</span><strong id="keepSaves">0</strong></div>
        <div class="sb-row"><span>Misses</span><strong id="keepMisses">0</strong></div>
        <div class="sb-row"><span>Speed</span><strong id="keepSpeed">1x</strong></div>
      </div>
    </div>

    <div style="display:flex;justify-content:center;margin:6px 0 10px;"><div id="keeperAvatar" class="avatar-mini"></div></div>

    <div class="keeper-arena" aria-label="Keeper reaction arena">
      <div class="keeper-goal"></div>
      <div class="keeper-net"></div>

      <button type="button" class="keeper-savezone kz-tl" data-zone="TL"><div class="keeper-label">Top Left</div></button>
      <button type="button" class="keeper-savezone kz-tr" data-zone="TR"><div class="keeper-label">Top Right</div></button>
      <button type="button" class="keeper-savezone kz-bl" data-zone="BL"><div class="keeper-label">Bottom Left</div></button>
      <button type="button" class="keeper-savezone kz-br" data-zone="BR"><div class="keeper-label">Bottom Right</div></button>

      <div class="keeper-ball" id="keeperBall" aria-hidden="true"></div>
      <div class="keeper-flash" id="keeperFlash" aria-hidden="true"></div>
      <div class="keeper-grass"></div>
    </div>

    <div class="keeper-hint" id="keeperHint">Tap the corner where the ball is goingâ€¦ before time runs out!</div>

    <div style="display:flex;gap:12px;justify-content:center;flex-wrap:wrap;margin-top:14px;">
      <button type="button" class="menu-btn" id="keeperStartBtn" style="background:#16a34a;color:white;">Start</button>
      <button type="button" class="menu-btn" id="keeperRestartBtn" style="background:#2563eb;color:white;display:none;">Restart</button>
      <button type="button" class="back-btn" onclick="closeKeeperGame()">Back</button>
    </div>
  </div>
</div>


<!-- =========================
     BUILD YOUR PLAYER OVERLAY
========================== -->
<div id="playerBuilderScreen" class="overlay" aria-label="Build your player">
  <div class="overlay-content" style="max-width:1100px;text-align:center;">
    <div class="penalty-topbar" style="margin-bottom:10px;">
      <div class="penalty-banner">BUILD YOUR PLAYER</div>
      <button class="tt-back-top" type="button" onclick="closePlayerBuilder()">Back</button>
    </div>

    <div class="avatar-card">
      <div style="font-weight:1000;font-size:1.35rem; margin-bottom:10px;">Your avatar will show up in games + results âš½âœ¨</div>
      <div style="display:flex;gap:18px;justify-content:center;align-items:center;flex-wrap:wrap;">
        <div id="avatarPreview" class="avatar-large" aria-label="Avatar preview"></div>
        <div style="min-width:min(520px, 92vw); text-align:left;">
          <div class="avatar-form" aria-label="Avatar options">
            <label>Shirt colour
              <select id="avShirt">
                <option value="#ff6b35">Orange</option>
                <option value="#2563eb">Blue</option>
                <option value="#16a34a">Green</option>
                <option value="#ef4444">Red</option>
                <option value="#a78bfa">Purple</option>
                <option value="#facc15">Yellow</option>
                <option value="#ffffff">White</option>
                <option value="#0b1020">Black</option>
              </select>
            </label>

            <label>Shorts colour
              <select id="avShorts">
                <option value="#0b1020">Black</option>
                <option value="#111827">Navy</option>
                <option value="#ffffff">White</option>
                <option value="#2563eb">Blue</option>
                <option value="#16a34a">Green</option>
                <option value="#ef4444">Red</option>
              </select>
            </label>

            <label>Boots colour
              <select id="avBoots">
                <option value="#111827">Black</option>
                <option value="#facc15">Yellow</option>
                <option value="#ef4444">Red</option>
                <option value="#2563eb">Blue</option>
                <option value="#ffffff">White</option>
              </select>
            </label>

            <label>Celebration
              <select id="avCele">
                <option value="ðŸ™Œ">ðŸ™Œ Hands up</option>
                <option value="ðŸ•º">ðŸ•º Dance</option>
                <option value="ðŸ¤¸">ðŸ¤¸ Flip</option>
                <option value="ðŸ¤©">ðŸ¤© Superstar</option>
                <option value="ðŸ‘Š">ðŸ‘Š Fist pump</option>
              </select>
            </label>
          </div>

          <div style="display:flex;gap:12px;justify-content:flex-start;flex-wrap:wrap;margin-top:14px;">
            <button class="menu-btn" style="background:#16a34a;" onclick="savePlayerBuilder()">Save</button>
            <button class="menu-btn" style="background:rgba(255,255,255,0.14);border:2px solid rgba(255,255,255,0.20);" onclick="resetPlayerBuilder()">Reset</button>
          </div>

          <div id="avatarSaveHint" style="margin-top:10px;opacity:0.9;font-weight:900;display:none;">Saved âœ…</div>
        </div>
      </div>
    </div>
  </div>
</div>


<div id="voteScreen" class="overlay"><div class="overlay-content"><div class="penalty-topbar"><div class="penalty-banner">â­ PLAYER OF THE WEEK</div><button onclick="closeVote()">Back</button></div><div id="voteGrid" class="gamesmenu-grid"></div></div></div>
<div id="leaderboardScreen" class="overlay"><div class="overlay-content"><div class="penalty-topbar"><div class="penalty-banner">ðŸ“Š LEADERBOARD</div><button onclick="closeVote()">Back</button></div><div id="lbList"></div></div></div>

<button class="xp-mini-btn" onclick="openVote()">â­ Player of the Week</button>
</body>
</html>

function backToPositions(){
  const detail = document.getElementById("positionAcademyDetailScreen");
  if(detail){
    detail.classList.remove("active");
    detail.style.display = "none";
  }
  forceShowOverlayById("positionAcademyScreen");
}

document.addEventListener("DOMContentLoaded", () => {
  const backBtn = document.getElementById("posBackBtn");
  if(backBtn) backBtn.onclick = backToPositions;
});
